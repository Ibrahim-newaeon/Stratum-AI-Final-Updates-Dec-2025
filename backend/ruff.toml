# =============================================================================
# Ruff Configuration - Stratum AI Backend
# =============================================================================
# Balanced config: catches real bugs while allowing existing patterns
# to be cleaned up incrementally.

# Target Python 3.11
target-version = "py311"

# Exclude common non-source directories
exclude = [
    ".venv",
    "venv",
    "__pycache__",
    "migrations",
    "alembic",
    ".git",
    "node_modules",
]

[lint]
# Enable useful rule sets
select = [
    "E",     # pycodestyle errors
    "W",     # pycodestyle warnings
    "F",     # pyflakes
    "B",     # flake8-bugbear
    "SIM",   # flake8-simplify
    "RUF",   # ruff-specific rules
]

# Ignore rules that produce too many pre-existing warnings
ignore = [
    "E501",   # line-too-long (handled by black/formatter)
    "E402",   # module-import-not-at-top-of-file
    "E712",   # true-false-comparison (SQLAlchemy uses == True)
    "E721",   # type-comparison
    "E741",   # ambiguous-variable-name
    "F401",   # unused-import (too many pre-existing; clean up incrementally)
    "F541",   # f-string-missing-placeholders (pre-existing)
    "F811",   # redefined-unused-name
    "F821",   # undefined-name (pre-existing in dead code paths)
    "F841",   # local-variable-is-assigned-but-never-used
    "UP006",  # non-pep585-annotation (typing.List -> list)
    "UP035",  # deprecated-import (typing.List/Optional)
    "I001",   # unsorted-imports (handled by isort separately)
    "B006",   # mutable-argument-default
    "B007",   # unused-loop-control-variable
    "B008",   # function-call-in-default-argument (FastAPI Depends pattern)
    "B904",   # raise-without-from-inside-except
    "SIM102", # collapsible-if (style preference)
    "SIM103", # return-bool-op-directly
    "SIM108", # if-else-block-instead-of-if-exp
    "SIM110", # reimplemented-builtin (any/all)
    "SIM114", # combine-if-branches
    "SIM115", # open-file-with-context-handler
    "SIM117", # multiple-with-statements
    "SIM118", # in-dict-keys
    "SIM300", # yoda-conditions
    "RUF001", # ambiguous-unicode-character-string
    "RUF005", # collection-literal-concatenation
    "RUF012", # mutable-class-default (SQLAlchemy model pattern)
    "RUF013", # implicit-optional
    "RUF015", # unnecessary-iterable-allocation-for-first-element
    "RUF100", # unused-noqa
    "W293",   # whitespace-before-comment (handled by formatter)
    "W605",   # invalid-escape-sequence
    "E722",   # bare-except
    "F402",   # import-shadowed-by-loop-var
    "B017",   # assert-raises-exception
    "B905",   # zip-without-explicit-strict
    "SIM105", # suppressible-exception (use contextlib.suppress)
    "RUF002", # ambiguous-unicode-character-docstring
    "RUF003", # ambiguous-unicode-character-comment
    "RUF006", # asyncio-dangling-task
    "RUF010", # explicit-f-string-type-conversion
    "RUF019", # unnecessary-key-check
]

# Don't auto-fix â€” just report
fixable = ["ALL"]
unfixable = []

[lint.per-file-ignores]
# Test files can use assert, magic values, etc.
"tests/**" = ["S101", "B011", "SIM300"]
# Init files commonly re-export
"__init__.py" = ["F401", "F403"]
# Migration files have auto-generated code
"alembic/**" = ["E501", "F401"]

[format]
# Use double quotes (consistent with Black)
quote-style = "double"
indent-style = "space"
