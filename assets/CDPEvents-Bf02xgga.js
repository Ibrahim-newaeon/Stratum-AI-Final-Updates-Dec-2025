import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as u}from"./vendor-react-Dz7uKsMg.js";import{a9 as L,a5 as D,f as p,h as y,c as x}from"./index-BQex3859.js";import{b as k,m as F,d as C,n as A,f as M}from"./cdp-B6W0ktOz.js";import{F as $}from"./ArrowDownTrayIcon-BpDtmKr2.js";import{F as R}from"./MagnifyingGlassIcon-3MUvqIvj.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";function T({severity:n}){const l={low:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",critical:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"};return e.jsx("span",{className:x("px-2 py-1 rounded-full text-xs font-medium capitalize",l[n]),children:n})}function q({data:n,height:l=200}){const r=Math.max(...n.map(a=>a.count),1);return e.jsxs("div",{className:"relative",style:{height:l},children:[e.jsx("div",{className:"absolute inset-0 flex items-end gap-1",children:n.map((a,d)=>{const m=a.count/r*100;return e.jsx("div",{className:"flex-1 flex flex-col items-center justify-end h-full group",children:e.jsx("div",{className:"w-full bg-primary/80 rounded-t hover:bg-primary transition-colors cursor-pointer relative",style:{height:`${m}%`,minHeight:"4px"},children:e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-popover border rounded shadow-lg text-xs whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:[e.jsxs("p",{className:"font-medium",children:[a.count.toLocaleString()," events"]}),e.jsx("p",{className:"text-muted-foreground",children:new Date(a.date).toLocaleDateString()})]})})},d)})}),e.jsxs("div",{className:"absolute -bottom-6 inset-x-0 flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:n.length>0?new Date(n[0].date).toLocaleDateString("en-US",{month:"short",day:"numeric"}):""}),e.jsx("span",{children:n.length>0?new Date(n[n.length-1].date).toLocaleDateString("en-US",{month:"short",day:"numeric"}):""})]})]})}function P({data:n}){const l=Math.max(...n.map(a=>a.count),1),r=n.slice(0,10);return e.jsx("div",{className:"space-y-3",children:r.map((a,d)=>{const m=a.count/l*100;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium truncate",children:a.event_name}),e.jsx("span",{className:"text-muted-foreground ml-2",children:a.count.toLocaleString()})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:x("h-full rounded-full transition-all duration-500",d===0?"bg-primary":d<3?"bg-primary/70":"bg-primary/50"),style:{width:`${m}%`}})})]},a.event_name)})})}function z({trend:n,change:l}){const r=n==="up"||l>0,a=n==="down"||l<0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:x("text-2xl font-bold",r?"text-green-500":a?"text-red-500":"text-muted-foreground"),children:[r?"+":"",l.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"vs last period"})]})}function U({data:n}){const l=n.reduce((a,d)=>a+d.count,0),r=a=>a.includes("90")||a.includes("80-")?"bg-green-400":a.includes("70")||a.includes("60-")?"bg-yellow-400":a.includes("50")||a.includes("40-")?"bg-orange-400":"bg-red-400";return e.jsx("div",{className:"space-y-2",children:n.map(a=>{const d=l>0?a.count/l*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs w-16 text-muted-foreground",children:a.score_range}),e.jsx("div",{className:"flex-1 h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:x("h-full rounded-full transition-all",r(a.score_range)),style:{width:`${d}%`}})}),e.jsxs("span",{className:"text-xs w-12 text-right",children:[d.toFixed(1),"%"]})]},a.score_range)})})}function X(){var f,v,b,N;const[n,l]=u.useState(30),[r,a]=u.useState(""),[d,m]=u.useState(!1),{data:s,isLoading:c}=k(n),{data:h,isLoading:w}=F(n),{data:i}=C(),{data:o,isLoading:_}=A({window_days:7,zscore_threshold:2}),g=M(),j=u.useMemo(()=>s!=null&&s.events_by_name?r?s.events_by_name.filter(t=>t.event_name.toLowerCase().includes(r.toLowerCase())):s.events_by_name:[],[s,r]),S=async()=>{try{const t=new Date;t.setDate(t.getDate()-n),await g.mutateAsync({format:"csv",first_seen_after:t.toISOString().split("T")[0],limit:1e4})}catch(t){console.error("Export failed:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Events Timeline"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[((f=s==null?void 0:s.total_events)==null?void 0:f.toLocaleString())||0," events in the last ",n," days"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:n,onChange:t=>l(Number(t.target.value)),className:"px-3 py-2 border rounded-lg bg-background text-sm",children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:14,children:"Last 14 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]}),e.jsxs("button",{onClick:S,disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 border rounded-lg hover:bg-muted transition-colors disabled:opacity-50",children:[e.jsx($,{className:"h-4 w-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Total Events"})]}),c?e.jsx("div",{className:"h-8 w-24 bg-muted animate-pulse rounded"}):e.jsx("p",{className:"text-2xl font-bold",children:((v=s==null?void 0:s.total_events)==null?void 0:v.toLocaleString())||0})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Unique Profiles"})]}),c?e.jsx("div",{className:"h-8 w-24 bg-muted animate-pulse rounded"}):e.jsx("p",{className:"text-2xl font-bold",children:((b=s==null?void 0:s.unique_profiles)==null?void 0:b.toLocaleString())||0})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Avg EMQ Score"})]}),c?e.jsx("div",{className:"h-8 w-24 bg-muted animate-pulse rounded"}):e.jsx("p",{className:"text-2xl font-bold",children:((N=s==null?void 0:s.avg_emq_score)==null?void 0:N.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Week over Week"})]}),w?e.jsx("div",{className:"h-8 w-24 bg-muted animate-pulse rounded"}):h?e.jsx(z,{trend:h.overall_trend,change:h.overall_change_pct}):e.jsx("p",{className:"text-2xl font-bold",children:"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card rounded-xl border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Event Volume"}),c?e.jsx("div",{className:"h-48 bg-muted animate-pulse rounded"}):s!=null&&s.daily_volume&&s.daily_volume.length>0?e.jsx("div",{className:"pb-8",children:e.jsx(q,{data:s.daily_volume})}):e.jsx("div",{className:"h-48 flex items-center justify-center text-muted-foreground",children:"No event data available"})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"EMQ Score Distribution"}),c?e.jsx("div",{className:"space-y-2",children:[1,2,3,4].map(t=>e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"},t))}):s!=null&&s.emq_distribution&&s.emq_distribution.length>0?e.jsx(U,{data:s.emq_distribution}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No EMQ data available"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-card rounded-xl border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Top Events"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:r,onChange:t=>a(t.target.value),placeholder:"Filter events...",className:"pl-9 pr-3 py-1.5 text-sm border rounded-lg bg-background w-40"})]})]}),c?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"},t))}):j.length>0?e.jsx(P,{data:j}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No events found"})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Events by Source"}),c?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"},t))}):s!=null&&s.events_by_source&&s.events_by_source.length>0?e.jsx("div",{className:"space-y-3",children:s.events_by_source.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:t.source_name}),e.jsx("span",{className:"text-muted-foreground",children:t.count.toLocaleString()})]},t.source_name))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No source data available"})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Anomaly Detection"}),o&&o.anomaly_count>0&&e.jsxs("span",{className:"px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400 rounded-full text-xs font-medium",children:[o.anomaly_count," detected"]})]}),e.jsx("button",{onClick:()=>m(!d),className:"text-sm text-primary hover:underline",children:d?"Hide Details":"View Details"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(i==null?void 0:i.health_status)==="healthy"?e.jsx(p,{className:"h-5 w-5 text-green-500"}):e.jsx(y,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"font-medium capitalize",children:(i==null?void 0:i.health_status)||"Unknown"})]}),e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Trend: ",e.jsx("span",{className:"capitalize",children:(i==null?void 0:i.volume_trend)||"N/A"})]})]}),d&&e.jsx("div",{className:"space-y-3 mt-4 pt-4 border-t",children:_?e.jsx("div",{className:"space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"},t))}):o!=null&&o.anomalies&&o.anomalies.length>0?o.anomalies.map((t,E)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.source_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.metric,": ",t.current_value.toLocaleString()," (",t.pct_change>=0?"+":"",t.pct_change.toFixed(1),"% from baseline)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{severity:t.severity}),e.jsx("span",{className:x("text-sm font-medium",t.direction==="high"?"text-red-500":"text-blue-500"),children:t.direction==="high"?"Spike":"Drop"})]})]},E)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),e.jsx("p",{children:"No anomalies detected in the last 7 days"})]})})]})]})}export{X as default};
//# sourceMappingURL=CDPEvents-Bf02xgga.js.map
