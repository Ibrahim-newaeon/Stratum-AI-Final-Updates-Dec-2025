{"version":3,"file":"admin-C8dTloZG.js","sources":["../../src/api/admin.ts"],"sourcesContent":["/**\r\n * Stratum AI - Admin API\r\n *\r\n * User and tenant management endpoints (Super Admin)\r\n */\r\n\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiClient, ApiResponse, PaginatedResponse } from './client';\r\n\r\n// Types\r\nexport type UserRole = 'superadmin' | 'admin' | 'user' | 'viewer';\r\nexport type TenantStatus = 'active' | 'suspended' | 'trial' | 'churned';\r\nexport type PlanTier = 'starter' | 'pro' | 'enterprise';\r\n\r\nexport interface User {\r\n  id: number;\r\n  email: string;\r\n  name: string;\r\n  role: UserRole;\r\n  tenantId: number | null;\r\n  isActive: boolean;\r\n  isVerified: boolean;\r\n  lastLoginAt: string | null;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface Tenant {\r\n  id: number;\r\n  name: string;\r\n  domain: string | null;\r\n  status: TenantStatus;\r\n  plan: PlanTier;\r\n  settings: Record<string, unknown>;\r\n  userCount: number;\r\n  monthlySpend: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface TenantWithMetrics extends Tenant {\r\n  emqScore: number | null;\r\n  budgetAtRisk: number;\r\n  activeIncidents: number;\r\n  lastActivityAt: string | null;\r\n}\r\n\r\nexport interface UserFilters {\r\n  role?: UserRole;\r\n  tenantId?: number;\r\n  isActive?: boolean;\r\n  search?: string;\r\n  skip?: number;\r\n  limit?: number;\r\n}\r\n\r\nexport interface TenantFilters {\r\n  status?: TenantStatus;\r\n  plan?: PlanTier;\r\n  search?: string;\r\n  skip?: number;\r\n  limit?: number;\r\n}\r\n\r\nexport interface CreateUserRequest {\r\n  email: string;\r\n  name: string;\r\n  password: string;\r\n  role: UserRole;\r\n  tenantId?: number;\r\n}\r\n\r\nexport interface UpdateUserRequest {\r\n  name?: string;\r\n  role?: UserRole;\r\n  tenantId?: number;\r\n  isActive?: boolean;\r\n}\r\n\r\nexport interface CreateTenantRequest {\r\n  name: string;\r\n  domain?: string;\r\n  plan: PlanTier;\r\n  settings?: Record<string, unknown>;\r\n}\r\n\r\nexport interface UpdateTenantRequest {\r\n  name?: string;\r\n  domain?: string;\r\n  status?: TenantStatus;\r\n  plan?: PlanTier;\r\n  settings?: Record<string, unknown>;\r\n}\r\n\r\n// API Functions\r\nexport const adminApi = {\r\n  // User Management\r\n  getUsers: async (filters: UserFilters = {}): Promise<PaginatedResponse<User>> => {\r\n    const response = await apiClient.get<ApiResponse<PaginatedResponse<User>>>('/admin/users', {\r\n      params: filters,\r\n    });\r\n    return response.data.data;\r\n  },\r\n\r\n  getUser: async (id: number): Promise<User> => {\r\n    const response = await apiClient.get<ApiResponse<User>>(`/admin/users/${id}`);\r\n    return response.data.data;\r\n  },\r\n\r\n  createUser: async (data: CreateUserRequest): Promise<User> => {\r\n    const response = await apiClient.post<ApiResponse<User>>('/admin/users', data);\r\n    return response.data.data;\r\n  },\r\n\r\n  updateUser: async (id: number, data: UpdateUserRequest): Promise<User> => {\r\n    const response = await apiClient.patch<ApiResponse<User>>(`/admin/users/${id}`, data);\r\n    return response.data.data;\r\n  },\r\n\r\n  deleteUser: async (id: number): Promise<void> => {\r\n    await apiClient.delete(`/admin/users/${id}`);\r\n  },\r\n\r\n  resetUserPassword: async (id: number): Promise<{ temporaryPassword: string }> => {\r\n    const response = await apiClient.post<ApiResponse<{ temporaryPassword: string }>>(\r\n      `/admin/users/${id}/reset-password`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  // Tenant Management\r\n  getTenants: async (\r\n    filters: TenantFilters = {}\r\n  ): Promise<PaginatedResponse<TenantWithMetrics>> => {\r\n    const response = await apiClient.get<ApiResponse<PaginatedResponse<TenantWithMetrics>>>(\r\n      '/admin/tenants',\r\n      { params: filters }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getTenant: async (id: number): Promise<TenantWithMetrics> => {\r\n    const response = await apiClient.get<ApiResponse<TenantWithMetrics>>(`/admin/tenants/${id}`);\r\n    return response.data.data;\r\n  },\r\n\r\n  createTenant: async (data: CreateTenantRequest): Promise<Tenant> => {\r\n    const response = await apiClient.post<ApiResponse<Tenant>>('/admin/tenants', data);\r\n    return response.data.data;\r\n  },\r\n\r\n  updateTenant: async (id: number, data: UpdateTenantRequest): Promise<Tenant> => {\r\n    const response = await apiClient.patch<ApiResponse<Tenant>>(`/admin/tenants/${id}`, data);\r\n    return response.data.data;\r\n  },\r\n\r\n  deleteTenant: async (id: number): Promise<void> => {\r\n    await apiClient.delete(`/admin/tenants/${id}`);\r\n  },\r\n\r\n  suspendTenant: async (id: number, reason?: string): Promise<Tenant> => {\r\n    const response = await apiClient.post<ApiResponse<Tenant>>(`/admin/tenants/${id}/suspend`, {\r\n      reason,\r\n    });\r\n    return response.data.data;\r\n  },\r\n\r\n  reactivateTenant: async (id: number): Promise<Tenant> => {\r\n    const response = await apiClient.post<ApiResponse<Tenant>>(`/admin/tenants/${id}/reactivate`);\r\n    return response.data.data;\r\n  },\r\n\r\n  getTenantUsers: async (id: number): Promise<User[]> => {\r\n    const response = await apiClient.get<ApiResponse<User[]>>(`/admin/tenants/${id}/users`);\r\n    return response.data.data;\r\n  },\r\n};\r\n\r\n// React Query Hooks\r\n\r\n// User hooks\r\nexport function useUsers(filters: UserFilters = {}) {\r\n  return useQuery({\r\n    queryKey: ['admin', 'users', filters],\r\n    queryFn: () => adminApi.getUsers(filters),\r\n    staleTime: 30 * 1000,\r\n  });\r\n}\r\n\r\nexport function useUser(id: number) {\r\n  return useQuery({\r\n    queryKey: ['admin', 'users', id],\r\n    queryFn: () => adminApi.getUser(id),\r\n    enabled: !!id,\r\n  });\r\n}\r\n\r\nexport function useCreateUser() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: adminApi.createUser,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'users'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateUser() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: ({ id, data }: { id: number; data: UpdateUserRequest }) =>\r\n      adminApi.updateUser(id, data),\r\n    onSuccess: (_, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'users'] });\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'users', variables.id] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDeleteUser() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: adminApi.deleteUser,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'users'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useResetUserPassword() {\r\n  return useMutation({\r\n    mutationFn: adminApi.resetUserPassword,\r\n  });\r\n}\r\n\r\n// Tenant hooks\r\nexport function useTenants(filters: TenantFilters = {}) {\r\n  return useQuery({\r\n    queryKey: ['admin', 'tenants', filters],\r\n    queryFn: () => adminApi.getTenants(filters),\r\n    staleTime: 30 * 1000,\r\n  });\r\n}\r\n\r\nexport function useTenant(id: number) {\r\n  return useQuery({\r\n    queryKey: ['admin', 'tenants', id],\r\n    queryFn: () => adminApi.getTenant(id),\r\n    enabled: !!id,\r\n  });\r\n}\r\n\r\nexport function useCreateTenant() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: adminApi.createTenant,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateTenant() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: ({ id, data }: { id: number; data: UpdateTenantRequest }) =>\r\n      adminApi.updateTenant(id, data),\r\n    onSuccess: (_, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants'] });\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants', variables.id] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDeleteTenant() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: adminApi.deleteTenant,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useSuspendTenant() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: ({ id, reason }: { id: number; reason?: string }) =>\r\n      adminApi.suspendTenant(id, reason),\r\n    onSuccess: (_, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants'] });\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants', variables.id] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useReactivateTenant() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: adminApi.reactivateTenant,\r\n    onSuccess: (_, id) => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants'] });\r\n      queryClient.invalidateQueries({ queryKey: ['admin', 'tenants', id] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useTenantUsers(id: number) {\r\n  return useQuery({\r\n    queryKey: ['admin', 'tenants', id, 'users'],\r\n    queryFn: () => adminApi.getTenantUsers(id),\r\n    enabled: !!id,\r\n  });\r\n}\r\n"],"names":["adminApi","filters","apiClient","id","data","reason","useCreateUser","queryClient","useQueryClient","useMutation","useUpdateUser","_","variables","useDeleteUser","useTenants","useQuery","useTenant","useSuspendTenant","useTenantUsers"],"mappings":"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"}