import{j as e}from"./vendor-ui-B0DL0VNC.js";import{f as $,r as j}from"./vendor-react-Dz7uKsMg.js";import{t as r,c as f,a7 as N,b as w,dh as F}from"./index-BQex3859.js";import"./featureFlagsStore-DvEl_DiZ.js";import{u as p,a as M,b as T}from"./vendor-query-BPt-n81V.js";import{F as _}from"./LightBulbIcon-Bq6eSglt.js";import{F as q}from"./BeakerIcon-DX6qkZ0w.js";import{F as P}from"./ArrowsRightLeftIcon-DNIBo-OC.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-motion-CR45sdSp.js";const o={attributeDeal:async(t,a)=>(await r.get(`/attribution/deals/${t}`,{params:{model:a}})).data.data,batchAttributeDeals:async t=>(await r.post("/attribution/batch",t)).data.data,getAttributionSummary:async t=>(await r.get("/attribution/summary",{params:t})).data.data,getDailyAttributedRevenue:async t=>(await r.get("/attribution/daily",{params:t})).data.data,compareModels:async t=>(await r.get("/attribution/compare",{params:t})).data.data,getContactJourney:async t=>(await r.get(`/attribution/journeys/${t}`)).data.data,getTopConversionPaths:async t=>(await r.get("/attribution/journeys/top-paths",{params:t})).data.data,getChannelTransitions:async t=>(await r.get("/attribution/journeys/transitions",{params:t})).data.data,getAssistedConversions:async t=>(await r.get("/attribution/journeys/assisted",{params:t})).data.data,getTimeLagReport:async t=>(await r.get("/attribution/journeys/time-lag",{params:t})).data.data,trainMarkovModel:async t=>(await r.post("/attribution/data-driven/markov/train",t)).data.data,trainShapleyModel:async t=>(await r.post("/attribution/data-driven/shapley/train",t)).data.data,getTrainedModels:async t=>(await r.get("/attribution/data-driven/models",{params:t})).data.data,getTrainedModel:async t=>(await r.get(`/attribution/data-driven/models/${t}`)).data.data,activateModel:async t=>(await r.post(`/attribution/data-driven/models/${t}/activate`)).data.data,archiveModel:async t=>(await r.post(`/attribution/data-driven/models/${t}/archive`)).data.data,getTrainingRuns:async t=>(await r.get("/attribution/data-driven/training-runs",{params:t})).data.data,getMarkovResults:async t=>(await r.get(`/attribution/data-driven/markov/${t}/results`)).data.data,getShapleyResults:async t=>(await r.get(`/attribution/data-driven/shapley/${t}/results`)).data.data,getModelRecommendation:async t=>(await r.get("/attribution/data-driven/recommend",{params:t})).data.data,attributeWithDataDriven:async(t,a)=>(await r.get(`/attribution/data-driven/attribute/${t}`,{params:{model_id:a}})).data.data,compareWithRuleBased:async(t,a)=>(await r.get(`/attribution/data-driven/models/${t}/compare`,{params:a})).data.data};function L(t){return p({queryKey:["attribution","summary",t],queryFn:()=>o.getAttributionSummary(t),enabled:!!t.startDate&&!!t.endDate})}function K(t){return p({queryKey:["attribution","compare",t],queryFn:()=>o.compareModels(t),enabled:!!t.startDate&&!!t.endDate&&t.models.length>0})}function B(t){return p({queryKey:["attribution","journeys","top-paths",t],queryFn:()=>o.getTopConversionPaths(t),enabled:!!t.startDate&&!!t.endDate})}function G(){const t=M();return T({mutationFn:o.trainMarkovModel,onSuccess:()=>{t.invalidateQueries({queryKey:["attribution","data-driven"]})}})}function Q(){const t=M();return T({mutationFn:o.trainShapleyModel,onSuccess:()=>{t.invalidateQueries({queryKey:["attribution","data-driven"]})}})}function U(t){return p({queryKey:["attribution","data-driven","models",t],queryFn:()=>o.getTrainedModels(t)})}const h={first_touch:"First Touch",last_touch:"Last Touch",linear:"Linear",time_decay:"Time Decay",position_based:"Position Based",w_shaped:"W-Shaped",markov:"Markov Chain",shapley:"Shapley Value"};function ee(){$();const[t,a]=j.useState("overview"),[n,S]=j.useState("linear"),[l]=j.useState({startDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),{data:m}=L({...l,model:n}),{data:C}=B({...l,limit:10}),{data:k}=K({...l,models:["first_touch","last_touch","linear","markov","shapley"]}),{data:D}=U(),b=G(),g=Q(),d=m?{totalConversions:m.reduce((s,i)=>s+i.conversions,0),totalRevenue:m.reduce((s,i)=>s+i.attributedRevenue,0),channelBreakdown:m}:null,v=(C??[]).map(s=>({...s,path:s.path.split(" > "),totalRevenue:s.revenue,avgTimeToConversion:s.avgDaysToConvert})),u=k,y=(D??[]).map(s=>({...s,name:s.modelName,trainedAt:s.createdAt,accuracy:s.validationAccuracy})),R=[{id:"overview",label:"Overview"},{id:"models",label:"AI Models"},{id:"paths",label:"Conversion Paths"},{id:"compare",label:"Model Comparison"}],A=["first_touch","last_touch","linear","time_decay","position_based","markov","shapley"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Multi-Touch Attribution"}),e.jsx("p",{className:"text-muted-foreground",children:"Understand the true impact of each channel on conversions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("select",{value:n,onChange:s=>S(s.target.value),className:"px-3 py-2 rounded-lg border bg-background",children:A.map(s=>e.jsx("option",{value:s,children:h[s]},s))})})]}),e.jsx("div",{className:"border-b",children:e.jsx("nav",{className:"flex gap-4",children:R.map(s=>e.jsx("button",{onClick:()=>a(s.id),className:f("px-4 py-2 border-b-2 font-medium text-sm transition-colors",t===s.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:s.label},s.id))})}),t==="overview"&&e.jsxs("div",{className:"space-y-6",children:[d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Conversions"}),e.jsx("p",{className:"text-2xl font-bold",children:d.totalConversions.toLocaleString()})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",d.totalRevenue.toLocaleString()]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unique Channels"}),e.jsx("p",{className:"text-2xl font-bold",children:d.channelBreakdown.length})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Model"}),e.jsx("p",{className:"text-xl font-bold",children:h[n]})]})]}),d&&e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Channel Attribution"}),e.jsx("div",{className:"space-y-4",children:d.channelBreakdown.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:s.channel}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s.conversions.toLocaleString()," conversions"]}),e.jsxs("span",{className:"font-medium",children:["$",s.attributedRevenue.toLocaleString()]})]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-primary",style:{width:`${s.avgWeight*100}%`}})})]},s.channel))})]}),e.jsx("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"h-5 w-5 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:["About ",h[n]]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[n==="first_touch"&&"Gives 100% credit to the first touchpoint in the customer journey.",n==="last_touch"&&"Gives 100% credit to the last touchpoint before conversion.",n==="linear"&&"Distributes credit equally across all touchpoints in the journey.",n==="time_decay"&&"Gives more credit to touchpoints closer to the conversion time.",n==="position_based"&&"Gives 40% to first, 40% to last, and 20% distributed among middle touchpoints.",n==="markov"&&"Uses transition probabilities to determine each channel's contribution to conversions.",n==="shapley"&&"Uses game theory to fairly distribute credit based on each channel's marginal contribution."]})]})]})})]}),t==="models"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/20",children:e.jsx(q,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Markov Chain Model"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Probabilistic model based on channel transitions"})]})]}),e.jsxs("button",{onClick:()=>b.mutate(l),disabled:b.isPending,className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50",children:[b.isPending?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(w,{className:"h-4 w-4"}),"Train Markov Model"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/20",children:e.jsx(F,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Shapley Value Model"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Game theory-based fair attribution"})]})]}),e.jsxs("button",{onClick:()=>g.mutate(l),disabled:g.isPending,className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:[g.isPending?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(w,{className:"h-4 w-4"}),"Train Shapley Model"]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card shadow-card overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"font-medium",children:"Trained Models"})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Model"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Trained"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:"Accuracy"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y",children:y==null?void 0:y.map(s=>{var i;return e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:((i=s.modelType)==null?void 0:i.replace("_"," "))??"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.trainedAt?new Date(s.trainedAt).toLocaleDateString():"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:s.accuracy?`${(s.accuracy*100).toFixed(1)}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:f("px-2 py-1 rounded-full text-xs",s.status==="active"&&"bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300",s.status==="training"&&"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300",s.status==="failed"&&"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300"),children:s.status})})]},s.id)})})]})]})]}),t==="paths"&&e.jsxs("div",{className:"rounded-xl border bg-card shadow-card overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-medium",children:"Top Conversion Paths"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Most common channel sequences leading to conversions"})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Path"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:"Conversions"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:"Revenue"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:"Avg. Time"})]})}),e.jsx("tbody",{className:"divide-y",children:v==null?void 0:v.map((s,i)=>e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.path.map((x,c)=>e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"px-2 py-1 rounded bg-muted text-xs font-medium",children:x}),c<s.path.length-1&&e.jsx(P,{className:"h-3 w-3 text-muted-foreground"})]},c))})}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:s.conversions.toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:["$",s.totalRevenue.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-muted-foreground",children:[s.avgTimeToConversion.toFixed(1)," days"]})]},i))})]})]}),t==="compare"&&u&&e.jsxs("div",{className:"rounded-xl border bg-card shadow-card overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"font-medium",children:"Attribution Model Comparison"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"See how different models attribute revenue to each channel"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Channel"}),u.models.map(s=>e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:h[s]||s},s))]})}),e.jsx("tbody",{className:"divide-y",children:u.channels.map(s=>e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:s.channel}),u.models.map(i=>{var x,c;return e.jsxs("td",{className:"px-4 py-3 text-right",children:["$",((c=(x=s.byModel[i])==null?void 0:x.revenue)==null?void 0:c.toLocaleString())||"0"]},i)})]},s.channel))})]})})]})]})}export{ee as default};
//# sourceMappingURL=Attribution-DHbORMtX.js.map
