{"version":3,"file":"Console-y8Jfv5EM.js","sources":["../../src/views/tenant/Console.tsx"],"sourcesContent":["/**\r\n * Media Buyer Console\r\n *\r\n * Primary goal: Optimize fast but safely; know exactly what is allowed today\r\n * Always-visible header with EMQ, Confidence, Autopilot mode & allowed actions\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n  type Action,\r\n  ActionCard,\r\n  type AutopilotMode,\r\n  AutopilotModeBanner,\r\n  BudgetAtRiskChip,\r\n  ConfidenceBandBadge,\r\n} from '@/components/shared';\r\nimport { useAutopilotState, useEmqScore } from '@/api/hooks';\r\nimport { useTenantRecommendations } from '@/api/hooks';\r\nimport {\r\n  ArrowTrendingUpIcon,\r\n  CheckCircleIcon,\r\n  ExclamationTriangleIcon,\r\n  WrenchScrewdriverIcon,\r\n  XMarkIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\ntype ActionTab = 'all' | 'opportunities' | 'risks' | 'fixes';\r\n\r\nexport default function Console() {\r\n  const { tenantId } = useParams<{ tenantId: string }>();\r\n  const tid = parseInt(tenantId || '1', 10);\r\n\r\n  const [activeTab, setActiveTab] = useState<ActionTab>('all');\r\n  const [appliedActions, setAppliedActions] = useState<Set<string>>(new Set());\r\n  const [dismissedActions, setDismissedActions] = useState<Set<string>>(new Set());\r\n\r\n  // Fetch data\r\n  const { data: emqData } = useEmqScore(tid);\r\n  const { data: autopilotData } = useAutopilotState(tid);\r\n  const { data: _recommendationsData } = useTenantRecommendations(tid);\r\n\r\n  const emqScore = emqData?.score ?? 85;\r\n  const autopilotMode: AutopilotMode = autopilotData?.mode ?? 'normal';\r\n  const budgetAtRisk = autopilotData?.budgetAtRisk ?? 0;\r\n\r\n  // Sample actions data\r\n  const allActions: Action[] = [\r\n    {\r\n      id: '1',\r\n      type: 'opportunity',\r\n      title: 'Scale \"Summer Sale\" campaign by 20%',\r\n      description:\r\n        'Campaign has maintained 5.2x ROAS over the past 14 days with consistent performance.',\r\n      platform: 'Meta',\r\n      campaign: 'Summer Sale 2024',\r\n      confidence: 94,\r\n      estimatedImpact: { metric: 'Revenue', value: 8500, unit: '$' },\r\n      status: 'pending',\r\n      priority: 1,\r\n      createdAt: new Date(),\r\n    },\r\n    {\r\n      id: '2',\r\n      type: 'opportunity',\r\n      title: 'Activate lookalike audience',\r\n      description: 'New 1% lookalike ready based on high-value purchasers segment.',\r\n      platform: 'Meta',\r\n      campaign: 'Prospecting - LAL',\r\n      confidence: 88,\r\n      estimatedImpact: { metric: 'Reach', value: 45, unit: '%' },\r\n      status: 'pending',\r\n      priority: 2,\r\n      createdAt: new Date(),\r\n    },\r\n    {\r\n      id: '3',\r\n      type: 'risk',\r\n      title: 'Pause underperforming ad set',\r\n      description: 'Ad set \"Broad Interest\" has 0.6x ROAS over last 7 days, burning budget.',\r\n      platform: 'Meta',\r\n      campaign: 'Awareness Campaign',\r\n      confidence: 91,\r\n      estimatedImpact: { metric: 'Savings', value: 1200, unit: '$' },\r\n      status: 'pending',\r\n      priority: 1,\r\n      createdAt: new Date(),\r\n    },\r\n    {\r\n      id: '4',\r\n      type: 'risk',\r\n      title: 'Creative fatigue detected',\r\n      description: 'Top creative \"Product Hero\" CTR dropped 35% in last 3 days.',\r\n      platform: 'TikTok',\r\n      campaign: 'TikTok Conversions',\r\n      confidence: 86,\r\n      estimatedImpact: { metric: 'CTR', value: -0.5, unit: '%' },\r\n      status: 'pending',\r\n      priority: 2,\r\n      createdAt: new Date(),\r\n    },\r\n    {\r\n      id: '5',\r\n      type: 'fix',\r\n      title: 'Review conversion tracking',\r\n      description: 'Meta pixel showing 18% variance from GA4 - verify implementation.',\r\n      platform: 'Meta',\r\n      confidence: 78,\r\n      estimatedImpact: { metric: 'EMQ', value: 8, unit: 'pts' },\r\n      status: 'pending',\r\n      priority: 1,\r\n      createdAt: new Date(),\r\n    },\r\n  ];\r\n\r\n  // Filter actions\r\n  const filteredActions = allActions\r\n    .filter((a) => !appliedActions.has(a.id) && !dismissedActions.has(a.id))\r\n    .filter((a) => {\r\n      if (activeTab === 'all') return true;\r\n      if (activeTab === 'opportunities') return a.type === 'opportunity';\r\n      if (activeTab === 'risks') return a.type === 'risk';\r\n      if (activeTab === 'fixes') return a.type === 'fix';\r\n      return true;\r\n    });\r\n\r\n  // Mode restrictions\r\n  const isFrozen = autopilotMode === 'frozen';\r\n  const isCutsOnly = autopilotMode === 'cuts_only';\r\n\r\n  const canApplyAction = (action: Action): boolean => {\r\n    if (isFrozen) return false;\r\n    if (isCutsOnly && action.type === 'opportunity') return false;\r\n    return true;\r\n  };\r\n\r\n  const handleApply = (action: Action) => {\r\n    setAppliedActions(new Set([...appliedActions, action.id]));\r\n  };\r\n\r\n  const handleDismiss = (action: Action) => {\r\n    setDismissedActions(new Set([...dismissedActions, action.id]));\r\n  };\r\n\r\n  const tabs = [\r\n    { id: 'all' as const, label: 'All Actions', count: allActions.length },\r\n    {\r\n      id: 'opportunities' as const,\r\n      label: 'Opportunities',\r\n      icon: ArrowTrendingUpIcon,\r\n      count: allActions.filter((a) => a.type === 'opportunity').length,\r\n    },\r\n    {\r\n      id: 'risks' as const,\r\n      label: 'Risks',\r\n      icon: ExclamationTriangleIcon,\r\n      count: allActions.filter((a) => a.type === 'risk').length,\r\n    },\r\n    {\r\n      id: 'fixes' as const,\r\n      label: 'Fixes',\r\n      icon: WrenchScrewdriverIcon,\r\n      count: allActions.filter((a) => a.type === 'fix').length,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Always Visible Header */}\r\n      <div data-tour=\"console-header\" className=\"sticky top-0 z-10 bg-surface-primary pb-4\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-white\">Daily Console</h1>\r\n            <p className=\"text-text-muted\">Optimize fast, but safely</p>\r\n          </div>\r\n          <div className=\"flex items-center gap-4\">\r\n            {/* EMQ Score */}\r\n            <div className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-surface-secondary border border-white/10\">\r\n              <span className=\"text-2xl font-bold text-white\">{emqScore}</span>\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"text-xs text-text-muted\">EMQ</span>\r\n                <ConfidenceBandBadge score={emqScore} size=\"sm\" />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Autopilot Mode */}\r\n            <AutopilotModeBanner mode={autopilotMode} compact />\r\n\r\n            {/* Budget at Risk */}\r\n            {budgetAtRisk > 0 && <BudgetAtRiskChip amount={budgetAtRisk} />}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Mode Warning Banner */}\r\n        {(isFrozen || isCutsOnly) && (\r\n          <div\r\n            data-tour=\"allowed-actions\"\r\n            className={cn(\r\n              'flex items-center gap-3 p-3 rounded-xl',\r\n              isFrozen ? 'bg-danger/10 text-danger' : 'bg-warning/10 text-warning'\r\n            )}\r\n          >\r\n            <ExclamationTriangleIcon className=\"w-5 h-5\" />\r\n            <div>\r\n              <span className=\"font-medium\">\r\n                {isFrozen ? 'Autopilot Frozen' : 'Cuts Only Mode'}\r\n              </span>\r\n              <span className=\"text-sm opacity-80 ml-2\">\r\n                {isFrozen\r\n                  ? 'All automation paused. Focus on fixing data issues.'\r\n                  : 'Only pause and reduction actions are allowed.'}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tab Navigation */}\r\n      <div className=\"flex items-center gap-2 border-b border-white/10 pb-4\">\r\n        {tabs.map((tab) => {\r\n          const Icon = tab.icon;\r\n          return (\r\n            <button\r\n              key={tab.id}\r\n              onClick={() => setActiveTab(tab.id)}\r\n              className={cn(\r\n                'flex items-center gap-2 px-4 py-2 rounded-lg transition-colors',\r\n                activeTab === tab.id\r\n                  ? 'bg-stratum-500/10 text-stratum-400'\r\n                  : 'text-text-muted hover:text-white hover:bg-white/5'\r\n              )}\r\n            >\r\n              {Icon && <Icon className=\"w-4 h-4\" />}\r\n              {tab.label}\r\n              <span\r\n                className={cn(\r\n                  'text-xs px-2 py-0.5 rounded-full',\r\n                  activeTab === tab.id ? 'bg-stratum-500/20' : 'bg-surface-tertiary'\r\n                )}\r\n              >\r\n                {tab.count}\r\n              </span>\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Actions Grid */}\r\n      <div data-tour=\"action-cards\" className=\"grid gap-4\">\r\n        {filteredActions.length > 0 ? (\r\n          filteredActions.map((action) => (\r\n            <div key={action.id} data-tour={action.type === 'fix' ? 'fix-first' : undefined}>\r\n              <ActionCard\r\n                action={action}\r\n                disabled={!canApplyAction(action)}\r\n                onApply={handleApply}\r\n                onDismiss={handleDismiss}\r\n                showControls\r\n              />\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <div className=\"text-center py-16\">\r\n            <div className=\"w-16 h-16 rounded-full bg-success/10 flex items-center justify-center mx-auto mb-4\">\r\n              <CheckCircleIcon className=\"w-8 h-8 text-success\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-semibold text-white mb-2\">All caught up!</h3>\r\n            <p className=\"text-text-muted\">\r\n              No pending actions in this category. Check back later.\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Applied/Dismissed Summary */}\r\n      {(appliedActions.size > 0 || dismissedActions.size > 0) && (\r\n        <div className=\"flex items-center gap-4 pt-4 border-t border-white/10\">\r\n          {appliedActions.size > 0 && (\r\n            <div className=\"flex items-center gap-2 text-success text-sm\">\r\n              <CheckCircleIcon className=\"w-4 h-4\" />\r\n              {appliedActions.size} applied today\r\n            </div>\r\n          )}\r\n          {dismissedActions.size > 0 && (\r\n            <div className=\"flex items-center gap-2 text-text-muted text-sm\">\r\n              <XMarkIcon className=\"w-4 h-4\" />\r\n              {dismissedActions.size} dismissed\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["Console","tenantId","useParams","tid","activeTab","setActiveTab","useState","appliedActions","setAppliedActions","dismissedActions","setDismissedActions","emqData","useEmqScore","autopilotData","useAutopilotState","_recommendationsData","useTenantRecommendations","emqScore","autopilotMode","budgetAtRisk","allActions","filteredActions","a","isFrozen","isCutsOnly","canApplyAction","action","handleApply","handleDismiss","tabs","ArrowTrendingUpIcon","ExclamationTriangleIcon","WrenchScrewdriverIcon","jsxs","jsx","ConfidenceBandBadge","AutopilotModeBanner","BudgetAtRiskChip","cn","tab","Icon","ActionCard","CheckCircleIcon","XMarkIcon"],"mappings":"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"}