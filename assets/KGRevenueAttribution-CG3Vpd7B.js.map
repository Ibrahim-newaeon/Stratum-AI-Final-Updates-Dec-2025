{"version":3,"file":"KGRevenueAttribution-CG3Vpd7B.js","sources":["../../src/views/knowledge-graph/KGRevenueAttribution.tsx"],"sourcesContent":["/**\r\n * KG Revenue Attribution - Knowledge Graph revenue attribution view\r\n *\r\n * Shows attributed revenue across channels with model comparison\r\n * and channel breakdown visualization.\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { Helmet } from 'react-helmet-async';\r\nimport { motion } from 'framer-motion';\r\nimport {\r\n  CurrencyDollarIcon,\r\n  MapPinIcon,\r\n  ArrowsRightLeftIcon,\r\n  ClockIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n  CartesianGrid,\r\n  Cell,\r\n} from 'recharts';\r\nimport { cn } from '@/lib/utils';\r\nimport { useKGRevenueAttribution, useKGChannelBreakdown } from '@/api/knowledgeGraph';\r\n\r\nconst fadeIn = {\r\n  initial: { opacity: 0, y: 12 },\r\n  animate: { opacity: 1, y: 0 },\r\n  transition: { duration: 0.3 },\r\n};\r\n\r\nconst periods = [\r\n  { value: '7d', label: '7 Days' },\r\n  { value: '30d', label: '30 Days' },\r\n  { value: '90d', label: '90 Days' },\r\n];\r\n\r\nexport default function KGRevenueAttribution() {\r\n  const [period, setPeriod] = useState('30d');\r\n\r\n  const { data: revenueData, isLoading: revenueLoading } = useKGRevenueAttribution(period);\r\n  const { data: channelData, isLoading: channelsLoading } = useKGChannelBreakdown(period);\r\n\r\n  const isLoading = revenueLoading || channelsLoading;\r\n\r\n  const formatCurrency = (value: number): string =>\r\n    new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    }).format(value);\r\n\r\n  const formatCompact = (value: number): string => {\r\n    if (value >= 1000) return `${(value / 1000).toFixed(1)}k`;\r\n    return value.toString();\r\n  };\r\n\r\n  const metricCards = [\r\n    {\r\n      label: 'Attributed Revenue',\r\n      value: formatCurrency(revenueData?.attributedRevenue ?? 0),\r\n      icon: CurrencyDollarIcon,\r\n      color: 'text-green-500',\r\n    },\r\n    {\r\n      label: 'Touchpoints Tracked',\r\n      value: formatCompact(revenueData?.touchpointsTracked ?? 0),\r\n      icon: MapPinIcon,\r\n      color: 'text-blue-500',\r\n    },\r\n    {\r\n      label: 'Avg Path Length',\r\n      value: `${revenueData?.avgPathLength ?? 0} steps`,\r\n      icon: ArrowsRightLeftIcon,\r\n      color: 'text-purple-500',\r\n    },\r\n    {\r\n      label: 'Conversion Window',\r\n      value: revenueData?.conversionWindow ?? '-',\r\n      icon: ClockIcon,\r\n      color: 'text-amber-500',\r\n    },\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>Revenue Attribution - Knowledge Graph | Stratum AI</title>\r\n      </Helmet>\r\n\r\n      <div className=\"space-y-6 max-w-7xl mx-auto\">\r\n        {/* Header + Period Filter */}\r\n        <motion.div className=\"flex items-center justify-between\" {...fadeIn}>\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold\">Revenue Attribution</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Multi-touch attribution across all channels\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center gap-1 p-1 rounded-lg bg-white/5 border border-white/10\">\r\n            {periods.map((p) => (\r\n              <button\r\n                key={p.value}\r\n                onClick={() => setPeriod(p.value)}\r\n                className={cn(\r\n                  'px-3 py-1.5 text-sm rounded-md transition-colors',\r\n                  period === p.value\r\n                    ? 'bg-primary text-primary-foreground'\r\n                    : 'text-muted-foreground hover:text-foreground'\r\n                )}\r\n              >\r\n                {p.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Metric Cards */}\r\n        <motion.div\r\n          className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\"\r\n          {...fadeIn}\r\n          transition={{ delay: 0.1 }}\r\n        >\r\n          {metricCards.map((card) => (\r\n            <div\r\n              key={card.label}\r\n              className=\"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-4\"\r\n            >\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-white/5\">\r\n                  <card.icon className={cn('h-5 w-5', card.color)} />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground\">{card.label}</p>\r\n                  <p className=\"text-lg font-bold\">{card.value}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </motion.div>\r\n\r\n        {/* Channel Breakdown + Model Comparison */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n          {/* Channel Breakdown Chart */}\r\n          <motion.div\r\n            className=\"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-6\"\r\n            {...fadeIn}\r\n            transition={{ delay: 0.15 }}\r\n          >\r\n            <h3 className=\"font-semibold mb-4\">Channel Breakdown</h3>\r\n            <ResponsiveContainer width=\"100%\" height={300}>\r\n              <BarChart\r\n                data={channelData || []}\r\n                layout=\"vertical\"\r\n                margin={{ top: 0, right: 20, bottom: 0, left: 80 }}\r\n              >\r\n                <CartesianGrid\r\n                  strokeDasharray=\"3 3\"\r\n                  stroke=\"rgba(255,255,255,0.05)\"\r\n                  horizontal={false}\r\n                />\r\n                <XAxis\r\n                  type=\"number\"\r\n                  tick={{ fontSize: 11, fill: 'rgba(245,245,247,0.4)' }}\r\n                  axisLine={false}\r\n                  tickLine={false}\r\n                  tickFormatter={(v) => `$${(v / 1000).toFixed(0)}k`}\r\n                />\r\n                <YAxis\r\n                  type=\"category\"\r\n                  dataKey=\"channel\"\r\n                  tick={{ fontSize: 12, fill: 'rgba(245,245,247,0.7)' }}\r\n                  axisLine={false}\r\n                  tickLine={false}\r\n                  width={80}\r\n                />\r\n                <Tooltip\r\n                  contentStyle={{\r\n                    background: 'rgba(11, 18, 21, 0.95)',\r\n                    border: '1px solid rgba(255,255,255,0.1)',\r\n                    borderRadius: '8px',\r\n                    fontSize: 12,\r\n                    color: 'rgba(245,245,247,0.92)',\r\n                  }}\r\n                  formatter={(value) => [formatCurrency(Number(value)), 'Revenue']}\r\n                />\r\n                <Bar dataKey=\"revenue\" radius={[0, 4, 4, 0]}>\r\n                  {(channelData || []).map((entry, index) => (\r\n                    <Cell key={index} fill={entry.color} fillOpacity={0.8} />\r\n                  ))}\r\n                </Bar>\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </motion.div>\r\n\r\n          {/* Model Comparison Table */}\r\n          <motion.div\r\n            className=\"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-6\"\r\n            {...fadeIn}\r\n            transition={{ delay: 0.2 }}\r\n          >\r\n            <h3 className=\"font-semibold mb-4\">Attribution Model Comparison</h3>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead>\r\n                  <tr className=\"border-b border-white/10\">\r\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Channel\r\n                    </th>\r\n                    <th className=\"text-right py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      First Touch\r\n                    </th>\r\n                    <th className=\"text-right py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Last Touch\r\n                    </th>\r\n                    <th className=\"text-right py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Linear\r\n                    </th>\r\n                    <th className=\"text-right py-2 px-3 text-sm font-medium text-primary\">\r\n                      Data-Driven\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {(revenueData?.modelComparison || []).map((row) => (\r\n                    <tr key={row.channel} className=\"border-b border-white/5 hover:bg-white/5\">\r\n                      <td className=\"py-3 px-3 text-sm font-medium\">{row.channel}</td>\r\n                      <td className=\"py-3 px-3 text-sm text-right text-muted-foreground\">\r\n                        {row.firstTouch}%\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-sm text-right text-muted-foreground\">\r\n                        {row.lastTouch}%\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-sm text-right text-muted-foreground\">\r\n                        {row.linear}%\r\n                      </td>\r\n                      <td className=\"py-3 px-3 text-sm text-right font-medium text-primary\">\r\n                        {row.dataDriven}%\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":["fadeIn","periods","KGRevenueAttribution","period","setPeriod","useState","revenueData","revenueLoading","useKGRevenueAttribution","channelData","channelsLoading","useKGChannelBreakdown","isLoading","formatCurrency","value","formatCompact","metricCards","CurrencyDollarIcon","MapPinIcon","ArrowsRightLeftIcon","ClockIcon","jsx","jsxs","Fragment","Helmet","motion","p","cn","card","ResponsiveContainer","BarChart","CartesianGrid","XAxis","v","YAxis","Tooltip","Bar","entry","index","Cell","row"],"mappings":"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"}