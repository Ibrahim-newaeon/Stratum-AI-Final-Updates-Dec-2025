import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as x}from"./vendor-react-Dz7uKsMg.js";import{t as ee,Q as me,c as n,M as X,E as q,T as se,J as D,K as Ae,j as Se,Y as Re,a2 as L,G as Me,z as Y,y as T,D as ce,w as O,B as W,v as te,a3 as ue,X as ae,r as xe,Z as _}from"./index-BQex3859.js";import{S as Pe}from"./SmartTooltip-B_oQxK2F.js";import{C as De}from"./calculator-BW8tZQIw.js";import{R as pe}from"./refresh-cw-DLOeozaH.js";import{D as Te}from"./dollar-sign-Dosx4kzY.js";import{I as Ie}from"./info-Bj1e8ZpJ.js";import{T as $e}from"./trending-down-75FD7zon.js";import{u as Le}from"./predictions-CzIV1TLQ.js";import{u as re}from"./vendor-query-BPt-n81V.js";import"./featureFlagsStore-DvEl_DiZ.js";import{L as F}from"./loader-circle-CJwg01sb.js";import{R as G,A as he,C as ne,X as ie,Y as le,T as B,b as J,e as Z,P as Oe,c as Fe,d as Ee,f as ze}from"./vendor-charts-Cj11RBfc.js";import{M as We,a as oe}from"./message-square-EtRKZFEb.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-motion-CR45sdSp.js";import"./circle-question-mark-DBPHcbWv.js";function qe(s,r){return re({queryKey:["insights",s,r],queryFn:async()=>(await ee.get(`/insights/tenant/${s}/insights`)).data.data,enabled:!!s,staleTime:60*1e3,refetchInterval:5*60*1e3})}function _e(s,r){return re({queryKey:["recommendations",s,r],queryFn:async()=>{const o=new URLSearchParams;return(await ee.get(`/insights/tenant/${s}/recommendations?${o}`)).data.data},enabled:!!s,staleTime:60*1e3})}function Ge(s,r){return re({queryKey:["anomalies",s,r],queryFn:async()=>{const o=new URLSearchParams;return(await ee.get(`/insights/tenant/${s}/anomalies?${o}`)).data.data},enabled:!!s,staleTime:60*1e3})}const Be={name:"All Campaigns",currentSpend:15e3,currentRevenue:52500,currentROAS:3.5,currentImpressions:25e5,currentClicks:75e3,currentConversions:1875};function Ke({campaign:s=Be,onSimulate:r,className:o}){const{t:l}=me(),[p,j]=x.useState({budgetChange:0,bidChange:0,targetAudienceChange:0}),[m,k]=x.useState(null),[d,y]=x.useState(!1),C=x.useCallback(()=>{y(!0),setTimeout(()=>{const{budgetChange:h,bidChange:u,targetAudienceChange:f}=p,N=1+h/100,A=1+u/100,P=1+f/100,S=s.currentSpend*N,R=Math.pow(N,.7)*Math.pow(P,.5),I=s.currentImpressions*R,i=A>1?Math.pow(A,.6):A,w=I*(s.currentClicks/s.currentImpressions)*i,de=Math.pow(N,-.1),K=w*(s.currentConversions/s.currentClicks)*de,E=K*(s.currentRevenue/s.currentConversions),U=S>0?E/S:0,H=Math.abs(h)+Math.abs(u)+Math.abs(f),V=Math.max(60,95-H*.3),z={estimatedSpend:S,estimatedRevenue:E,estimatedROAS:U,estimatedImpressions:Math.round(I),estimatedClicks:Math.round(w),estimatedConversions:Math.round(K),confidence:Math.round(V)};k(z),r==null||r(p,z),y(!1)},500)},[p,s,r]);x.useEffect(()=>{if(p.budgetChange!==0||p.bidChange!==0||p.targetAudienceChange!==0){const u=setTimeout(C,300);return()=>clearTimeout(u)}else k(null)},[p,C]);const v=()=>{j({budgetChange:0,bidChange:0,targetAudienceChange:0}),k(null)},a=(h,u,f,N,A,P)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Pe,{content:P,position:"right",children:e.jsxs("span",{className:"text-sm font-medium flex items-center gap-1",children:[h,e.jsx(Ie,{className:"w-3.5 h-3.5 text-muted-foreground"})]})}),e.jsxs("span",{className:n("text-sm font-semibold",u>0&&"text-green-500",u<0&&"text-red-500"),children:[u>0?"+":"",u,"%"]})]}),e.jsx("input",{type:"range",min:f,max:N,value:u,onChange:S=>A(Number(S.target.value)),className:"w-full h-2 bg-muted rounded-lg appearance-none cursor-pointer accent-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[f,"%"]}),e.jsxs("span",{children:[N,"%"]})]})]}),M=(h,u)=>{const f=(u-h)/h*100;return Math.abs(f)<.5?null:e.jsxs("span",{className:n("flex items-center gap-0.5 text-xs",f>0?"text-green-500":"text-red-500"),children:[f>0?e.jsx(q,{className:"w-3 h-3"}):e.jsx($e,{className:"w-3 h-3"}),f>0?"+":"",Ae(f)]})};return e.jsxs("div",{id:"simulator-widget",className:n("rounded-xl border bg-card p-5",o),children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(De,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l("simulator.title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.name})]})]}),e.jsx("button",{onClick:v,className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Reset",children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-5 mb-6",children:[a(l("simulator.budget"),p.budgetChange,-50,100,h=>j(u=>({...u,budgetChange:h})),l("simulator.budgetTooltip")),a(l("simulator.bid"),p.bidChange,-30,50,h=>j(u=>({...u,bidChange:h})),l("simulator.bidTooltip")),a(l("simulator.audience"),p.targetAudienceChange,-50,100,h=>j(u=>({...u,targetAudienceChange:h})),l("simulator.audienceTooltip"))]}),(m||d)&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:l("simulator.projectedResults")}),m&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[m.confidence,"% ",l("simulator.confidence")]})]}),d?e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[1,2,3].map(h=>e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 animate-pulse",children:[e.jsx("div",{className:"h-3 w-12 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-5 w-16 bg-muted rounded"})]},h))}):m?e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-1",children:[e.jsx(Te,{className:"w-3 h-3"}),l("simulator.spend")]}),e.jsx("div",{className:"font-semibold",children:X(m.estimatedSpend)}),M(s.currentSpend,m.estimatedSpend)]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-1",children:[e.jsx(q,{className:"w-3 h-3"}),l("simulator.revenue")]}),e.jsx("div",{className:"font-semibold",children:X(m.estimatedRevenue)}),M(s.currentRevenue,m.estimatedRevenue)]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-1",children:[e.jsx(se,{className:"w-3 h-3"}),"ROAS"]}),e.jsxs("div",{className:"font-semibold",children:[m.estimatedROAS.toFixed(2),"x"]}),M(s.currentROAS,m.estimatedROAS)]})]}):null,m&&e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:l("simulator.impressions")}),e.jsx("div",{className:"text-sm font-medium",children:D(m.estimatedImpressions)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:l("simulator.clicks")}),e.jsx("div",{className:"text-sm font-medium",children:D(m.estimatedClicks)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:l("simulator.conversions")}),e.jsx("div",{className:"text-sm font-medium",children:D(m.estimatedConversions)})]})]})]}),!m&&!d&&e.jsx("div",{className:"border-t pt-4 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:l("simulator.adjustSliders")})})]})}const Ue=[{id:1,type:"opportunity",priority:"high",title:"High-performing audience segment identified",description:"Users aged 25-34 in urban areas show 45% higher conversion rate. Consider increasing budget allocation.",impact:"+$12,500 estimated monthly revenue",campaign:"Summer Sale 2024",fullDescription:"Our AI analysis has identified a high-value audience segment that is significantly outperforming other demographics. Users aged 25-34 in urban metropolitan areas are converting at 4.2% compared to the campaign average of 2.9%. This segment also shows higher average order values ($127 vs $89) and lower cost per acquisition ($18 vs $31).",metrics:{conversionRate:{current:4.2,average:2.9,change:45},avgOrderValue:{current:127,average:89,change:43},cpa:{current:18,average:31,change:-42},audienceSize:245e3,potentialReach:89e4},recommendations:["Increase budget allocation by 30% for this segment","Create dedicated ad creatives for urban millennials","Test lookalike audiences based on this segment","Implement retargeting campaigns for non-converters"],historicalData:[{date:"Week 1",performance:2.8},{date:"Week 2",performance:3.1},{date:"Week 3",performance:3.6},{date:"Week 4",performance:4.2}],confidence:92,detectedAt:"2 hours ago"},{id:2,type:"warning",priority:"medium",title:"Creative fatigue detected",description:'Banner "Summer_v3" has been shown 2.3M times. CTR dropped 23% in the last 7 days.',impact:"-$3,200 estimated loss if unchanged",campaign:"Brand Awareness Q4",fullDescription:'The creative asset "Summer_v3" has reached saturation with your target audience. Frequency has exceeded optimal levels (7.2 vs recommended 4.0), and engagement metrics are declining rapidly. Immediate creative refresh is recommended to prevent further performance degradation.',metrics:{impressions:{current:23e5,threshold:15e5,change:53},ctr:{current:1.8,previous:2.3,change:-23},frequency:{current:7.2,optimal:4,change:80},estimatedLoss:3200},recommendations:["Pause current creative immediately","Rotate in 2-3 new creative variants","A/B test new creatives with fresh audiences","Set up automated creative rotation rules"],historicalData:[{date:"Week 1",performance:2.4},{date:"Week 2",performance:2.3},{date:"Week 3",performance:2.1},{date:"Week 4",performance:1.8}],confidence:88,detectedAt:"6 hours ago"},{id:3,type:"suggestion",priority:"low",title:"Optimal bidding time identified",description:"Historical data shows 18% better CPC between 6-9 PM. Consider dayparting adjustments.",impact:"+$890 estimated monthly savings",campaign:"All campaigns",fullDescription:"Analysis of 90 days of bidding data reveals consistent patterns in cost efficiency. Evening hours (6-9 PM local time) show significantly lower competition and better conversion rates. Implementing dayparting could reduce your overall CPC while maintaining conversion volume.",metrics:{cpcPeak:{current:2.45,offPeak:2.01,savings:18},conversionsPeak:{current:312,projected:298,change:-4},monthlySavings:890,optimalHours:"6PM - 9PM"},recommendations:["Increase bids by 15% during 6-9 PM","Reduce bids by 20% during 2-5 AM","Set up automated dayparting rules","Monitor for 2 weeks before full rollout"],historicalData:[{date:"6AM",performance:2.8},{date:"12PM",performance:2.4},{date:"6PM",performance:2},{date:"9PM",performance:2.1}],confidence:76,detectedAt:"1 day ago"}],He=Array.from({length:14},(s,r)=>{const o=new Date;o.setDate(o.getDate()+r-7);const l=r<7;return{date:o.toLocaleDateString("en-US",{month:"short",day:"numeric"}),actual:l?4500+Math.random()*1500+r*100:null,predicted:4200+Math.random()*800+r*150,lowerBound:3800+Math.random()*500+r*120,upperBound:4800+Math.random()*800+r*180}}),Q=[{name:"First Touch",value:35,color:"#0ea5e9"},{name:"Last Touch",value:28,color:"#10b981"},{name:"Linear",value:22,color:"#f59e0b"},{name:"Time Decay",value:15,color:"#8b5cf6"}],Ve=[{id:1,date:"Nov 28",metric:"CTR",value:4.2,expected:2.8,deviation:"+50%",type:"positive",fullDescription:'Click-through rate spiked significantly above the expected baseline. This anomaly was detected across multiple ad groups in your "Summer Sale 2024" campaign. The spike correlates with a viral social media mention of your brand.',campaign:"Summer Sale 2024",adGroup:"Urban Millennials",platform:"Meta",severity:"high",historicalData:[{date:"Nov 22",value:2.6},{date:"Nov 23",value:2.7},{date:"Nov 24",value:2.9},{date:"Nov 25",value:2.8},{date:"Nov 26",value:3.1},{date:"Nov 27",value:3.4},{date:"Nov 28",value:4.2}],possibleCauses:["Viral social media mention detected on Twitter/X","Competitor went offline during this period","New creative variant showing strong engagement","Seasonal trend alignment"],suggestedActions:["Scale budget by 25% to capitalize on momentum","Create lookalike audience from engaged users","Document successful creative for future campaigns","Set up automated scaling rules for similar events"],relatedMetrics:{impressions:{value:125e3,change:12},clicks:{value:5250,change:68},conversions:{value:312,change:45},spend:{value:2450,change:15}},detectedAt:"2 hours ago",confidence:94},{id:2,date:"Nov 26",metric:"CPA",value:28.5,expected:18.2,deviation:"+56%",type:"negative",fullDescription:'Cost per acquisition increased sharply, indicating potential issues with audience targeting or ad relevance. This spike occurred primarily in the "Brand Awareness Q4" campaign, specifically in the retargeting ad group.',campaign:"Brand Awareness Q4",adGroup:"Retargeting - Cart Abandoners",platform:"Google Ads",severity:"critical",historicalData:[{date:"Nov 20",value:17.8},{date:"Nov 21",value:18.1},{date:"Nov 22",value:18.5},{date:"Nov 23",value:19.2},{date:"Nov 24",value:22.1},{date:"Nov 25",value:25.3},{date:"Nov 26",value:28.5}],possibleCauses:["Audience fatigue in retargeting segment","Increased competition during Black Friday period","Landing page performance degradation detected","Ad relevance score dropped from 8 to 5"],suggestedActions:["Pause underperforming ad groups immediately","Refresh creative assets in retargeting campaigns","Review and optimize landing page load time","Adjust bid strategy to target CPA mode"],relatedMetrics:{impressions:{value:89e3,change:-5},clicks:{value:1890,change:-18},conversions:{value:66,change:-34},spend:{value:1881,change:8}},detectedAt:"1 day ago",confidence:89},{id:3,date:"Nov 24",metric:"Conversions",value:156,expected:89,deviation:"+75%",type:"positive",fullDescription:'Conversion volume exceeded expectations by a significant margin. This surge was driven by strong performance in the "Holiday Promotions" campaign, particularly from email retargeting and organic search traffic.',campaign:"Holiday Promotions",adGroup:"Email Retargeting",platform:"Multi-channel",severity:"medium",historicalData:[{date:"Nov 18",value:78},{date:"Nov 19",value:82},{date:"Nov 20",value:85},{date:"Nov 21",value:91},{date:"Nov 22",value:112},{date:"Nov 23",value:134},{date:"Nov 24",value:156}],possibleCauses:["Black Friday early access promotion launched","Email campaign achieved 45% open rate","Organic search rankings improved for key terms","Referral traffic spike from partner website"],suggestedActions:["Extend promotion period by 48 hours","Increase inventory allocation for top products","Send follow-up email to engaged non-converters","Document winning email subject lines"],relatedMetrics:{impressions:{value:234e3,change:28},clicks:{value:12400,change:42},revenue:{value:18720,change:82},roas:{value:4.8,change:35}},detectedAt:"3 days ago",confidence:91}];function Qe({insight:s,onClose:r,onApply:o}){const[l,p]=x.useState(!1);if(!s)return null;const j=async()=>{p(!0),await new Promise(d=>setTimeout(d,1500)),o(s),p(!1)},m=d=>{switch(d){case"opportunity":return"text-green-500 bg-green-500/10";case"warning":return"text-amber-500 bg-amber-500/10";case"suggestion":return"text-blue-500 bg-blue-500/10";default:return"text-primary bg-primary/10"}},k=d=>{switch(d){case"opportunity":return e.jsx(ue,{className:"w-5 h-5"});case"warning":return e.jsx(O,{className:"w-5 h-5"});case"suggestion":return e.jsx(Y,{className:"w-5 h-5"});default:return e.jsx(L,{className:"w-5 h-5"})}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-xl h-full bg-background shadow-2xl overflow-y-auto animate-in slide-in-from-right duration-300",children:[e.jsxs("div",{className:"sticky top-0 bg-background border-b px-6 py-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:n("p-2 rounded-lg",m(s.type)),children:k(s.type)}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:n("px-2 py-0.5 rounded-full text-xs font-medium",s.priority==="high"?"bg-red-500/10 text-red-500":s.priority==="medium"?"bg-amber-500/10 text-amber-500":"bg-blue-500/10 text-blue-500"),children:[s.priority.charAt(0).toUpperCase()+s.priority.slice(1)," Priority"]}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),s.detectedAt||"Recently"]})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/50",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Campaign: ",e.jsx("span",{className:"font-medium",children:s.campaign})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-primary"}),"AI Analysis"]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.fullDescription||s.description})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Estimated Impact"}),e.jsx("span",{className:n("text-lg font-bold",s.impact.startsWith("+")?"text-green-500":"text-red-500"),children:s.impact})]}),s.confidence&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"AI Confidence"}),e.jsxs("span",{className:"font-medium",children:[s.confidence,"%"]})]}),e.jsx("div",{className:"mt-2 h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${s.confidence}%`}})})]})]}),s.metrics&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-primary"}),"Key Metrics"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.type==="opportunity"&&s.metrics.conversionRate&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conversion Rate"}),e.jsxs("p",{className:"text-lg font-semibold",children:[s.metrics.conversionRate.current,"%"]}),e.jsxs("p",{className:"text-xs text-green-500",children:["+",s.metrics.conversionRate.change,"% vs avg"]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Order Value"}),e.jsxs("p",{className:"text-lg font-semibold",children:["$",s.metrics.avgOrderValue.current]}),e.jsxs("p",{className:"text-xs text-green-500",children:["+",s.metrics.avgOrderValue.change,"% vs avg"]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cost Per Acquisition"}),e.jsxs("p",{className:"text-lg font-semibold",children:["$",s.metrics.cpa.current]}),e.jsxs("p",{className:"text-xs text-green-500",children:[s.metrics.cpa.change,"% vs avg"]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Audience Size"}),e.jsx("p",{className:"text-lg font-semibold",children:D(s.metrics.audienceSize)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[D(s.metrics.potentialReach)," potential"]})]})]}),s.type==="warning"&&s.metrics.ctr&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current CTR"}),e.jsxs("p",{className:"text-lg font-semibold",children:[s.metrics.ctr.current,"%"]}),e.jsxs("p",{className:"text-xs text-red-500",children:[s.metrics.ctr.change,"% decline"]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Frequency"}),e.jsxs("p",{className:"text-lg font-semibold",children:[s.metrics.frequency.current,"x"]}),e.jsxs("p",{className:"text-xs text-amber-500",children:["Optimal: ",s.metrics.frequency.optimal,"x"]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Impressions"}),e.jsx("p",{className:"text-lg font-semibold",children:D(s.metrics.impressions.current)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Threshold: ",D(s.metrics.impressions.threshold)]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Est. Weekly Loss"}),e.jsxs("p",{className:"text-lg font-semibold text-red-500",children:["-$",D(s.metrics.estimatedLoss)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If unchanged"})]})]}),s.type==="suggestion"&&s.metrics.cpcPeak&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Peak CPC"}),e.jsxs("p",{className:"text-lg font-semibold",children:["$",s.metrics.cpcPeak.current]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"During busy hours"})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Off-Peak CPC"}),e.jsxs("p",{className:"text-lg font-semibold",children:["$",s.metrics.cpcPeak.offPeak]}),e.jsxs("p",{className:"text-xs text-green-500",children:[s.metrics.cpcPeak.savings,"% savings"]})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optimal Hours"}),e.jsx("p",{className:"text-lg font-semibold",children:s.metrics.optimalHours}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Local time"})]}),e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Monthly Savings"}),e.jsxs("p",{className:"text-lg font-semibold text-green-500",children:["+$",s.metrics.monthlySavings]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Estimated"})]})]})]})]}),s.historicalData&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-primary"}),"Performance Trend"]}),e.jsx("div",{className:"h-[120px]",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(ze,{data:s.historicalData,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ie,{dataKey:"date",tick:{fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(le,{tick:{fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"0.5rem"}}),e.jsx(Z,{type:"monotone",dataKey:"performance",stroke:s.type==="warning"?"#ef4444":"#10b981",strokeWidth:2,dot:{fill:s.type==="warning"?"#ef4444":"#10b981",strokeWidth:0,r:4}})]})})})]}),s.recommendations&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-primary"}),"Recommended Actions"]}),e.jsx("ul",{className:"space-y-2",children:s.recommendations.map((d,y)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(T,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:d})]},y))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-background border-t px-6 py-4 flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2.5 rounded-lg border hover:bg-muted transition-colors",children:"Dismiss"}),e.jsx("button",{onClick:j,disabled:l,className:n("flex-1 px-4 py-2.5 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",s.type==="warning"?"bg-amber-500 hover:bg-amber-600 text-white":"bg-primary hover:bg-primary/90 text-primary-foreground"),children:l?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 animate-spin"}),"Applying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4"}),s.type==="warning"?"Fix Issue":"Apply Recommendation"]})})]})]})]})}function Xe({anomaly:s,onClose:r,onAction:o}){var y,C;const[l,p]=x.useState(null),[j,m]=x.useState(!1);if(!s)return null;const k=async v=>{p(v),m(!0),await new Promise(a=>setTimeout(a,1500)),o(s,v),m(!1),p(null)},d=s.type==="positive";return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-xl h-full bg-background shadow-2xl overflow-y-auto animate-in slide-in-from-right duration-300",children:[e.jsxs("div",{className:n("sticky top-0 border-b px-6 py-4 flex items-start justify-between",d?"bg-green-500/5":"bg-red-500/5"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:n("p-2 rounded-lg",d?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:d?e.jsx(q,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold text-lg",children:[s.metric," Anomaly Detected"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:n("px-2 py-0.5 rounded-full text-xs font-medium",d?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:[d?"Positive":"Negative"," Anomaly"]}),e.jsxs("span",{className:n("px-2 py-0.5 rounded-full text-xs font-medium",s.severity==="critical"?"bg-red-500/10 text-red-500":s.severity==="high"?"bg-amber-500/10 text-amber-500":"bg-blue-500/10 text-blue-500"),children:[(y=s.severity)==null?void 0:y.charAt(0).toUpperCase(),(C=s.severity)==null?void 0:C.slice(1)," Severity"]})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Detected"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),s.detectedAt||s.date]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Platform"}),e.jsx("p",{className:"font-medium",children:s.platform||"Multi-channel"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Campaign"}),e.jsx("p",{className:"font-medium",children:s.campaign||"All Campaigns"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ad Group"}),e.jsx("p",{className:"font-medium",children:s.adGroup||"All Ad Groups"})]})]}),e.jsxs("div",{className:n("p-4 rounded-lg border",d?"border-green-500/30 bg-green-500/5":"border-red-500/30 bg-red-500/5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium",children:[s.metric," Value"]}),e.jsx("span",{className:n("text-2xl font-bold",d?"text-green-500":"text-red-500"),children:s.deviation})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actual"}),e.jsx("p",{className:"text-lg font-semibold",children:s.value})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Expected"}),e.jsx("p",{className:"text-lg font-semibold text-muted-foreground",children:s.expected})]})]}),s.confidence&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-current/10",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Detection Confidence"}),e.jsxs("span",{className:"font-medium",children:[s.confidence,"%"]})]}),e.jsx("div",{className:"mt-2 h-2 rounded-full bg-background overflow-hidden",children:e.jsx("div",{className:n("h-full rounded-full transition-all",d?"bg-green-500":"bg-red-500"),style:{width:`${s.confidence}%`}})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-primary"}),"AI Analysis"]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.fullDescription||`${s.metric} showed a ${s.deviation} deviation from expected values.`})]}),s.historicalData&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-primary"}),"7-Day Trend"]}),e.jsx("div",{className:"h-[140px]",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(he,{data:s.historicalData,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${s.id}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:d?"#10b981":"#ef4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:d?"#10b981":"#ef4444",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ie,{dataKey:"date",tick:{fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(le,{tick:{fontSize:11},tickLine:!1,axisLine:!1}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"0.5rem"}}),e.jsx(J,{type:"monotone",dataKey:"value",stroke:d?"#10b981":"#ef4444",strokeWidth:2,fill:`url(#gradient-${s.id})`})]})})})]}),s.relatedMetrics&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-primary"}),"Related Metrics"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(s.relatedMetrics).map(([v,a])=>e.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:v}),e.jsxs("p",{className:"text-lg font-semibold",children:[v==="spend"||v==="revenue"?"$":"",D(a.value)]}),e.jsxs("p",{className:n("text-xs",a.change>0?"text-green-500":"text-red-500"),children:[a.change>0?"+":"",a.change,"%"]})]},v))})]}),s.possibleCauses&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-amber-500"}),"Possible Causes"]}),e.jsx("ul",{className:"space-y-2",children:s.possibleCauses.map((v,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-muted flex items-center justify-center text-xs flex-shrink-0",children:a+1}),e.jsx("span",{children:v})]},a))})]}),s.suggestedActions&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-primary"}),"Suggested Actions"]}),e.jsx("ul",{className:"space-y-2",children:s.suggestedActions.map((v,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(T,{className:n("w-4 h-4 mt-0.5 flex-shrink-0",d?"text-green-500":"text-amber-500")}),e.jsx("span",{children:v})]},a))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-background border-t px-6 py-4 flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2.5 rounded-lg border hover:bg-muted transition-colors",children:"Dismiss"}),e.jsxs("button",{onClick:()=>k("reviewed"),disabled:j,className:"flex-1 px-4 py-2.5 rounded-lg border hover:bg-muted transition-colors flex items-center justify-center gap-2",children:[j&&l==="reviewed"?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(T,{className:"w-4 h-4"}),"Mark Reviewed"]}),e.jsxs("button",{onClick:()=>k("alert"),disabled:j,className:n("flex-1 px-4 py-2.5 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",d?"bg-green-500 hover:bg-green-600 text-white":"bg-amber-500 hover:bg-amber-600 text-white"),children:[j&&l==="alert"?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(_,{className:"w-4 h-4"}),"Create Alert Rule"]})]})]})]})}function Ye({anomaly:s,existingAlert:r,mode:o="create",onClose:l,onSave:p}){var $;const[j,m]=x.useState(!1),[k,d]=x.useState(!1),[y,C]=x.useState(null),v=()=>r?o==="duplicate"?{...r,id:void 0,name:`Copy of ${r.name}`}:{...r}:s?{name:`${s.metric} Alert`,metric:s.metric||"CTR",condition:s.type==="negative"?"below":"above",threshold:s.expected||0,frequency:"realtime",channels:{email:!0,whatsapp:!1,inApp:!0,slack:!1},enabled:!0}:{name:"New Alert",metric:"CTR",condition:"above",threshold:0,frequency:"realtime",channels:{email:!0,whatsapp:!1,inApp:!0,slack:!1},enabled:!0},[a,M]=x.useState(v()),[h]=x.useState((r==null?void 0:r.name)||"");if(!s&&!r)return null;const u=async()=>{if(o==="duplicate"&&!k){C("Please modify the alert before saving. Duplicate rules are not allowed.");return}if(o==="duplicate"&&a.name===`Copy of ${h}`){C("Please change the alert name before saving.");return}C(null),m(!0),await new Promise(i=>setTimeout(i,1500)),p(a,o==="edit"),m(!1)},f=i=>{M(w=>({...w,...i})),d(!0),C(null)},N=i=>{M(w=>({...w,channels:{...w.channels,[i]:!w.channels[i]}})),d(!0),C(null)},A=()=>{switch(o){case"edit":return"Edit Alert Rule";case"duplicate":return"Duplicate Alert Rule";default:return"Create Alert Rule"}},P=()=>{switch(o){case"edit":return"Save Changes";case"duplicate":return"Create Duplicate";default:return"Create Alert Rule"}},S=["CTR","CPA","CPC","CPM","ROAS","Conversions","Impressions","Clicks","Spend","Revenue"],R=[{value:"above",label:"Goes above"},{value:"below",label:"Goes below"},{value:"change_above",label:"Changes by more than +"},{value:"change_below",label:"Changes by more than -"}],I=[{value:"realtime",label:"Real-time",description:"Instant notification"},{value:"hourly",label:"Hourly",description:"Digest every hour"},{value:"daily",label:"Daily",description:"Daily summary"}];return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative w-full max-w-lg bg-background rounded-xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"border-b px-6 py-4 flex items-center justify-between bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:A()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o==="duplicate"?"Modify the alert before saving":"Get notified when metrics exceed thresholds"})]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-5 max-h-[60vh] overflow-y-auto",children:[y&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-500 text-sm",children:y}),o==="duplicate"&&e.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/30 text-amber-600 text-sm",children:"You must modify the alert name or settings before saving to avoid duplicate rules."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Alert Name"}),e.jsx("input",{type:"text",value:a.name,onChange:i=>f({name:i.target.value}),className:"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all",placeholder:"e.g., CTR Drop Alert"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Metric to Monitor"}),e.jsx("select",{value:a.metric,onChange:i=>f({metric:i.target.value}),className:"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all",children:S.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Condition"}),e.jsx("select",{value:a.condition,onChange:i=>f({condition:i.target.value}),className:"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all",children:R.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Threshold ",a.condition.includes("change")?"(%)":""]}),e.jsx("input",{type:"number",value:a.threshold,onChange:i=>f({threshold:parseFloat(i.target.value)||0}),className:"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all",step:a.condition.includes("change")?"1":"0.1"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Alert will trigger when:"}),e.jsxs("p",{className:"font-medium",children:[a.metric," ",e.jsx("span",{className:"text-primary",children:($=R.find(i=>i.value===a.condition))==null?void 0:$.label.toLowerCase()})," ",e.jsxs("span",{className:"text-primary font-bold",children:[a.threshold,a.condition.includes("change")?"%":""]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Check Frequency"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:I.map(i=>e.jsxs("button",{onClick:()=>{f({frequency:i.value})},className:n("p-3 rounded-lg border text-center transition-all",a.frequency===i.value?"border-primary bg-primary/10 text-primary":"hover:bg-muted"),children:[e.jsx("p",{className:"font-medium text-sm",children:i.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.description})]},i.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notification Channels"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>N("email"),className:n("flex items-center gap-3 p-3 rounded-lg border transition-all",a.channels.email?"border-primary bg-primary/10":"hover:bg-muted"),children:[e.jsx("div",{className:n("p-2 rounded-lg",a.channels.email?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx(We,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-sm",children:"Email"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Get email alerts"})]}),a.channels.email&&e.jsx(T,{className:"w-4 h-4 text-primary ml-auto"})]}),e.jsxs("button",{onClick:()=>N("whatsapp"),className:n("flex items-center gap-3 p-3 rounded-lg border transition-all",a.channels.whatsapp?"border-primary bg-primary/10":"hover:bg-muted"),children:[e.jsx("div",{className:n("p-2 rounded-lg",a.channels.whatsapp?"bg-green-500 text-white":"bg-muted"),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-sm",children:"WhatsApp"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"WhatsApp messages"})]}),a.channels.whatsapp&&e.jsx(T,{className:"w-4 h-4 text-green-500 ml-auto"})]}),e.jsxs("button",{onClick:()=>N("inApp"),className:n("flex items-center gap-3 p-3 rounded-lg border transition-all",a.channels.inApp?"border-primary bg-primary/10":"hover:bg-muted"),children:[e.jsx("div",{className:n("p-2 rounded-lg",a.channels.inApp?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx(W,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-sm",children:"In-App"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Push notifications"})]}),a.channels.inApp&&e.jsx(T,{className:"w-4 h-4 text-primary ml-auto"})]}),e.jsxs("button",{onClick:()=>N("slack"),className:n("flex items-center gap-3 p-3 rounded-lg border transition-all",a.channels.slack?"border-primary bg-primary/10":"hover:bg-muted"),children:[e.jsx("div",{className:n("p-2 rounded-lg",a.channels.slack?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-sm",children:"Slack"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Channel alerts"})]}),a.channels.slack&&e.jsx(T,{className:"w-4 h-4 text-primary ml-auto"})]})]})]})]}),e.jsxs("div",{className:"border-t px-6 py-4 flex items-center gap-3 bg-muted/30",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2.5 rounded-lg border hover:bg-muted transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:j||!a.name.trim(),className:"flex-1 px-4 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:j?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 animate-spin"}),o==="edit"?"Saving...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),P()]})})]})]})]})}function gs(){const{t:s}=me(),{toast:r}=Se(),[o,l]=x.useState("7d"),[p,j]=x.useState(null),[m,k]=x.useState([]),[d,y]=x.useState(null),[C,v]=x.useState([]),[a,M]=x.useState(null),[h,u]=x.useState(null),[f,N]=x.useState("create"),[A,P]=x.useState([]),S=Re(t=>t.tenantId)??1,{data:R,isLoading:I,refetch:$}=qe(S),{data:i}=_e(S),{data:w,isLoading:de}=Ge(S),{data:K}=Le(),E=x.useMemo(()=>R!=null&&R.actions&&R.actions.length>0?R.actions.slice(0,3).map((t,c)=>({id:c+1,type:t.type||"suggestion",priority:t.priority||"medium",title:t.title||"",description:t.description||"",impact:t.expected_impact?`+${JSON.stringify(t.expected_impact)}`:"+$0 estimated",campaign:t.entity_name||"All campaigns"})):Ue,[R]),U=x.useMemo(()=>w!=null&&w.anomalies&&w.anomalies.length>0?w.anomalies.slice(0,3).map((t,c)=>({id:c+1,date:new Date(t.detected_at).toLocaleDateString("en-US",{month:"short",day:"numeric"}),metric:t.metric||"Unknown",value:t.current_value||0,expected:t.expected_value||0,deviation:t.zscore?`${t.zscore>0?"+":""}${(t.zscore*100).toFixed(0)}%`:"0%",type:t.direction==="spike"?"positive":"negative"})):Ve,[w]),H=()=>{$()},V=t=>{j(t)},z=t=>{k(c=>[...c,t.id]),j(null)},ge=t=>{y(t)},fe=(t,c)=>{c==="reviewed"?(v(g=>[...g,t.id]),y(null)):c==="alert"&&(y(null),M(t))},be=(t,c)=>{if(c&&t.id)P(g=>g.map(b=>b.id===t.id?t:b)),r({title:"Alert updated",description:`Alert rule "${t.name}" has been updated.`});else{const g={...t,id:`alert-${Date.now()}`};P(b=>[...b,g]),r({title:"Alert created",description:`Alert rule "${t.name}" has been created.`})}M(null),u(null),N("create")},je=t=>{u(t),N("edit")},ve=t=>{u(t),N("duplicate")},Ne=t=>{P(c=>c.map(g=>g.id===t?{...g,enabled:!g.enabled}:g))},ye=t=>{P(c=>c.filter(g=>g.id!==t))},we=t=>{switch(t){case"opportunity":return e.jsx(ue,{className:"w-5 h-5 text-green-500"});case"warning":return e.jsx(O,{className:"w-5 h-5 text-amber-500"});case"suggestion":return e.jsx(Y,{className:"w-5 h-5 text-primary"});default:return e.jsx(L,{className:"w-5 h-5"})}},Ce=t=>{const c={high:"bg-red-500/10 text-red-500",medium:"bg-amber-500/10 text-amber-500",low:"bg-blue-500/10 text-blue-500"};return e.jsx("span",{className:n("px-2 py-0.5 rounded-full text-xs font-medium",c[t]),children:t.charAt(0).toUpperCase()+t.slice(1)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-7 h-7 text-primary"}),s("stratum.title")]}),e.jsx("p",{className:"text-muted-foreground",children:s("stratum.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex rounded-lg border overflow-hidden",children:["24h","7d","30d","90d"].map(t=>e.jsx("button",{onClick:()=>l(t),className:n("px-4 py-2 text-sm transition-colors",o===t?"bg-primary text-primary-foreground":"hover:bg-muted"),children:t},t))}),e.jsx("button",{onClick:H,disabled:I,className:"p-2 rounded-lg border hover:bg-muted transition-colors disabled:opacity-50",children:I?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 rounded-lg border hover:bg-muted transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-primary"}),s("stratum.aiInsights")]}),e.jsx("button",{className:"text-sm text-primary hover:underline",children:s("common.viewAll")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:E.map(t=>{const c=m.includes(t.id);return e.jsxs("div",{onClick:()=>!c&&V(t),className:n("p-4 rounded-lg border bg-background transition-all cursor-pointer",c?"opacity-60 cursor-default border-green-500/50":"hover:shadow-md hover:border-primary/50"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c?e.jsx(T,{className:"w-5 h-5 text-green-500"}):we(t.type),c?e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-green-500/10 text-green-500",children:"Applied"}):Ce(t.priority)]}),e.jsx("h4",{className:"font-medium text-sm mb-1",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:n("text-xs font-medium",t.impact.startsWith("+")?"text-green-500":"text-red-500"),children:t.impact}),!c&&e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"})]})]},t.id)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 rounded-xl border bg-card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s("stratum.revenueForecast")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("stratum.forecastDescription")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"Actual"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Predicted"})]})]})]}),e.jsx("div",{className:"h-[300px]",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(he,{data:He,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPredicted",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ie,{dataKey:"date",tick:{fontSize:12},tickLine:!1,axisLine:!1}),e.jsx(le,{tick:{fontSize:12},tickLine:!1,axisLine:!1,tickFormatter:t=>`$${D(t)}`}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"0.5rem"},formatter:t=>[X(t),""]}),e.jsx(J,{type:"monotone",dataKey:"upperBound",stroke:"transparent",fill:"#10b981",fillOpacity:.1}),e.jsx(J,{type:"monotone",dataKey:"lowerBound",stroke:"transparent",fill:"#fff",fillOpacity:1}),e.jsx(Z,{type:"monotone",dataKey:"predicted",stroke:"#10b981",strokeWidth:2,strokeDasharray:"5 5",dot:!1}),e.jsx(Z,{type:"monotone",dataKey:"actual",stroke:"#0ea5e9",strokeWidth:2,dot:{fill:"#0ea5e9",strokeWidth:0,r:3},connectNulls:!1})]})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s("stratum.forecastedRevenue")}),e.jsx("p",{className:"text-lg font-semibold",children:"$156,890"}),e.jsx("p",{className:"text-xs text-green-500",children:"+12.4% vs last period"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s("stratum.confidence")}),e.jsx("p",{className:"text-lg font-semibold",children:"87%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"High confidence"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s("stratum.modelAccuracy")}),e.jsx("p",{className:"text-lg font-semibold",children:"94.2%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]})]}),e.jsx(Ke,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:s("stratum.attributionModel")}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-48 h-48",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Oe,{children:[e.jsx(Fe,{data:Q,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:Q.map((t,c)=>e.jsx(Ee,{fill:t.color},`cell-${c}`))}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"0.5rem"}})]})})}),e.jsx("div",{className:"flex-1 space-y-3",children:Q.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm",children:t.name})]}),e.jsxs("span",{className:"font-medium",children:[t.value,"%"]})]},t.name))})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:s("stratum.anomalyDetection")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]}),e.jsx("div",{className:"space-y-3",children:U.map((t,c)=>{const g=C.includes(t.id);return e.jsxs("div",{onClick:()=>!g&&ge(t),className:n("p-3 rounded-lg border-l-4 transition-all",t.type==="positive"?"bg-green-500/10 border-green-500":"bg-red-500/10 border-red-500",g?"opacity-60 cursor-default":"cursor-pointer hover:shadow-md"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}):t.type==="positive"?e.jsx(T,{className:"w-4 h-4 text-green-500"}):e.jsx(O,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"font-medium text-sm",children:t.metric}),g&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-muted text-muted-foreground",children:"Reviewed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:t.date}),!g&&e.jsx(ce,{className:"w-3 h-3 text-muted-foreground"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Actual: "}),e.jsx("span",{className:"font-medium",children:t.value})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Expected: "}),e.jsx("span",{className:"font-medium",children:t.expected})]}),e.jsx("span",{className:n("font-semibold",t.type==="positive"?"text-green-500":"text-red-500"),children:t.deviation})]})]},t.id||c)})})]})]}),A.length>0&&e.jsxs("div",{className:"rounded-xl border bg-card p-5",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),"Active Alerts",e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs font-medium",children:A.length})]})}),e.jsx("div",{className:"space-y-3",children:A.map(t=>{const c={above:"goes above",below:"goes below",change_above:"changes by more than +",change_below:"changes by more than -"}[t.condition],g=Object.entries(t.channels).filter(([b,ke])=>ke).map(([b])=>b);return e.jsx("div",{className:n("p-4 rounded-lg border transition-all",t.enabled?"bg-background":"bg-muted/50 opacity-60"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("span",{className:n("px-2 py-0.5 rounded-full text-xs font-medium",t.enabled?"bg-green-500/10 text-green-500":"bg-muted text-muted-foreground"),children:t.enabled?"Active":"Paused"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.metric})," ",c," ",e.jsxs("span",{className:"font-medium text-foreground",children:[t.threshold,t.condition.includes("change")?"%":""]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),t.frequency==="realtime"?"Real-time":t.frequency==="hourly"?"Hourly":"Daily"]}),e.jsx("div",{className:"flex items-center gap-1",children:g.map(b=>e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-muted capitalize",children:b==="inApp"?"In-App":b},b))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),je(t)},className:"px-3 py-1.5 rounded-lg text-xs font-medium border border-primary/30 text-primary bg-primary/10 hover:bg-primary/20 transition-colors",children:"Edit"}),e.jsx("button",{onClick:b=>{b.stopPropagation(),ve(t)},className:"px-3 py-1.5 rounded-lg text-xs font-medium border border-blue-500/30 text-blue-500 bg-blue-500/10 hover:bg-blue-500/20 transition-colors",children:"Duplicate"}),e.jsx("button",{onClick:b=>{b.stopPropagation(),Ne(t.id)},className:n("px-3 py-1.5 rounded-lg text-xs font-medium border transition-colors",t.enabled?"bg-green-500/10 text-green-600 border-green-500/30 hover:bg-green-500/20":"bg-muted text-muted-foreground border-muted hover:bg-muted/80"),children:t.enabled?"Pause":"Resume"}),e.jsx("button",{onClick:b=>{b.stopPropagation(),ye(t.id)},className:"px-3 py-1.5 rounded-lg text-xs font-medium border border-red-500/30 text-red-500 bg-red-500/10 hover:bg-red-500/20 transition-colors",children:"Delete"})]})]})},t.id)})})]}),p&&e.jsx(Qe,{insight:p,onClose:()=>j(null),onApply:z}),d&&e.jsx(Xe,{anomaly:d,onClose:()=>y(null),onAction:fe}),(a||h)&&e.jsx(Ye,{anomaly:a,existingAlert:h,mode:f,onClose:()=>{M(null),u(null),N("create")},onSave:be})]})}export{gs as Stratum,gs as default};
//# sourceMappingURL=Stratum-D28vHzZI.js.map
