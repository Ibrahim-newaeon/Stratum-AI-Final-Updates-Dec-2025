{"version":3,"file":"featureFlagsStore-DvEl_DiZ.js","sources":["../../src/stores/featureFlagsStore.ts"],"sourcesContent":["/**\r\n * Stratum AI - Feature Flags Store\r\n *\r\n * Zustand store for managing tenant feature flags.\r\n * Provides gating helpers for conditional feature rendering.\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport { devtools } from 'zustand/middleware';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface FeatureFlags {\r\n  // Trust Layer\r\n  signal_health: boolean;\r\n  attribution_variance: boolean;\r\n\r\n  // Intelligence Layer\r\n  ai_recommendations: boolean;\r\n  anomaly_alerts: boolean;\r\n  creative_fatigue: boolean;\r\n\r\n  // Execution Layer\r\n  campaign_builder: boolean;\r\n  autopilot_level: number; // 0=suggest, 1=guarded auto, 2=approval required\r\n\r\n  // Platform\r\n  superadmin_profitability: boolean;\r\n\r\n  // Limits\r\n  max_campaigns: number;\r\n  max_users: number;\r\n  data_retention_days: number;\r\n}\r\n\r\nexport interface FeatureCategory {\r\n  name: string;\r\n  description: string;\r\n  features: string[];\r\n}\r\n\r\nexport interface FeatureFlagsState {\r\n  // Current tenant's feature flags\r\n  features: FeatureFlags | null;\r\n  categories: Record<string, FeatureCategory>;\r\n  descriptions: Record<string, string>;\r\n\r\n  // Loading state\r\n  isLoading: boolean;\r\n  error: string | null;\r\n\r\n  // Actions\r\n  setFeatures: (features: FeatureFlags) => void;\r\n  setMetadata: (\r\n    categories: Record<string, FeatureCategory>,\r\n    descriptions: Record<string, string>\r\n  ) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setError: (error: string | null) => void;\r\n  reset: () => void;\r\n\r\n  // Gating helpers\r\n  can: (feature: keyof FeatureFlags) => boolean;\r\n  getAutopilotLevel: () => number;\r\n  isAutopilotBlocked: (signalHealthStatus: string) => boolean;\r\n}\r\n\r\n// =============================================================================\r\n// Default Values\r\n// =============================================================================\r\n\r\nexport const defaultFeatures: FeatureFlags = {\r\n  signal_health: false,\r\n  attribution_variance: false,\r\n  ai_recommendations: false,\r\n  anomaly_alerts: false,\r\n  creative_fatigue: false,\r\n  campaign_builder: false,\r\n  autopilot_level: 0,\r\n  superadmin_profitability: false,\r\n  max_campaigns: 20,\r\n  max_users: 5,\r\n  data_retention_days: 90,\r\n};\r\n\r\n// =============================================================================\r\n// Store\r\n// =============================================================================\r\n\r\nexport const useFeatureFlagsStore = create<FeatureFlagsState>()(\r\n  devtools(\r\n    (set, get) => ({\r\n      // Initial state\r\n      features: null,\r\n      categories: {},\r\n      descriptions: {},\r\n      isLoading: false,\r\n      error: null,\r\n\r\n      // Actions\r\n      setFeatures: (features) => set({ features, error: null }),\r\n\r\n      setMetadata: (categories, descriptions) => set({ categories, descriptions }),\r\n\r\n      setLoading: (isLoading) => set({ isLoading }),\r\n\r\n      setError: (error) => set({ error, isLoading: false }),\r\n\r\n      reset: () =>\r\n        set({\r\n          features: null,\r\n          isLoading: false,\r\n          error: null,\r\n        }),\r\n\r\n      // Gating helpers\r\n      can: (feature) => {\r\n        const { features } = get();\r\n        if (!features) return false;\r\n\r\n        const value = features[feature];\r\n        if (typeof value === 'boolean') return value;\r\n        if (typeof value === 'number') return value > 0;\r\n        return Boolean(value);\r\n      },\r\n\r\n      getAutopilotLevel: () => {\r\n        const { features } = get();\r\n        return features?.autopilot_level ?? 0;\r\n      },\r\n\r\n      isAutopilotBlocked: (signalHealthStatus) => {\r\n        const { features } = get();\r\n        if (!features) return true;\r\n\r\n        const level = features.autopilot_level;\r\n\r\n        // Level 0 (suggest only) is never \"blocked\" since it doesn't auto-execute\r\n        if (level === 0) return false;\r\n\r\n        // Block if signal health is degraded or critical\r\n        if (signalHealthStatus === 'degraded' || signalHealthStatus === 'critical') {\r\n          return true;\r\n        }\r\n\r\n        return false;\r\n      },\r\n    }),\r\n    { name: 'FeatureFlagsStore' }\r\n  )\r\n);\r\n\r\n// =============================================================================\r\n// Selectors\r\n// =============================================================================\r\n\r\nexport const selectFeatures = (state: FeatureFlagsState) => state.features;\r\nexport const selectIsLoading = (state: FeatureFlagsState) => state.isLoading;\r\nexport const selectError = (state: FeatureFlagsState) => state.error;\r\n\r\n// =============================================================================\r\n// Convenience Hooks\r\n// =============================================================================\r\n\r\nexport const useFeatures = () => useFeatureFlagsStore((state) => state.features);\r\nexport const useCanFeature = (feature: keyof FeatureFlags) =>\r\n  useFeatureFlagsStore((state) => state.can(feature));\r\nexport const useAutopilotLevel = () => useFeatureFlagsStore((state) => state.getAutopilotLevel());\r\n\r\n// =============================================================================\r\n// Feature Gating Component Helper\r\n// =============================================================================\r\n\r\n/**\r\n * Check if a feature is enabled.\r\n * Use this for conditional rendering in components.\r\n *\r\n * @example\r\n * if (can('signal_health')) {\r\n *   return <SignalHealthPanel />\r\n * }\r\n */\r\nexport function can(feature: keyof FeatureFlags): boolean {\r\n  return useFeatureFlagsStore.getState().can(feature);\r\n}\r\n\r\n/**\r\n * Get current autopilot level.\r\n * 0 = Suggest only\r\n * 1 = Guarded auto (safe actions with caps)\r\n * 2 = Approval required\r\n */\r\nexport function getAutopilotLevel(): number {\r\n  return useFeatureFlagsStore.getState().getAutopilotLevel();\r\n}\r\n\r\n/**\r\n * Check if autopilot is blocked due to signal health.\r\n */\r\nexport function isAutopilotBlocked(signalHealthStatus: string): boolean {\r\n  return useFeatureFlagsStore.getState().isAutopilotBlocked(signalHealthStatus);\r\n}\r\n"],"names":["create","devtools","set","get","features","categories","descriptions","isLoading","error","feature","value","signalHealthStatus"],"mappings":"iDA2FoCA,EAAA,EAClCC,EACE,CAACC,EAAKC,KAAS,CAEb,SAAU,KACV,WAAY,CAAA,EACZ,aAAc,CAAA,EACd,UAAW,GACX,MAAO,KAGP,YAAcC,GAAaF,EAAI,CAAE,SAAAE,EAAU,MAAO,KAAM,EAExD,YAAa,CAACC,EAAYC,IAAiBJ,EAAI,CAAE,WAAAG,EAAY,aAAAC,EAAc,EAE3E,WAAaC,GAAcL,EAAI,CAAE,UAAAK,EAAW,EAE5C,SAAWC,GAAUN,EAAI,CAAE,MAAAM,EAAO,UAAW,GAAO,EAEpD,MAAO,IACLN,EAAI,CACF,SAAU,KACV,UAAW,GACX,MAAO,IAAA,CACR,EAGH,IAAMO,GAAY,CAChB,KAAM,CAAE,SAAAL,CAAA,EAAaD,EAAA,EACrB,GAAI,CAACC,EAAU,MAAO,GAEtB,MAAMM,EAAQN,EAASK,CAAO,EAC9B,OAAI,OAAOC,GAAU,UAAkBA,EACnC,OAAOA,GAAU,SAAiBA,EAAQ,EACvC,EAAQA,CACjB,EAEA,kBAAmB,IAAM,CACvB,KAAM,CAAE,SAAAN,CAAA,EAAaD,EAAA,EACrB,OAAOC,GAAA,YAAAA,EAAU,kBAAmB,CACtC,EAEA,mBAAqBO,GAAuB,CAC1C,KAAM,CAAE,SAAAP,CAAA,EAAaD,EAAA,EACrB,OAAKC,EAESA,EAAS,kBAGT,EAAU,GAGpBO,IAAuB,YAAcA,IAAuB,WAR1C,EAaxB,CAAA,GAEF,CAAE,KAAM,mBAAA,CAAoB,CAEhC"}