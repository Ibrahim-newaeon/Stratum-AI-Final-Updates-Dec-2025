import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as h,f as le,u as ce}from"./vendor-react-Dz7uKsMg.js";import{T as de,K as pe,E as me}from"./KpiStrip-C0aZ-ZV9.js";import{E as ue,a as xe}from"./EmqTimeline-DxviryQA.js";import{t as K,c as F,h as H,ai as he,a6 as ye,b as W,j as ge,F as fe}from"./index-BQex3859.js";import{A as be}from"./ActionCard-CGNp1jhm.js";import{F as ve}from"./WrenchScrewdriverIcon-DJAaIhoQ.js";import{j as we,k as je}from"./hooks-B2vGXtE6.js";import{a as U,b as V}from"./vendor-query-BPt-n81V.js";import{g as Ae,b as Ne,c as $e,d as Se,e as ke}from"./emqV2-BxKuXu1r.js";import{F as Ie}from"./CalendarIcon-LISB5gLp.js";import{F as Ee}from"./DocumentArrowDownIcon-D3ixpsi6.js";import{F as Re}from"./UserIcon-LeInSHgb.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./ConfidenceBandBadge-BR4oR-ha.js";import"./BudgetAtRiskChip-BRCQCK-f.js";import"./XCircleIcon-Dk49lKz_.js";import"./UserCircleIcon-C5qf10f0.js";import"./ArrowTopRightOnSquareIcon-Cr7jBqzy.js";import"./ArrowTrendingDownIcon-DA5nft8Y.js";import"./BugAntIcon-BjOrFbnG.js";import"./ExclamationCircleIcon-C8aTdMTs.js";import"./vendor-motion-CR45sdSp.js";import"./CheckIcon-DQQhceDd.js";import"./featureFlagsStore-DvEl_DiZ.js";function Ce(r){const o=U();return V({mutationFn:async a=>(await K.post(`/autopilot/tenant/${r}/autopilot/actions`,a)).data.data,onSuccess:()=>{o.invalidateQueries({queryKey:["autopilot-actions",r]}),o.invalidateQueries({queryKey:["autopilot-status",r]}),o.invalidateQueries({queryKey:["autopilot-summary",r]})}})}function Fe(r){const o=U();return V({mutationFn:async a=>(await K.post(`/autopilot/tenant/${r}/autopilot/actions/${a}/approve`)).data.data.action,onSuccess:()=>{o.invalidateQueries({queryKey:["autopilot-actions",r]}),o.invalidateQueries({queryKey:["autopilot-status",r]})}})}function Te(r){const o=U();return V({mutationFn:async a=>(await K.post(`/autopilot/tenant/${r}/autopilot/actions/${a}/dismiss`)).data.data.action,onSuccess:()=>{o.invalidateQueries({queryKey:["autopilot-actions",r]}),o.invalidateQueries({queryKey:["autopilot-status",r]})}})}const Pe=[{type:"all",label:"All",icon:he},{type:"opportunity",label:"Opportunities",icon:ye},{type:"risk",label:"Risks",icon:H},{type:"recommendation",label:"Recommendations",icon:W},{type:"fix",label:"Fixes",icon:ve}];function De(r){switch(r){case"limited":return"Scaling capped at +10%. Some actions may be restricted.";case"cuts_only":return"Only pause and reduction actions are allowed.";case"frozen":return"All automation is paused. Fix data issues first.";default:return null}}function Oe({actions:r,autopilotMode:o="normal",onApply:a,onDismiss:l,onQueue:T,onApplyAll:g,maxActions:c=10,className:S}){const[p,k]=h.useState("all"),u=(p==="all"?r:r.filter(n=>n.type===p)).filter(n=>n.status==="pending"),w=u.slice(0,c),j=De(o),m=o==="frozen",I=r.reduce((n,y)=>(y.status==="pending"&&(n[y.type]=(n[y.type]||0)+1),n),{});return e.jsxs("div",{className:F("rounded-2xl bg-surface-secondary border border-white/10 overflow-hidden",S),children:[e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Actions"}),e.jsxs("p",{className:"text-sm text-text-muted",children:[u.length," actions pending"]})]}),g&&u.length>0&&!m&&e.jsxs("button",{onClick:()=>g(u),className:"text-sm text-stratum-400 hover:text-stratum-300 transition-colors",children:["Apply all (",u.length,")"]})]}),j&&e.jsxs("div",{className:F("flex items-center gap-2 mt-3 p-2 rounded-lg text-sm",o==="frozen"?"bg-danger/10 text-danger":"bg-warning/10 text-warning"),children:[e.jsx(H,{className:"w-4 h-4 flex-shrink-0"}),j]})]}),e.jsx("div",{className:"flex items-center gap-1 p-2 overflow-x-auto border-b border-white/10",children:Pe.map(n=>{const y=n.type==="all"?Object.values(I).reduce((D,O)=>D+O,0):I[n.type]||0,P=n.icon;return e.jsxs("button",{onClick:()=>k(n.type),className:F("flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm transition-colors whitespace-nowrap",p===n.type?"bg-stratum-500/10 text-stratum-400":"text-text-muted hover:text-white"),children:[e.jsx(P,{className:"w-4 h-4"}),n.label,y>0&&e.jsx("span",{className:F("text-xs px-1.5 py-0.5 rounded-full",p===n.type?"bg-stratum-500/20":"bg-surface-tertiary"),children:y})]},n.type)})}),e.jsx("div",{className:"p-4 space-y-3",children:w.length>0?w.map(n=>e.jsx(be,{action:n,onApply:a,onDismiss:l,onQueue:T,disabled:m,compact:!0},n.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-surface-tertiary flex items-center justify-center mx-auto mb-3",children:e.jsx(W,{className:"w-6 h-6 text-text-muted"})}),e.jsx("p",{className:"text-text-muted",children:"No pending actions"})]})}),u.length>c&&e.jsx("div",{className:"p-4 border-t border-white/10",children:e.jsxs("button",{className:"text-sm text-stratum-400 hover:text-stratum-300 transition-colors",children:["View all ",u.length," actions"]})})]})}function dt(){var z,B;const{tenantId:r}=le(),o=ce(),{toast:a}=ge(),l=parseInt(r||"1",10),[T,g]=h.useState(!1),[c,S]=h.useState(null),[p,k]=h.useState(""),[G,u]=h.useState(""),[w,j]=h.useState(!1),[m,I]=h.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[n,y]=h.useState("Last 30 days"),P=Fe(l),D=Te(l),O=Ce(l),A=Ae(l),{data:b}=Ne(l),{data:v}=$e(l),{data:J}=Se(l),{data:q}=ke(l,m.start,m.end),{data:d}=we(l),{data:N}=je(l),x=(b==null?void 0:b.score)??85,$=(v==null?void 0:v.mode)??"normal",E=(v==null?void 0:v.budgetAtRisk)??0,M=[{id:"spend",label:"Spend",value:((z=d==null?void 0:d.kpis)==null?void 0:z.total_spend)??45e3,format:"currency",previousValue:42e3,confidence:x},{id:"revenue",label:"Revenue",value:((B=d==null?void 0:d.kpis)==null?void 0:B.total_revenue)??18e4,format:"currency",previousValue:165e3,confidence:x},{id:"roas",label:"ROAS",value:(d==null?void 0:d.kpis.roas)??4,format:"multiplier",previousValue:3.9,confidence:x},{id:"cpa",label:"CPA",value:(d==null?void 0:d.kpis.cpa)??25,format:"currency",previousValue:28,trendIsPositive:!1,confidence:x}],L=J??[{id:"1",title:"Fix Meta pixel data loss",description:"Meta is reporting 15% lower conversions than GA4. Verify pixel implementation.",priority:"critical",owner:null,estimatedImpact:8,estimatedTime:"30 min",platform:"Meta",status:"pending",actionUrl:null},{id:"2",title:"Resolve Google Ads API timeout",description:"Intermittent connection issues causing data freshness delays.",priority:"high",owner:"Data Team",estimatedImpact:5,estimatedTime:"1 hour",platform:"Google",status:"in_progress",actionUrl:null}],X=(q==null?void 0:q.map(t=>({id:t.id,type:t.type,title:t.title,description:t.description??void 0,timestamp:new Date(t.timestamp),platform:t.platform??void 0,severity:t.severity,recoveryHours:t.recoveryHours??void 0,emqImpact:t.emqImpact??void 0})))??[{id:"1",type:"incident_opened",title:"Meta conversion tracking degraded",description:"Conversion attribution showing 20% variance from GA4",timestamp:new Date(Date.now()-2*60*60*1e3),platform:"Meta",severity:"high"},{id:"2",type:"recovery",title:"Google Ads sync restored",description:"API connection stable after maintenance",timestamp:new Date(Date.now()-24*60*60*1e3),platform:"Google",severity:"medium",recoveryHours:3,emqImpact:5}],Q=(Array.isArray(N)?N:(N==null?void 0:N.recommendations)||[]).map(t=>({id:t.id,type:t.priority==="high"?"opportunity":"recommendation",title:t.title,description:t.description,platform:t.platform??void 0,confidence:85,estimatedImpact:{metric:"ROAS",value:t.expectedImpact,unit:"%"},status:t.status==="approved"?"applied":"pending",priority:t.priority==="high"?1:2,createdAt:t.createdAt?new Date(t.createdAt):new Date}))??[{id:"1",type:"opportunity",title:"Increase budget on high-performing campaign",description:'Campaign "Summer Sale" has 5.2x ROAS, recommend 20% budget increase.',platform:"Meta",confidence:92,estimatedImpact:{metric:"Revenue",value:15,unit:"%"},status:"pending",priority:1,createdAt:new Date},{id:"2",type:"risk",title:"Pause underperforming ad set",description:'Ad set "Broad Targeting" has 0.8x ROAS over last 7 days.',platform:"Meta",confidence:88,estimatedImpact:{metric:"Waste",value:-2500,unit:"$"},status:"pending",priority:2,createdAt:new Date}],Y=()=>{o(`/tenant/${l}/signal-hub`)},Z=t=>{t.actionUrl?o(t.actionUrl):o(`/tenant/${l}/signal-hub?issue=${t.id}`)},ee=t=>{S(t),k(t.owner||""),u(""),g(!0)},te=h.useCallback(async()=>{if(!(!c||!p.trim()))try{await A.mutateAsync({itemId:c.id,updates:{owner:p.trim(),status:"in_progress"}}),a({title:"Assigned",description:`"${c.title}" assigned to ${p.trim()}.`}),g(!1),S(null)}catch(t){a({title:"Error",description:t instanceof Error?t.message:"Failed to assign item",variant:"destructive"})}},[c,p,A,a]),se=async t=>{try{await A.mutateAsync({itemId:t.id,updates:{status:"completed"}}),a({title:"Fix Applied",description:`Successfully applied: ${t.title}. Expected EMQ improvement: +${t.estimatedImpact}`})}catch(i){a({title:"Error",description:i instanceof Error?i.message:"Failed to apply fix",variant:"destructive"})}},ie=async t=>{try{await P.mutateAsync(t.id),a({title:"Action Applied",description:`Successfully applied: ${t.title}`})}catch(i){a({title:"Error",description:i instanceof Error?i.message:"Failed to apply action",variant:"destructive"})}},ae=async t=>{try{await D.mutateAsync(t.id),a({title:"Action Dismissed",description:`Dismissed: ${t.title}`})}catch(i){a({title:"Error",description:i instanceof Error?i.message:"Failed to dismiss action",variant:"destructive"})}},ne=async t=>{try{await O.mutateAsync({action_type:"budget_increase",entity_type:"campaign",entity_id:t.id,entity_name:t.title,platform:t.platform||"unknown",action_json:{description:t.description}}),a({title:"Action Queued",description:`Queued for later: ${t.title}`})}catch(i){a({title:"Error",description:i instanceof Error?i.message:"Failed to queue action",variant:"destructive"})}},re=()=>{const t=[{days:7,label:"Last 7 days"},{days:14,label:"Last 14 days"},{days:30,label:"Last 30 days"},{days:90,label:"Last 90 days"}],_=(t.findIndex(s=>s.label===n)+1)%t.length,R=t[_],C=new Date,f=new Date(Date.now()-R.days*24*60*60*1e3);I({start:f.toISOString().split("T")[0],end:C.toISOString().split("T")[0]}),y(R.label)},oe=h.useCallback(()=>{j(!0);try{const t={generatedAt:new Date().toISOString(),dateRange:m,emqScore:x,autopilotMode:$,budgetAtRisk:E,kpis:M.map(s=>({label:s.label,value:s.value,confidence:s.confidence})),playbook:L.map(s=>({title:s.title,priority:s.priority,owner:s.owner||"Unassigned",status:s.status,estimatedImpact:s.estimatedImpact,platform:s.platform||"-"})),actions:Q.map(s=>({title:s.title,type:s.type,platform:s.platform||"-",confidence:s.confidence,status:s.status,impact:`${s.estimatedImpact.value}${s.estimatedImpact.unit} ${s.estimatedImpact.metric}`}))},i=[];i.push("Stratum AI - Overview Report"),i.push(`Generated: ${new Date().toLocaleString()}`),i.push(`Date Range: ${m.start} to ${m.end}`),i.push(""),i.push(`EMQ Score: ${x}`),i.push(`Autopilot Mode: ${$}`),i.push(`Budget at Risk: $${E.toLocaleString()}`),i.push(""),i.push("--- KPIs ---"),i.push("Metric,Value,Confidence"),t.kpis.forEach(s=>i.push(`${s.label},${s.value},${s.confidence}%`)),i.push(""),i.push("--- Fix Playbook ---"),i.push("Title,Priority,Owner,Status,EMQ Impact,Platform"),t.playbook.forEach(s=>i.push(`"${s.title}",${s.priority},${s.owner},${s.status},+${s.estimatedImpact},${s.platform}`)),i.push(""),i.push("--- Actions ---"),i.push("Title,Type,Platform,Confidence,Status,Impact"),t.actions.forEach(s=>i.push(`"${s.title}",${s.type},${s.platform},${s.confidence}%,${s.status},${s.impact}`));const _=i.join(`
`),R=new Blob([_],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(R),f=document.createElement("a");f.href=C,f.download=`stratum-overview-report-${m.start}-to-${m.end}.csv`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(C),a({title:"Report Exported",description:"CSV report downloaded successfully."})}catch(t){a({title:"Export Failed",description:t instanceof Error?t.message:"Could not generate report",variant:"destructive"})}finally{j(!1)}},[m,x,$,E,M,L,Q,a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Overview"}),e.jsx("p",{className:"text-text-muted",children:"Trust & Performance Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:re,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-surface-secondary border border-white/10 text-text-secondary hover:text-white transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4"}),n]}),e.jsxs("button",{onClick:oe,disabled:w,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-stratum text-white font-medium hover:shadow-glow transition-all disabled:opacity-50",children:[e.jsx(Ee,{className:"w-4 h-4"}),w?"Exporting...":"Export Report"]})]})]}),e.jsx("div",{"data-tour":"trust-header",children:e.jsx(de,{emqScore:x,autopilotMode:$,budgetAtRisk:E,svi:25,onViewDetails:Y})}),e.jsx("div",{"data-tour":"kpi-strip",children:e.jsx(pe,{kpis:M,emqScore:x})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(ue,{score:x,previousScore:(b==null?void 0:b.previousScore)??82,showDrivers:!0}),e.jsx("div",{"data-tour":"fix-playbook",children:e.jsx(me,{items:L,onItemClick:Z,onAssign:ee,onApply:se,maxItems:5})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Oe,{actions:Q,autopilotMode:$,onApply:ie,onDismiss:ae,onQueue:ne,maxActions:5}),e.jsx(xe,{events:X,maxEvents:5})]})]}),T&&c&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:e.jsxs("div",{className:"bg-neutral-900 border border-white/10 rounded-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Assign Task"}),e.jsx("button",{onClick:()=>g(!1),className:"p-2 text-white/40 hover:text-white",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-white font-medium text-sm",children:c.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5 text-xs text-white/50",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-medium ${c.priority==="critical"?"bg-red-500/20 text-red-400":c.priority==="high"?"bg-orange-500/20 text-orange-400":"bg-yellow-500/20 text-yellow-400"}`,children:c.priority}),c.platform&&e.jsx("span",{children:c.platform}),c.estimatedTime&&e.jsx("span",{children:c.estimatedTime})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/70 mb-1.5",children:[e.jsx(Re,{className:"w-4 h-4 inline mr-1"}),"Assign to *"]}),e.jsxs("select",{value:p,onChange:t=>k(t.target.value),className:"w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-purple-500/50",children:[e.jsx("option",{value:"",className:"bg-neutral-900",children:"Select team member..."}),e.jsx("option",{value:"Data Team",className:"bg-neutral-900",children:"Data Team"}),e.jsx("option",{value:"Engineering",className:"bg-neutral-900",children:"Engineering"}),e.jsx("option",{value:"Marketing Ops",className:"bg-neutral-900",children:"Marketing Ops"}),e.jsx("option",{value:"Platform Lead",className:"bg-neutral-900",children:"Platform Lead"}),e.jsx("option",{value:"Analytics Team",className:"bg-neutral-900",children:"Analytics Team"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/70 mb-1.5",children:"Notes (optional)"}),e.jsx("textarea",{value:G,onChange:t=>u(t.target.value),rows:3,className:"w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/30 focus:outline-none focus:border-purple-500/50 resize-none",placeholder:"Additional context or instructions..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-white/10",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-white/60 hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:te,disabled:!p.trim()||A.isPending,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium disabled:opacity-50 transition-colors",children:A.isPending?"Assigning...":"Assign"})]})]})})]})}export{dt as default};
//# sourceMappingURL=Overview-LDuLNHwJ.js.map
