import{j as e}from"./vendor-ui-B0DL0VNC.js";import{f as $,r as f}from"./vendor-react-Dz7uKsMg.js";import{t as j,a9 as D,f as A,cU as I,c as C,ab as M,ac as E}from"./index-BQex3859.js";import{u as T,b as P}from"./vendor-query-BPt-n81V.js";import{R as O,B as Z,C as V,X as z,Y as B,T as q,a as G}from"./vendor-charts-Cj11RBfc.js";import{F as k}from"./XCircleIcon-Dk49lKz_.js";import{F as H}from"./UsersIcon-DrTPNDPP.js";import{m as u}from"./vendor-motion-CR45sdSp.js";import{F as K}from"./ArrowDownTrayIcon-BpDtmKr2.js";import{F as Q}from"./MagnifyingGlassIcon-3MUvqIvj.js";import"./vendor-utils-L2YjCnAZ.js";function X(i,s={}){return T({queryKey:["audit","logs",i,s],queryFn:async()=>{const r=new URLSearchParams;return s.page&&r.append("page",s.page.toString()),s.limit&&r.append("limit",s.limit.toString()),s.action&&r.append("action",s.action),s.userId&&r.append("user_id",s.userId.toString()),s.search&&r.append("search",s.search),(await j.get(`/tenants/${i}/audit?${r}`)).data.data},enabled:!!i,staleTime:30*1e3,placeholderData:{entries:[{id:"1",timestamp:"2024-12-10T14:32:00Z",userId:1,userName:"Sarah Miller",action:"update",resource:'Campaign "Holiday Sale"',details:"Updated budget from $500 to $750",status:"success",ipAddress:"192.168.1.42"},{id:"2",timestamp:"2024-12-10T13:15:00Z",userId:2,userName:"Ahmed Hassan",action:"create",resource:'Ad Set "Lookalike US"',details:"Created new ad set targeting US lookalike audience",status:"success",ipAddress:"10.0.0.15"},{id:"3",timestamp:"2024-12-10T12:45:00Z",userId:1,userName:"Sarah Miller",action:"sync",resource:"Meta Ads",details:"Manual sync triggered for all campaigns",status:"success",ipAddress:"192.168.1.42"},{id:"4",timestamp:"2024-12-10T11:20:00Z",userId:3,userName:"Carlos Rivera",action:"export",resource:"Performance Report",details:"Exported 30-day performance report as CSV",status:"success",ipAddress:"172.16.0.8"},{id:"5",timestamp:"2024-12-10T10:05:00Z",userId:2,userName:"Ahmed Hassan",action:"delete",resource:'Draft "Test Campaign Q1"',details:"Deleted campaign draft",status:"success",ipAddress:"10.0.0.15"},{id:"6",timestamp:"2024-12-10T09:30:00Z",userId:4,userName:"Emily Chen",action:"login",resource:"Dashboard",details:"Logged in via SSO",status:"success",ipAddress:"203.0.113.50"},{id:"7",timestamp:"2024-12-09T16:45:00Z",userId:1,userName:"Sarah Miller",action:"invite",resource:"Team",details:"Invited newuser@company.com as Analyst",status:"success",ipAddress:"192.168.1.42"},{id:"8",timestamp:"2024-12-09T15:10:00Z",userId:3,userName:"Carlos Rivera",action:"update",resource:'Campaign "Brand Awareness"',details:"Paused campaign due to high CPA",status:"failure",ipAddress:"172.16.0.8"}],total:156,page:1,limit:20}})}function Y(i,s="14d"){return T({queryKey:["audit","stats",i,s],queryFn:async()=>(await j.get(`/tenants/${i}/audit/stats?period=${s}`)).data.data,enabled:!!i,staleTime:60*1e3,placeholderData:{totalEvents:1284,successful:1247,failed:37,activeUsers:8,dailyVolume:Array.from({length:14},(r,l)=>({date:new Date(Date.now()-(13-l)*864e5).toISOString().split("T")[0],count:Math.floor(60+Math.random()*80)})),byAction:[{action:"update",count:456},{action:"create",count:312},{action:"login",count:248},{action:"sync",count:128},{action:"export",count:76},{action:"delete",count:42},{action:"invite",count:14},{action:"logout",count:8}]}})}function _(i){return P({mutationFn:async s=>{const r=await j.post(`/tenants/${i}/audit/export`,s,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([r.data])),o=document.createElement("a");o.href=l,o.download=`audit-log-${i}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(l)}})}function J({data:i,height:s=200,color:r="#00c7be"}){const l=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsx(O,{width:"100%",height:s,children:e.jsxs(Z,{data:i,margin:{top:4,right:4,bottom:0,left:-20},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"activityGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:r,stopOpacity:.8}),e.jsx("stop",{offset:"100%",stopColor:r,stopOpacity:.3})]})}),e.jsx(V,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.05)",vertical:!1}),e.jsx(z,{dataKey:"date",tickFormatter:l,tick:{fontSize:11,fill:"rgba(245,245,247,0.4)"},axisLine:!1,tickLine:!1}),e.jsx(B,{tick:{fontSize:11,fill:"rgba(245,245,247,0.4)"},axisLine:!1,tickLine:!1}),e.jsx(q,{contentStyle:{background:"rgba(11, 18, 21, 0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",fontSize:12,color:"rgba(245,245,247,0.92)"},labelFormatter:o=>l(String(o)),formatter:o=>[String(o),"Events"]}),e.jsx(G,{dataKey:"count",fill:"url(#activityGradient)",radius:[4,4,0,0]})]})})}const m={initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.3}},b={create:{color:"text-green-400",bg:"bg-green-500/10"},update:{color:"text-blue-400",bg:"bg-blue-500/10"},delete:{color:"text-red-400",bg:"bg-red-500/10"},login:{color:"text-purple-400",bg:"bg-purple-500/10"},logout:{color:"text-gray-400",bg:"bg-gray-500/10"},export:{color:"text-amber-400",bg:"bg-amber-500/10"},sync:{color:"text-cyan-400",bg:"bg-cyan-500/10"},invite:{color:"text-indigo-400",bg:"bg-indigo-500/10"}};function ce(){var w,v,N,S;const{tenantId:i}=$(),s=i?parseInt(i,10):0,[r,l]=f.useState(""),[o,y]=f.useState(""),[d,p]=f.useState(1),c=20,{data:n,isLoading:L}=X(s,{page:d,limit:c,action:o||void 0,search:r||void 0}),{data:a}=Y(s),x=_(s),g=n?Math.ceil(n.total/c):1,F=t=>new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=[{label:"Total Events",value:((w=a==null?void 0:a.totalEvents)==null?void 0:w.toLocaleString())??"0",icon:D,color:"text-blue-500"},{label:"Successful",value:((v=a==null?void 0:a.successful)==null?void 0:v.toLocaleString())??"0",icon:A,color:"text-green-500"},{label:"Failed",value:((N=a==null?void 0:a.failed)==null?void 0:N.toLocaleString())??"0",icon:k,color:"text-red-500"},{label:"Active Users",value:((S=a==null?void 0:a.activeUsers)==null?void 0:S.toString())??"0",icon:H,color:"text-purple-500"}];return e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsx("title",{children:"Audit Log | Stratum AI"})}),e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[e.jsxs(u.div,{className:"flex items-center justify-between",...m,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Audit Log"}),e.jsx("p",{className:"text-muted-foreground",children:"Track all user activity and system events"})]}),e.jsxs("button",{onClick:()=>x.mutate({}),disabled:x.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-white/10 hover:bg-white/5 transition-colors text-sm",children:[e.jsx(K,{className:"h-4 w-4"}),x.isPending?"Exporting...":"Export CSV"]})]}),e.jsx(u.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",...m,transition:{delay:.1},children:R.map(t=>e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-white/5",children:e.jsx(t.icon,{className:C("h-5 w-5",t.color)})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t.label}),e.jsx("p",{className:"text-xl font-bold",children:t.value})]})]})},t.label))}),(a==null?void 0:a.dailyVolume)&&a.dailyVolume.length>0&&e.jsxs(u.div,{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-6",...m,transition:{delay:.15},children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Activity by Day"}),e.jsx(J,{data:a.dailyVolume,height:180})]}),e.jsxs(u.div,{className:"flex items-center gap-3",...m,transition:{delay:.2},children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search by user, resource, or details...",value:r,onChange:t=>{l(t.target.value),p(1)},className:"w-full pl-9 pr-4 py-2 rounded-lg border border-white/10 bg-white/5 focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm"})]}),e.jsxs("select",{value:o,onChange:t=>{y(t.target.value),p(1)},className:"px-3 py-2 rounded-lg border border-white/10 bg-white/5 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"All Actions"}),Object.keys(b).map(t=>e.jsx("option",{value:t,className:"capitalize",children:t},t))]})]}),e.jsxs(u.div,{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm overflow-hidden",...m,transition:{delay:.25},children:[L?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-white/10 bg-white/5",children:["Timestamp","User","Action","Resource","Details","Status","IP"].map(t=>e.jsx("th",{className:"text-left py-3 px-4 text-xs font-medium text-muted-foreground uppercase tracking-wider",children:t},t))})}),e.jsx("tbody",{children:((n==null?void 0:n.entries)||[]).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-12 text-center text-muted-foreground text-sm",children:"No audit log entries found"})}):((n==null?void 0:n.entries)||[]).map(t=>{const h=b[t.action]||b.update;return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-xs text-muted-foreground whitespace-nowrap",children:F(t.timestamp)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-7 w-7 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-medium text-primary",children:t.userName.split(" ").map(U=>U[0]).join("").toUpperCase()})}),e.jsx("span",{className:"text-sm",children:t.userName})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:C("px-2 py-0.5 rounded-full text-xs font-medium capitalize",h.bg,h.color),children:t.action})}),e.jsx("td",{className:"py-3 px-4 text-sm max-w-[200px] truncate",children:t.resource}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground max-w-[250px] truncate",children:t.details}),e.jsx("td",{className:"py-3 px-4",children:t.status==="success"?e.jsx(A,{className:"h-4 w-4 text-green-500"}):e.jsx(k,{className:"h-4 w-4 text-red-500"})}),e.jsx("td",{className:"py-3 px-4 text-xs text-muted-foreground font-mono",children:t.ipAddress})]},t.id)})})]})}),n&&n.total>c&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-white/10",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Showing ",(d-1)*c+1,"-",Math.min(d*c,n.total)," of"," ",n.total]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>p(t=>Math.max(1,t-1)),disabled:d===1,className:"p-1.5 rounded-lg hover:bg-white/5 disabled:opacity-30 transition-colors",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm px-3",children:[d," / ",g]}),e.jsx("button",{onClick:()=>p(t=>Math.min(g,t+1)),disabled:d===g,className:"p-1.5 rounded-lg hover:bg-white/5 disabled:opacity-30 transition-colors",children:e.jsx(E,{className:"h-4 w-4"})})]})]})]})]})]})}export{ce as default};
//# sourceMappingURL=AuditLog-BaCmCloP.js.map
