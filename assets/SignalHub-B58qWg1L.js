import{j as e}from"./vendor-ui-B0DL0VNC.js";import{f as G,r}from"./vendor-react-Dz7uKsMg.js";import{j as B,d8 as Q,a7 as Y,c as m,a9 as J,a5 as K,f as U,F as W}from"./index-BQex3859.js";import{V as X,E as Z,a as _}from"./EmqTimeline-DxviryQA.js";import{b as ee,h as te,e as se}from"./emqV2-BxKuXu1r.js";import"./featureFlagsStore-DvEl_DiZ.js";import{F as A}from"./ExclamationCircleIcon-C8aTdMTs.js";import{F as ae}from"./BugAntIcon-BjOrFbnG.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";import"./ArrowTrendingDownIcon-DA5nft8Y.js";import"./ConfidenceBandBadge-BR4oR-ha.js";function je(){const{tenantId:R}=G(),x=parseInt(R||"1",10),{toast:l}=B(),[v,D]=r.useState(null),[h,j]=r.useState(null),[k,C]=r.useState(new Set),[w,F]=r.useState({}),[g,d]=r.useState(null),[c,o]=r.useState(""),[u,b]=r.useState(!1),N={start:new Date(Date.now()-7*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]},{data:n,refetch:M}=ee(x),{data:p,refetch:E}=te(x),{data:f,refetch:P}=se(x,N.start,N.end),y=(n==null?void 0:n.score)??85,$=(p==null?void 0:p.svi)??25,L=[{platform:"Meta",status:"degraded",freshness:92,dataLoss:82,variance:65,errors:98,lastSync:new Date(Date.now()-15*60*1e3),activeIncidents:1},{platform:"Google",status:"healthy",freshness:98,dataLoss:96,variance:94,errors:99,lastSync:new Date(Date.now()-5*60*1e3),activeIncidents:0},{platform:"TikTok",status:"healthy",freshness:95,dataLoss:93,variance:88,errors:97,lastSync:new Date(Date.now()-10*60*1e3),activeIncidents:0},{platform:"Snapchat",status:"critical",freshness:45,dataLoss:78,variance:55,errors:82,lastSync:new Date(Date.now()-4*60*60*1e3),activeIncidents:2},{platform:"GA4",status:"healthy",freshness:97,dataLoss:95,variance:91,errors:99,lastSync:new Date(Date.now()-3*60*1e3),activeIncidents:0}],T=[{id:"1",platform:"Meta",title:"Conversion tracking variance",description:"Meta conversions 18% lower than GA4 attribution",driver:"variance",severity:"high",openedAt:new Date(Date.now()-4*60*60*1e3),resolvedAt:null,mttr:null,rootCause:null,actions:[{action:"Verify pixel implementation",completedAt:null},{action:"Check CAPI configuration",completedAt:null},{action:"Review attribution windows",completedAt:null}]},{id:"2",platform:"Snapchat",title:"API connection timeout",description:"Snapchat API returning 504 errors intermittently",driver:"freshness",severity:"critical",openedAt:new Date(Date.now()-6*60*60*1e3),resolvedAt:null,mttr:null,rootCause:null,actions:[{action:"Check API credentials",completedAt:new Date(Date.now()-5*60*60*1e3)},{action:"Contact Snapchat support",completedAt:null}]}],q=(f==null?void 0:f.map(t=>({id:t.id,type:t.type,title:t.title,description:t.description??void 0,timestamp:new Date(t.timestamp),platform:t.platform??void 0,severity:t.severity,recoveryHours:t.recoveryHours??void 0,emqImpact:t.emqImpact??void 0})))??[],V=t=>{switch(t){case"healthy":return"text-success bg-success/10 border-success/20";case"degraded":return"text-warning bg-warning/10 border-warning/20";case"critical":return"text-danger bg-danger/10 border-danger/20"}},S=t=>{const a=Math.floor((Date.now()-t.getTime())/6e4);if(a<60)return`${a}m ago`;const s=Math.floor(a/60);return s<24?`${s}h ago`:`${Math.floor(s/24)}d ago`},H=(t,a)=>{C(s=>{const i=new Set(s);return i.add(t),i}),j(null),l({title:"Incident Resolved",description:`"${a}" has been marked as resolved.`})},O=t=>{c.trim()&&(F(a=>({...a,[t]:[...a[t]||[],c.trim()]})),o(""),d(null),l({title:"Note Added",description:"Your note has been added to the incident."}))},z=async()=>{b(!0);try{await Promise.all([M(),E(),P()]),l({title:"Data Refreshed",description:"All signal data has been refreshed."})}catch{l({title:"Refresh Failed",description:"Failed to refresh data. Please try again.",variant:"destructive"})}finally{b(!1)}},I=T.filter(t=>!t.resolvedAt&&!k.has(t.id));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Signal Hub"}),e.jsx("p",{className:"text-text-muted",children:"Diagnose signal issues, recover fast"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-surface-secondary border border-white/10",children:[e.jsx(Q,{className:"w-5 h-5 text-stratum-400"}),e.jsx("span",{className:"text-white font-semibold",children:y}),e.jsx("span",{className:"text-text-muted",children:"EMQ"})]}),e.jsx("div",{"data-tour":"volatility-badge",children:e.jsx(X,{svi:$,showValue:!0})}),e.jsxs("button",{onClick:z,disabled:u,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-surface-secondary border border-white/10 text-text-secondary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Y,{className:m("w-4 h-4",u&&"animate-spin")}),u?"Refreshing...":"Refresh All"]})]})]}),e.jsx("div",{"data-tour":"platform-signals",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:L.map(t=>e.jsxs("button",{onClick:()=>D(v===t.platform?null:t.platform),className:m("p-4 rounded-xl border transition-all text-left",v===t.platform?"ring-2 ring-stratum-500":"hover:border-white/20",V(t.status)),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-semibold text-white",children:t.platform}),t.activeIncidents>0&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-danger/20 text-danger",children:[t.activeIncidents," active"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsxs("span",{className:t.freshness>=90?"text-success":t.freshness>=70?"text-warning":"text-danger",children:[t.freshness,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),e.jsxs("span",{className:t.dataLoss>=90?"text-success":t.dataLoss>=70?"text-warning":"text-danger",children:[t.dataLoss,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),e.jsxs("span",{className:t.variance>=90?"text-success":t.variance>=70?"text-warning":"text-danger",children:[t.variance,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsxs("span",{className:t.errors>=90?"text-success":t.errors>=70?"text-warning":"text-danger",children:[t.errors,"%"]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 text-xs text-text-muted",children:["Last sync: ",S(t.lastSync)]})]},t.platform))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{"data-tour":"emq-drivers",children:e.jsx(Z,{score:y,previousScore:(n==null?void 0:n.previousScore)??82,showDrivers:!0})}),e.jsxs("div",{"data-tour":"active-incidents",className:"rounded-2xl bg-surface-secondary border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-danger/10",children:e.jsx(A,{className:"w-5 h-5 text-danger"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Active Incidents"}),e.jsxs("p",{className:"text-sm text-text-muted",children:[I.length," open"]})]})]})}),e.jsx("div",{className:"divide-y divide-white/5",children:I.map(t=>{var a;return e.jsxs("div",{className:m("p-4 transition-colors cursor-pointer hover:bg-white/5",h===t.id&&"bg-white/5"),onClick:()=>j(h===t.id?null:t.id),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs bg-surface-tertiary text-text-muted px-2 py-0.5 rounded",children:t.platform}),e.jsx("span",{className:m("text-xs px-2 py-0.5 rounded",t.severity==="critical"&&"bg-danger/10 text-danger",t.severity==="high"&&"bg-orange-500/10 text-orange-400",t.severity==="medium"&&"bg-warning/10 text-warning"),children:t.severity})]}),e.jsx("h4",{className:"font-medium text-white",children:t.title}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:t.description})]}),e.jsx("span",{className:"text-xs text-text-muted",children:S(t.openedAt)})]}),h===t.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-text-muted",children:"Driver:"})," ",e.jsx("span",{className:"text-white capitalize",children:t.driver})]}),e.jsxs("div",{"data-tour":"resolution-steps",children:[e.jsx("span",{className:"text-sm text-text-muted block mb-2",children:"Resolution steps:"}),e.jsx("div",{className:"space-y-2",children:t.actions.map((s,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.completedAt?e.jsx(U,{className:"w-4 h-4 text-success"}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-white/20"}),e.jsx("span",{className:s.completedAt?"text-text-muted line-through":"text-white",children:s.action})]},i))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),H(t.id,t.title)},className:"flex-1 py-2 rounded-lg bg-success/10 text-success text-sm font-medium hover:bg-success/20 transition-colors",children:"Mark Resolved"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),d(t.id)},className:"py-2 px-4 rounded-lg bg-surface-tertiary text-text-secondary text-sm hover:text-white transition-colors",children:"Add Note"})]}),((a=w[t.id])==null?void 0:a.length)>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsx("span",{className:"text-sm text-text-muted block mb-2",children:"Notes:"}),e.jsx("div",{className:"space-y-1",children:w[t.id].map((s,i)=>e.jsx("div",{className:"text-sm text-white bg-surface-tertiary px-3 py-2 rounded",children:s},i))})]})]})]},t.id)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{"data-tour":"recovery-metrics",className:"rounded-2xl bg-surface-secondary border border-white/10 p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-4",children:"Recovery Metrics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-text-muted",children:"Avg MTTR"}),e.jsx("span",{className:"text-white font-medium",children:"2.4 hours"})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full w-2/3 bg-success rounded-full"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-text-muted",children:"Resolution Rate"}),e.jsx("span",{className:"text-white font-medium",children:"92%"})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full w-[92%] bg-success rounded-full"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-text-muted",children:"Repeat Incidents"}),e.jsx("span",{className:"text-warning font-medium",children:"15%"})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full w-[15%] bg-warning rounded-full"})})]})]})]}),e.jsx(_,{events:q,maxEvents:8})]})]}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-surface-secondary rounded-xl border border-white/10 p-6 w-full max-w-md mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Add Note"}),e.jsx("button",{onClick:()=>{d(null),o("")},className:"p-1 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx("textarea",{value:c,onChange:t=>o(t.target.value),placeholder:"Enter your note...",className:"w-full h-32 px-3 py-2 rounded-lg bg-surface-tertiary border border-white/10 text-white placeholder:text-text-muted resize-none focus:outline-none focus:ring-2 focus:ring-stratum-500",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{d(null),o("")},className:"flex-1 py-2 rounded-lg bg-surface-tertiary text-text-secondary hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>O(g),disabled:!c.trim(),className:"flex-1 py-2 rounded-lg bg-stratum-500 text-white font-medium hover:bg-stratum-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Note"})]})]})})]})}export{je as default};
//# sourceMappingURL=SignalHub-B58qWg1L.js.map
