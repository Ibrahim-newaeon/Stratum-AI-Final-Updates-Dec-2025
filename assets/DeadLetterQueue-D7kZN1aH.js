import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as o}from"./vendor-react-Dz7uKsMg.js";import{u as w,a as h,b as g}from"./vendor-query-BPt-n81V.js";import{a7 as b,c,a9 as P,f as y,ai as A,e as L,t as n}from"./index-BQex3859.js";import{F as v}from"./XCircleIcon-Dk49lKz_.js";import{F as M}from"./TrashIcon-DR9paOX4.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-motion-CR45sdSp.js";function $({title:s,titleId:a,...l},f){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":a},l),s?o.createElement("title",{id:a},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m5.231 13.481L15 17.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v16.5c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Zm3.75 11.625a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"}))}const D=o.forwardRef($),x={getEntries:async s=>(await n.get("/capi/dead-letter-queue",{params:s})).data.data,getEntry:async s=>(await n.get(`/capi/dead-letter-queue/${s}`)).data.data,getStats:async()=>(await n.get("/capi/dead-letter-queue/stats")).data.data,retryEntry:async s=>(await n.post(`/capi/dead-letter-queue/${s}/retry`)).data.data,retryAll:async s=>(await n.post("/capi/dead-letter-queue/retry-all",s)).data.data,resolveEntry:async(s,a)=>(await n.post(`/capi/dead-letter-queue/${s}/resolve`,{reason:a})).data.data,deleteEntry:async s=>(await n.delete(`/capi/dead-letter-queue/${s}`)).data,purgeResolved:async s=>(await n.post("/capi/dead-letter-queue/purge",{olderThan:s})).data.data};function Q(s){return w({queryKey:["dlq","entries",s],queryFn:()=>x.getEntries(s),refetchInterval:3e4})}function I(){return w({queryKey:["dlq","stats"],queryFn:x.getStats,refetchInterval:3e4})}function T(){const s=h();return g({mutationFn:x.retryEntry,onSuccess:()=>{s.invalidateQueries({queryKey:["dlq"]})}})}function K(){const s=h();return g({mutationFn:x.retryAll,onSuccess:()=>{s.invalidateQueries({queryKey:["dlq"]})}})}function z(){const s=h();return g({mutationFn:({entryId:a,reason:l})=>x.resolveEntry(a,l),onSuccess:()=>{s.invalidateQueries({queryKey:["dlq"]})}})}function O(){const s=h();return g({mutationFn:x.deleteEntry,onSuccess:()=>{s.invalidateQueries({queryKey:["dlq"]})}})}const G={pending:"bg-amber-100 dark:bg-amber-900/20 text-amber-700 dark:text-amber-300",retrying:"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300",failed:"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300",resolved:"bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300"},N={meta:"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300",google:"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300",tiktok:"bg-pink-100 dark:bg-pink-900/20 text-pink-700 dark:text-pink-300",snapchat:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300"};function _(){const[s,a]=o.useState(""),[l,f]=o.useState(""),[i,k]=o.useState(null),[E,m]=o.useState(!1),{data:d}=I(),{data:r}=Q({status:s||void 0,platform:l||void 0,limit:100}),u=T(),j=K(),q=z(),C=O(),R=()=>{window.confirm("Are you sure you want to retry all pending and failed entries?")&&j.mutate({status:s||void 0,platform:l||void 0})},S=t=>{const p=window.prompt("Enter resolution reason:");p&&q.mutate({entryId:t.id,reason:p})},F=t=>{window.confirm("Are you sure you want to delete this entry? This cannot be undone.")&&C.mutate(t.id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dead Letter Queue"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage failed CAPI events and retry delivery"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:R,disabled:j.isPending||!(r!=null&&r.length),className:"flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-muted disabled:opacity-50",children:[e.jsx(b,{className:c("h-4 w-4",j.isPending&&"animate-spin")}),"Retry All"]})})]}),d&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"})]}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:d.total.toLocaleString()})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-amber-500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]}),e.jsx("p",{className:"text-2xl font-bold mt-1 text-amber-600",children:d.pending.toLocaleString()})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-blue-500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Retrying"})]}),e.jsx("p",{className:"text-2xl font-bold mt-1 text-blue-600",children:d.retrying.toLocaleString()})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed"})]}),e.jsx("p",{className:"text-2xl font-bold mt-1 text-red-600",children:d.failed.toLocaleString()})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-emerald-500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold mt-1 text-emerald-600",children:d.resolved.toLocaleString()})]})]}),d&&e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Failures by Platform"}),e.jsx("div",{className:"flex gap-4 flex-wrap",children:Object.entries(d.byPlatform).map(([t,p])=>e.jsxs("div",{className:c("px-4 py-2 rounded-lg flex items-center gap-2",N[t]),children:[e.jsx("span",{className:"font-medium capitalize",children:t}),e.jsx("span",{className:"text-lg font-bold",children:p})]},t))})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl border bg-card",children:[e.jsx(A,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("select",{value:s,onChange:t=>a(t.target.value),className:"px-3 py-2 rounded-lg border bg-background",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"retrying",children:"Retrying"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"resolved",children:"Resolved"})]}),e.jsxs("select",{value:l,onChange:t=>f(t.target.value),className:"px-3 py-2 rounded-lg border bg-background",children:[e.jsx("option",{value:"",children:"All Platforms"}),e.jsx("option",{value:"meta",children:"Meta"}),e.jsx("option",{value:"google",children:"Google"}),e.jsx("option",{value:"tiktok",children:"TikTok"}),e.jsx("option",{value:"snapchat",children:"Snapchat"})]})]}),e.jsx("div",{className:"rounded-xl border bg-card shadow-card overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Platform"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Error"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:"Retries"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"First Failed"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:(r==null?void 0:r.length)===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-12 text-center",children:[e.jsx(y,{className:"h-12 w-12 mx-auto text-emerald-500 mb-3"}),e.jsx("p",{className:"text-lg font-medium",children:"No Failed Events"}),e.jsx("p",{className:"text-muted-foreground",children:"All CAPI events are being delivered successfully"})]})}):r==null?void 0:r.map(t=>e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium",children:t.eventType}),e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:[t.eventId.slice(0,12),"..."]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:c("px-2 py-1 rounded text-xs capitalize",N[t.platform]),children:t.platform})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 truncate max-w-xs",children:t.errorMessage}),t.errorCode&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Code: ",t.errorCode]})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:c("font-medium",t.retryCount>=t.maxRetries?"text-red-600":""),children:[t.retryCount,"/",t.maxRetries]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:c("px-2 py-1 rounded-full text-xs",G[t.status]),children:t.status})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.firstFailedAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>{k(t),m(!0)},className:"p-2 rounded hover:bg-muted",title:"View Payload",children:e.jsx(L,{className:"h-4 w-4"})}),t.status!=="resolved"&&e.jsx("button",{onClick:()=>u.mutate(t.id),disabled:u.isPending,className:"p-2 rounded hover:bg-muted text-blue-600",title:"Retry",children:e.jsx(b,{className:c("h-4 w-4",u.isPending&&"animate-spin")})}),t.status!=="resolved"&&e.jsx("button",{onClick:()=>S(t),className:"p-2 rounded hover:bg-muted text-emerald-600",title:"Mark Resolved",children:e.jsx(y,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>F(t),className:"p-2 rounded hover:bg-muted text-red-600",title:"Delete",children:e.jsx(M,{className:"h-4 w-4"})})]})})]},t.id))})]})}),E&&i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-card rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Event Payload"}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 rounded hover:bg-muted",children:e.jsx(v,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 overflow-auto max-h-[60vh]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Event ID"}),e.jsx("p",{className:"font-mono text-sm",children:i.eventId})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Event Type"}),e.jsx("p",{className:"font-medium",children:i.eventType})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Error Message"}),e.jsx("p",{className:"text-red-600",children:i.errorMessage})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Payload"}),e.jsx("pre",{className:"bg-muted rounded-lg p-4 overflow-auto text-xs font-mono",children:JSON.stringify(i.payload,null,2)})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 rounded-lg border hover:bg-muted",children:"Close"}),e.jsx("button",{onClick:()=>{u.mutate(i.id),m(!1)},disabled:i.status==="resolved",className:"px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:"Retry Event"})]})]})})]})}export{_ as default};
//# sourceMappingURL=DeadLetterQueue-D7kZN1aH.js.map
