{"version":3,"file":"predictions-CzIV1TLQ.js","sources":["../../src/api/predictions.ts"],"sourcesContent":["/**\r\n * Stratum AI - Predictions & Optimization API\r\n *\r\n * ML-powered predictions and budget optimization\r\n */\r\n\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiClient, ApiResponse } from './client';\r\n\r\n// Types\r\nexport type PredictionType = 'roas' | 'conversions' | 'spend' | 'cpa';\r\nexport type AlertSeverity = 'info' | 'warning' | 'critical';\r\n\r\nexport interface Prediction {\r\n  id: string;\r\n  type: PredictionType;\r\n  campaignId: string;\r\n  campaignName: string;\r\n  platform: string;\r\n  currentValue: number;\r\n  predictedValue: number;\r\n  confidence: number;\r\n  timeframe: string;\r\n  trend: 'up' | 'down' | 'flat';\r\n  factors: {\r\n    name: string;\r\n    impact: number;\r\n    direction: 'positive' | 'negative';\r\n  }[];\r\n  createdAt: string;\r\n}\r\n\r\nexport interface PredictionAlert {\r\n  id: string;\r\n  predictionId: string;\r\n  severity: AlertSeverity;\r\n  title: string;\r\n  message: string;\r\n  campaignId: string;\r\n  platform: string;\r\n  suggestedAction: string | null;\r\n  isRead: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface BudgetOptimization {\r\n  id: string;\r\n  totalBudget: number;\r\n  optimizedAllocation: {\r\n    campaignId: string;\r\n    campaignName: string;\r\n    platform: string;\r\n    currentBudget: number;\r\n    recommendedBudget: number;\r\n    expectedRoasChange: number;\r\n    confidence: number;\r\n  }[];\r\n  estimatedImpact: {\r\n    currentRoas: number;\r\n    projectedRoas: number;\r\n    revenueChange: number;\r\n  };\r\n  createdAt: string;\r\n}\r\n\r\nexport interface Scenario {\r\n  id: string;\r\n  name: string;\r\n  description: string | null;\r\n  budgetChange: number;\r\n  parameters: Record<string, unknown>;\r\n  results: {\r\n    metric: string;\r\n    currentValue: number;\r\n    projectedValue: number;\r\n    change: number;\r\n    confidence: number;\r\n  }[];\r\n  createdAt: string;\r\n}\r\n\r\nexport interface CreateScenarioRequest {\r\n  name: string;\r\n  description?: string;\r\n  budgetChange: number;\r\n  parameters?: Record<string, unknown>;\r\n}\r\n\r\n// API Functions\r\nexport const predictionsApi = {\r\n  /**\r\n   * Get live predictions\r\n   */\r\n  getLivePredictions: async (): Promise<Prediction[]> => {\r\n    const response = await apiClient.get<ApiResponse<Prediction[]>>('/predictions/live');\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Get predictions for a campaign\r\n   */\r\n  getCampaignPredictions: async (campaignId: string): Promise<Prediction[]> => {\r\n    const response = await apiClient.get<ApiResponse<Prediction[]>>(\r\n      `/predictions/campaigns/${campaignId}`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Get prediction alerts\r\n   */\r\n  getPredictionAlerts: async (unreadOnly: boolean = false): Promise<PredictionAlert[]> => {\r\n    const response = await apiClient.get<ApiResponse<PredictionAlert[]>>('/predictions/alerts', {\r\n      params: { unread_only: unreadOnly },\r\n    });\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Mark alert as read\r\n   */\r\n  markAlertRead: async (id: string): Promise<void> => {\r\n    await apiClient.post(`/predictions/alerts/${id}/read`);\r\n  },\r\n\r\n  /**\r\n   * Refresh predictions\r\n   */\r\n  refreshPredictions: async (): Promise<{ success: boolean }> => {\r\n    const response =\r\n      await apiClient.post<ApiResponse<{ success: boolean }>>('/predictions/refresh');\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Get budget optimization recommendations\r\n   */\r\n  getBudgetOptimization: async (totalBudget?: number): Promise<BudgetOptimization> => {\r\n    const params = totalBudget ? { total_budget: totalBudget } : {};\r\n    const response = await apiClient.get<ApiResponse<BudgetOptimization>>(\r\n      '/predictions/budget-optimization',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Apply budget optimization\r\n   */\r\n  applyBudgetOptimization: async (optimizationId: string): Promise<{ success: boolean }> => {\r\n    const response = await apiClient.post<ApiResponse<{ success: boolean }>>(\r\n      `/predictions/budget-optimization/${optimizationId}/apply`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Get all scenarios\r\n   */\r\n  getScenarios: async (): Promise<Scenario[]> => {\r\n    const response = await apiClient.get<ApiResponse<Scenario[]>>('/predictions/scenarios');\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Create a scenario\r\n   */\r\n  createScenario: async (data: CreateScenarioRequest): Promise<Scenario> => {\r\n    const response = await apiClient.post<ApiResponse<Scenario>>('/predictions/scenarios', data);\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Get scenario by ID\r\n   */\r\n  getScenario: async (id: string): Promise<Scenario> => {\r\n    const response = await apiClient.get<ApiResponse<Scenario>>(`/predictions/scenarios/${id}`);\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Delete a scenario\r\n   */\r\n  deleteScenario: async (id: string): Promise<void> => {\r\n    await apiClient.delete(`/predictions/scenarios/${id}`);\r\n  },\r\n};\r\n\r\n// React Query Hooks\r\n\r\nexport function useLivePredictions() {\r\n  return useQuery({\r\n    queryKey: ['predictions', 'live'],\r\n    queryFn: predictionsApi.getLivePredictions,\r\n    staleTime: 60 * 1000,\r\n    refetchInterval: 5 * 60 * 1000,\r\n  });\r\n}\r\n\r\nexport function useCampaignPredictions(campaignId: string) {\r\n  return useQuery({\r\n    queryKey: ['predictions', 'campaigns', campaignId],\r\n    queryFn: () => predictionsApi.getCampaignPredictions(campaignId),\r\n    enabled: !!campaignId,\r\n  });\r\n}\r\n\r\nexport function usePredictionAlerts(unreadOnly: boolean = false) {\r\n  return useQuery({\r\n    queryKey: ['predictions', 'alerts', unreadOnly],\r\n    queryFn: () => predictionsApi.getPredictionAlerts(unreadOnly),\r\n    staleTime: 30 * 1000,\r\n  });\r\n}\r\n\r\nexport function useMarkAlertRead() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: predictionsApi.markAlertRead,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['predictions', 'alerts'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useRefreshPredictions() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: predictionsApi.refreshPredictions,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['predictions'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useBudgetOptimization(totalBudget?: number) {\r\n  return useQuery({\r\n    queryKey: ['predictions', 'budget-optimization', totalBudget],\r\n    queryFn: () => predictionsApi.getBudgetOptimization(totalBudget),\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n}\r\n\r\nexport function useApplyBudgetOptimization() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: predictionsApi.applyBudgetOptimization,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['predictions', 'budget-optimization'] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaigns'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useScenarios() {\r\n  return useQuery({\r\n    queryKey: ['predictions', 'scenarios'],\r\n    queryFn: predictionsApi.getScenarios,\r\n  });\r\n}\r\n\r\nexport function useScenario(id: string) {\r\n  return useQuery({\r\n    queryKey: ['predictions', 'scenarios', id],\r\n    queryFn: () => predictionsApi.getScenario(id),\r\n    enabled: !!id,\r\n  });\r\n}\r\n\r\nexport function useCreateScenario() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: predictionsApi.createScenario,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['predictions', 'scenarios'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDeleteScenario() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: predictionsApi.deleteScenario,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['predictions', 'scenarios'] });\r\n    },\r\n  });\r\n}\r\n"],"names":["predictionsApi","apiClient","campaignId","unreadOnly","id","totalBudget","params","optimizationId","data","useLivePredictions","useQuery","usePredictionAlerts","useBudgetOptimization"],"mappings":"kFAyFO,MAAMA,EAAiB,CAI5B,mBAAoB,UACD,MAAMC,EAAU,IAA+B,mBAAmB,GACnE,KAAK,KAMvB,uBAAwB,MAAOC,IACZ,MAAMD,EAAU,IAC/B,0BAA0BC,CAAU,EAAA,GAEtB,KAAK,KAMvB,oBAAqB,MAAOC,EAAsB,MAC/B,MAAMF,EAAU,IAAoC,sBAAuB,CAC1F,OAAQ,CAAE,YAAaE,CAAA,CAAW,CACnC,GACe,KAAK,KAMvB,cAAe,MAAOC,GAA8B,CAClD,MAAMH,EAAU,KAAK,uBAAuBG,CAAE,OAAO,CACvD,EAKA,mBAAoB,UAEhB,MAAMH,EAAU,KAAwC,sBAAsB,GAChE,KAAK,KAMvB,sBAAuB,MAAOI,GAAsD,CAClF,MAAMC,EAASD,EAAc,CAAE,aAAcA,CAAA,EAAgB,CAAA,EAK7D,OAJiB,MAAMJ,EAAU,IAC/B,mCACA,CAAE,OAAAK,CAAA,CAAO,GAEK,KAAK,IACvB,EAKA,wBAAyB,MAAOC,IACb,MAAMN,EAAU,KAC/B,oCAAoCM,CAAc,QAAA,GAEpC,KAAK,KAMvB,aAAc,UACK,MAAMN,EAAU,IAA6B,wBAAwB,GACtE,KAAK,KAMvB,eAAgB,MAAOO,IACJ,MAAMP,EAAU,KAA4B,yBAA0BO,CAAI,GAC3E,KAAK,KAMvB,YAAa,MAAOJ,IACD,MAAMH,EAAU,IAA2B,0BAA0BG,CAAE,EAAE,GAC1E,KAAK,KAMvB,eAAgB,MAAOA,GAA8B,CACnD,MAAMH,EAAU,OAAO,0BAA0BG,CAAE,EAAE,CACvD,CACF,EAIO,SAASK,GAAqB,CACnC,OAAOC,EAAS,CACd,SAAU,CAAC,cAAe,MAAM,EAChC,QAASV,EAAe,mBACxB,UAAW,GAAK,IAChB,gBAAiB,EAAI,GAAK,GAAA,CAC3B,CACH,CAUO,SAASW,EAAoBR,EAAsB,GAAO,CAC/D,OAAOO,EAAS,CACd,SAAU,CAAC,cAAe,SAAUP,CAAU,EAC9C,QAAS,IAAMH,EAAe,oBAAoBG,CAAU,EAC5D,UAAW,GAAK,GAAA,CACjB,CACH,CAwBO,SAASS,EAAsBP,EAAsB,CAC1D,OAAOK,EAAS,CACd,SAAU,CAAC,cAAe,sBAAuBL,CAAW,EAC5D,QAAS,IAAML,EAAe,sBAAsBK,CAAW,EAC/D,UAAW,EAAI,GAAK,GAAA,CACrB,CACH"}