{"version":3,"file":"AdAccounts-CrKGuZGk.js","sources":["../../src/views/tenant/AdAccounts.tsx"],"sourcesContent":["/**\r\n * Stratum AI - Ad Accounts Management Page\r\n *\r\n * View and manage ad accounts from connected platforms.\r\n * Enable/disable accounts for campaign publishing.\r\n */\r\n\r\nimport { useMemo, useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport {\r\n  ArrowPathIcon,\r\n  BuildingStorefrontIcon,\r\n  CheckCircleIcon,\r\n  MagnifyingGlassIcon,\r\n  XCircleIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n  type Platform,\r\n  useAdAccounts,\r\n  useSyncAdAccounts,\r\n  useUpdateAdAccount,\r\n} from '@/api/campaignBuilder';\r\n\r\ninterface AdAccount {\r\n  id: string;\r\n  platformAccountId: string;\r\n  name: string;\r\n  platform: 'meta' | 'google' | 'tiktok' | 'snapchat';\r\n  currency: string;\r\n  timezone: string;\r\n  enabled: boolean;\r\n  spendCap?: number;\r\n  lastSyncAt: string;\r\n}\r\n\r\nconst mockAccounts: AdAccount[] = [\r\n  {\r\n    id: '1',\r\n    platformAccountId: 'act_123456789',\r\n    name: 'Main Business Account',\r\n    platform: 'meta',\r\n    currency: 'SAR',\r\n    timezone: 'Asia/Riyadh',\r\n    enabled: true,\r\n    spendCap: 50000,\r\n    lastSyncAt: '2024-01-20T10:30:00Z',\r\n  },\r\n  {\r\n    id: '2',\r\n    platformAccountId: 'act_987654321',\r\n    name: 'E-commerce Store',\r\n    platform: 'meta',\r\n    currency: 'SAR',\r\n    timezone: 'Asia/Riyadh',\r\n    enabled: true,\r\n    lastSyncAt: '2024-01-20T10:30:00Z',\r\n  },\r\n  {\r\n    id: '3',\r\n    platformAccountId: '123-456-7890',\r\n    name: 'Company Google Ads',\r\n    platform: 'google',\r\n    currency: 'SAR',\r\n    timezone: 'Asia/Riyadh',\r\n    enabled: false,\r\n    lastSyncAt: '2024-01-19T14:00:00Z',\r\n  },\r\n];\r\n\r\nconst platformLabels = {\r\n  meta: 'Meta Ads',\r\n  google: 'Google Ads',\r\n  tiktok: 'TikTok Ads',\r\n  snapchat: 'Snapchat Ads',\r\n};\r\n\r\nexport default function AdAccounts() {\r\n  const { tenantId } = useParams<{ tenantId: string }>();\r\n  const tid = parseInt(tenantId || '1', 10);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  // Platform filter state - reserved for filter functionality\r\n  const [\r\n    ,/* selectedPlatform */\r\n    /* setSelectedPlatform */\r\n  ] = useState<Platform>('meta');\r\n\r\n  // API hooks for all platforms\r\n  const { data: metaAccounts } = useAdAccounts(tid, 'meta');\r\n  const { data: googleAccounts } = useAdAccounts(tid, 'google');\r\n  const { data: tiktokAccounts } = useAdAccounts(tid, 'tiktok');\r\n  const { data: snapchatAccounts } = useAdAccounts(tid, 'snapchat');\r\n  const syncAccounts = useSyncAdAccounts(tid);\r\n  const updateAccount = useUpdateAdAccount(tid);\r\n\r\n  // Combine all accounts with fallback to mock data\r\n  const accounts: AdAccount[] = useMemo(() => {\r\n    const apiAccounts = [\r\n      ...(metaAccounts || []),\r\n      ...(googleAccounts || []),\r\n      ...(tiktokAccounts || []),\r\n      ...(snapchatAccounts || []),\r\n    ].map((acc) => ({\r\n      id: acc.id,\r\n      platformAccountId: acc.platform_account_id,\r\n      name: acc.name,\r\n      platform: acc.platform as AdAccount['platform'],\r\n      currency: acc.currency,\r\n      timezone: acc.timezone,\r\n      enabled: acc.is_enabled,\r\n      spendCap: acc.daily_budget_cap,\r\n      lastSyncAt: acc.last_synced_at || new Date().toISOString(),\r\n    }));\r\n\r\n    // Return API data if available, otherwise fall back to mock\r\n    return apiAccounts.length > 0 ? apiAccounts : mockAccounts;\r\n  }, [metaAccounts, googleAccounts, tiktokAccounts, snapchatAccounts]);\r\n\r\n  const handleToggleAccount = async (account: AdAccount) => {\r\n    try {\r\n      await updateAccount.mutateAsync({\r\n        platform: account.platform as Platform,\r\n        accountId: account.id,\r\n        data: { is_enabled: !account.enabled },\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to toggle account:', error);\r\n      // Fallback: local state update for demo mode\r\n    }\r\n  };\r\n\r\n  const handleSyncAccounts = async () => {\r\n    try {\r\n      // Sync all platforms\r\n      await Promise.all([\r\n        syncAccounts.mutateAsync('meta'),\r\n        syncAccounts.mutateAsync('google'),\r\n        syncAccounts.mutateAsync('tiktok'),\r\n        syncAccounts.mutateAsync('snapchat'),\r\n      ]);\r\n    } catch (error) {\r\n      console.error('Failed to sync accounts:', error);\r\n    }\r\n  };\r\n\r\n  const filteredAccounts = accounts.filter(\r\n    (acc) =>\r\n      acc.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      acc.platformAccountId.toLowerCase().includes(searchQuery.toLowerCase())\r\n  );\r\n\r\n  const enabledCount = accounts.filter((acc) => acc.enabled).length;\r\n  const syncing = syncAccounts.isPending;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold\">Ad Accounts</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            {enabledCount} of {accounts.length} accounts enabled for publishing\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={handleSyncAccounts}\r\n          disabled={syncing}\r\n          className=\"flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-accent transition-colors disabled:opacity-50\"\r\n        >\r\n          <ArrowPathIcon className={cn('h-5 w-5', syncing && 'animate-spin')} />\r\n          Sync Accounts\r\n        </button>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"relative\">\r\n        <MagnifyingGlassIcon className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search accounts...\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          className=\"w-full pl-10 pr-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50\"\r\n        />\r\n      </div>\r\n\r\n      {/* Accounts List */}\r\n      <div className=\"space-y-4\">\r\n        {filteredAccounts.map((account) => (\r\n          <div\r\n            key={account.id}\r\n            className={cn(\r\n              'rounded-xl border p-6 transition-all',\r\n              account.enabled ? 'bg-card shadow-card' : 'bg-muted/30'\r\n            )}\r\n          >\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div\r\n                  className={cn(\r\n                    'h-12 w-12 rounded-lg flex items-center justify-center',\r\n                    account.enabled ? 'bg-primary/10' : 'bg-muted'\r\n                  )}\r\n                >\r\n                  <BuildingStorefrontIcon\r\n                    className={cn(\r\n                      'h-6 w-6',\r\n                      account.enabled ? 'text-primary' : 'text-muted-foreground'\r\n                    )}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-semibold\">{account.name}</h3>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {platformLabels[account.platform]} - {account.platformAccountId}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              <button\r\n                onClick={() => handleToggleAccount(account)}\r\n                className={cn(\r\n                  'flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors',\r\n                  account.enabled\r\n                    ? 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400'\r\n                    : 'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400'\r\n                )}\r\n              >\r\n                {account.enabled ? (\r\n                  <>\r\n                    <CheckCircleIcon className=\"h-4 w-4\" />\r\n                    Enabled\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <XCircleIcon className=\"h-4 w-4\" />\r\n                    Disabled\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n\r\n            {/* Account Details */}\r\n            <div className=\"mt-4 pt-4 border-t grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n              <div>\r\n                <p className=\"text-xs text-muted-foreground\">Currency</p>\r\n                <p className=\"font-medium\">{account.currency}</p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-xs text-muted-foreground\">Timezone</p>\r\n                <p className=\"font-medium\">{account.timezone}</p>\r\n              </div>\r\n              {account.spendCap && (\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground\">Spend Cap</p>\r\n                  <p className=\"font-medium\">\r\n                    {account.currency} {account.spendCap.toLocaleString()}\r\n                  </p>\r\n                </div>\r\n              )}\r\n              <div>\r\n                <p className=\"text-xs text-muted-foreground\">Last Synced</p>\r\n                <p className=\"font-medium\">{new Date(account.lastSyncAt).toLocaleDateString()}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {filteredAccounts.length === 0 && (\r\n        <div className=\"rounded-xl border bg-muted/30 p-12 text-center\">\r\n          <BuildingStorefrontIcon className=\"h-12 w-12 mx-auto text-muted-foreground\" />\r\n          <h3 className=\"mt-4 font-semibold\">No Ad Accounts Found</h3>\r\n          <p className=\"text-muted-foreground mt-2\">\r\n            Connect a platform first to see available ad accounts\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Info Box */}\r\n      <div className=\"rounded-xl border bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800 p-6\">\r\n        <h3 className=\"font-semibold text-blue-900 dark:text-blue-100 mb-2\">\r\n          About Ad Account Management\r\n        </h3>\r\n        <ul className=\"space-y-1 text-sm text-blue-800 dark:text-blue-200\">\r\n          <li>- Only enabled accounts can be selected for campaign publishing</li>\r\n          <li>- Accounts are synced automatically every 6 hours</li>\r\n          <li>- Spend caps are pulled from platform settings</li>\r\n          <li>- Budget guardrails will respect account spend caps</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["mockAccounts","platformLabels","AdAccounts","tenantId","useParams","tid","searchQuery","setSearchQuery","useState","metaAccounts","useAdAccounts","googleAccounts","tiktokAccounts","snapchatAccounts","syncAccounts","useSyncAdAccounts","updateAccount","useUpdateAdAccount","accounts","useMemo","apiAccounts","acc","handleToggleAccount","account","error","handleSyncAccounts","filteredAccounts","enabledCount","syncing","jsxs","jsx","ArrowPathIcon","cn","MagnifyingGlassIcon","e","BuildingStorefrontIcon","Fragment","CheckCircleIcon","XCircleIcon"],"mappings":"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"}