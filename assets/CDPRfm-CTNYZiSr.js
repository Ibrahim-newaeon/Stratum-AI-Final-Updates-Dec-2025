import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as g}from"./vendor-react-Dz7uKsMg.js";import{i as j,T as v,$ as _,U as C,A as S,am as M,r as k,c as m,w as f,s as F,v as L,E as T,Z as P,cY as A}from"./index-BQex3859.js";import{x as D,y as q,g as $,z as E}from"./cdp-B6W0ktOz.js";import{L as u}from"./loader-circle-CJwg01sb.js";import{R as p}from"./refresh-cw-DLOeozaH.js";import{C as H}from"./calendar-CbIj2r5m.js";import{D as B}from"./dollar-sign-Dosx4kzY.js";import{C as I}from"./crown-BLrg3d0f.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],O=j("frown",V);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],y=j("heart",U);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],w=j("moon",z),c={champions:{label:"Champions",description:"Best customers who bought recently, buy often and spend the most",icon:e.jsx(I,{className:"w-5 h-5"}),color:"text-amber-500",bgColor:"bg-amber-500/10",actionTip:"Reward them, make them brand ambassadors"},loyal_customers:{label:"Loyal Customers",description:"Customers who buy often and spend good money",icon:e.jsx(y,{className:"w-5 h-5"}),color:"text-red-500",bgColor:"bg-red-500/10",actionTip:"Upsell higher value products, ask for reviews"},potential_loyalists:{label:"Potential Loyalists",description:"Recent customers with average frequency",icon:e.jsx(A,{className:"w-5 h-5"}),color:"text-purple-500",bgColor:"bg-purple-500/10",actionTip:"Offer membership/loyalty program, recommend products"},new_customers:{label:"New Customers",description:"Bought recently but not often",icon:e.jsx(P,{className:"w-5 h-5"}),color:"text-green-500",bgColor:"bg-green-500/10",actionTip:"Provide onboarding support, special offers"},promising:{label:"Promising",description:"Recent shoppers but not much spent",icon:e.jsx(T,{className:"w-5 h-5"}),color:"text-blue-500",bgColor:"bg-blue-500/10",actionTip:"Create brand awareness, offer free trials"},need_attention:{label:"Need Attention",description:"Above average recency, frequency and monetary",icon:e.jsx(f,{className:"w-5 h-5"}),color:"text-orange-500",bgColor:"bg-orange-500/10",actionTip:"Make limited-time offers, recommend based on past"},about_to_sleep:{label:"About to Sleep",description:"Below average recency, frequency and monetary",icon:e.jsx(w,{className:"w-5 h-5"}),color:"text-indigo-500",bgColor:"bg-indigo-500/10",actionTip:"Share valuable resources, recommend popular products"},at_risk:{label:"At Risk",description:"Spent big money, purchased often but long time ago",icon:e.jsx(f,{className:"w-5 h-5"}),color:"text-red-600",bgColor:"bg-red-600/10",actionTip:"Send personalized emails, offer renewals"},cannot_lose:{label:"Can't Lose",description:"Made biggest purchases and often, but long time ago",icon:e.jsx(y,{className:"w-5 h-5"}),color:"text-pink-500",bgColor:"bg-pink-500/10",actionTip:"Win them back via renewals, newer products"},hibernating:{label:"Hibernating",description:"Last purchase was long ago, low spenders",icon:e.jsx(w,{className:"w-5 h-5"}),color:"text-gray-500",bgColor:"bg-gray-500/10",actionTip:"Offer relevant products, special discounts"},lost:{label:"Lost",description:"Lowest recency, frequency and monetary",icon:e.jsx(O,{className:"w-5 h-5"}),color:"text-gray-400",bgColor:"bg-gray-400/10",actionTip:"Revive interest with reach out, ignore otherwise"},other:{label:"Other",description:"Customers that do not fit other segments",icon:e.jsx(C,{className:"w-5 h-5"}),color:"text-slate-500",bgColor:"bg-slate-500/10",actionTip:"Analyze individually for better targeting"}};function b({label:s,score:o,rawValue:r}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"text-muted-foreground",children:r})]}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(n=>e.jsx("div",{className:m("flex-1 h-2 rounded-full transition-colors",n<=o?"bg-primary":"bg-muted")},n))}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:["Score: ",o,"/5"]})]})}function W({segment:s,count:o,totalProfiles:r,isSelected:n,onClick:t}){const i=c[s],l=r>0?o/r*100:0;return e.jsxs("div",{className:m("p-4 rounded-xl border cursor-pointer transition-all hover:shadow-md",n?"border-primary ring-2 ring-primary/20":"hover:border-primary/50"),onClick:t,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:m("p-2 rounded-lg",i.bgColor,i.color),children:i.icon}),e.jsx("span",{className:"text-2xl font-bold",children:o.toLocaleString()})]}),e.jsx("h4",{className:"font-semibold mb-1",children:i.label}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2",children:i.description}),e.jsx("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:m("h-full transition-all",i.bgColor.replace("/10","")),style:{width:`${l}%`}})}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[l.toFixed(1),"% of profiles"]})]})}function Z({profileId:s,onBack:o}){const{data:r,isLoading:n}=$(s),{data:t,isLoading:i}=E(s);if(n||i)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(u,{className:"w-8 h-8 animate-spin text-primary"})});if(!t||!r)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(f,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"RFM Data Not Available"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This profile doesn't have RFM scores yet"}),e.jsx("button",{onClick:o,className:"text-primary hover:underline",children:"Back to Dashboard"})]});const d=c[t.rfm_segment];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(F,{className:"w-5 h-5 rotate-180"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Profile RFM Analysis"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.external_id||r.id.slice(0,12)+"..."})]})]}),e.jsxs("div",{className:m("p-6 rounded-xl border",d.bgColor),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:m("p-3 rounded-xl bg-background",d.color),children:d.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"RFM Segment"}),e.jsx("div",{className:"text-2xl font-bold",children:d.label}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d.description})]})]}),e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-background/80",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Recommended Action"}),e.jsx("p",{className:"text-sm",children:d.actionTip})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"p-4 rounded-xl border bg-card",children:e.jsx(b,{label:"Recency",score:t.recency_score,rawValue:`${t.recency_days} days ago`})}),e.jsx("div",{className:"p-4 rounded-xl border bg-card",children:e.jsx(b,{label:"Frequency",score:t.frequency_score,rawValue:`${t.frequency} purchases`})}),e.jsx("div",{className:"p-4 rounded-xl border bg-card",children:e.jsx(b,{label:"Monetary",score:t.monetary_score,rawValue:`$${t.monetary.toLocaleString()}`})})]}),e.jsxs("div",{className:"p-6 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Combined RFM Score"}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:t.rfm_score})]}),e.jsx("div",{className:"h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${t.rfm_score/15*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:"3 (Low)"}),e.jsx("span",{children:"9 (Average)"}),e.jsx("span",{children:"15 (High)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Lifecycle"}),e.jsx("div",{className:"text-lg font-semibold capitalize",children:r.lifecycle_stage})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Events"}),e.jsx("div",{className:"text-lg font-semibold",children:r.total_events.toLocaleString()})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Purchases"}),e.jsx("div",{className:"text-lg font-semibold",children:r.total_purchases.toLocaleString()})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),e.jsxs("div",{className:"text-lg font-semibold",children:["$",r.total_revenue.toLocaleString()]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(L,{className:"w-3 h-3"}),"Analysis window: ",t.analysis_window_days," days Â· Calculated:"," ",new Date(t.calculated_at).toLocaleString()]})]})}function G(){const[s,o]=g.useState(null),[r,n]=g.useState(""),[t,i]=g.useState(null),{data:l,isLoading:d,refetch:R}=D(),x=q(),N=async()=>{await x.mutateAsync(void 0),R()};return t?e.jsx(Z,{profileId:t,onBack:()=>i(null)}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6 text-primary"}),"RFM Analysis"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Customer segmentation based on Recency, Frequency, and Monetary value"})]}),e.jsxs("button",{onClick:N,disabled:x.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 transition-colors",children:[x.isPending?e.jsx(u,{className:"w-4 h-4 animate-spin"}):e.jsx(p,{className:"w-4 h-4"}),"Recalculate RFM"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:r,onChange:a=>n(a.target.value),placeholder:"Enter Profile ID to view individual RFM analysis...",className:"w-full pl-10 pr-24 py-3 rounded-lg border bg-background focus:ring-2 focus:ring-primary/20",onKeyDown:a=>{a.key==="Enter"&&r&&i(r)}}),r&&e.jsx("button",{onClick:()=>i(r),className:"absolute right-3 top-1/2 -translate-y-1/2 px-3 py-1.5 rounded-md bg-primary text-primary-foreground text-sm hover:bg-primary/90 transition-colors",children:"View RFM"})]}),d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(u,{className:"w-8 h-8 animate-spin text-primary"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(C,{className:"w-4 h-4"}),"Total Profiles"]}),e.jsx("div",{className:"text-2xl font-bold",children:l.total_profiles.toLocaleString()})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(S,{className:"w-4 h-4"}),"With RFM Data"]}),e.jsx("div",{className:"text-2xl font-bold",children:l.profiles_with_rfm.toLocaleString()})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(M,{className:"w-4 h-4"}),"Coverage"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-500",children:[l.coverage_pct.toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(k,{className:"w-4 h-4"}),"Segments"]}),e.jsx("div",{className:"text-2xl font-bold",children:Object.values(l.segment_distribution).filter(a=>a>0).length})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Customer Segments"}),s&&e.jsx("button",{onClick:()=>o(null),className:"text-sm text-primary hover:underline",children:"Clear selection"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Object.entries(l.segment_distribution).sort((a,h)=>h[1]-a[1]).map(([a,h])=>e.jsx(W,{segment:a,count:h,totalProfiles:l.profiles_with_rfm,isSelected:s===a,onClick:()=>o(s===a?null:a)},a))})]}),s&&e.jsx("div",{className:"p-6 rounded-xl border bg-card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:m("p-3 rounded-xl",c[s].bgColor,c[s].color),children:c[s].icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:c[s].label}),e.jsx("p",{className:"text-muted-foreground mt-1",children:c[s].description}),e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-primary/5 border border-primary/20",children:[e.jsx("div",{className:"text-sm font-medium text-primary mb-1",children:"Recommended Action"}),e.jsx("p",{className:"text-sm",children:c[s].actionTip})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:l.segment_distribution[s].toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"profiles"})]})]})}),e.jsxs("div",{className:"p-4 rounded-xl border bg-muted/30",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Understanding RFM Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2 mb-1",children:[e.jsx(H,{className:"w-4 h-4 text-primary"}),"Recency (R)"]}),e.jsx("p",{className:"text-muted-foreground",children:"How recently did the customer make a purchase? Lower is better."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2 mb-1",children:[e.jsx(p,{className:"w-4 h-4 text-primary"}),"Frequency (F)"]}),e.jsx("p",{className:"text-muted-foreground",children:"How often does the customer make purchases? Higher is better."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2 mb-1",children:[e.jsx(B,{className:"w-4 h-4 text-primary"}),"Monetary (M)"]}),e.jsx("p",{className:"text-muted-foreground",children:"How much does the customer spend? Higher is better."})]})]})]})]}):e.jsxs("div",{className:"text-center py-12 bg-card border rounded-xl",children:[e.jsx(v,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"No RFM Data Available"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Calculate RFM scores to segment your customers"}),e.jsxs("button",{onClick:N,disabled:x.isPending,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:[x.isPending?e.jsx(u,{className:"w-4 h-4 animate-spin"}):e.jsx(p,{className:"w-4 h-4"}),"Calculate RFM"]})]})]})}function ne(){return e.jsx("div",{className:"p-6",children:e.jsx(G,{})})}export{ne as default};
//# sourceMappingURL=CDPRfm-CTNYZiSr.js.map
