import{j as e}from"./vendor-ui-B0DL0VNC.js";import{f as U,r as h,L as q}from"./vendor-react-Dz7uKsMg.js";import{j as B,g as V,c as p,a6 as _,d5 as Q,a9 as K}from"./index-BQex3859.js";import{T as W,K as H,E as G}from"./KpiStrip-C0aZ-ZV9.js";import{E as Y,a as E}from"./EmqTimeline-DxviryQA.js";import{b as z,c as J,d as X,e as Z}from"./emqV2-BxKuXu1r.js";import{u as ee}from"./admin-C8dTloZG.js";import"./featureFlagsStore-DvEl_DiZ.js";import{F as te}from"./CalendarIcon-LISB5gLp.js";import{F as se}from"./DocumentArrowDownIcon-D3ixpsi6.js";import{F as ae}from"./EnvelopeIcon-CWLK6IWu.js";import{F as ie}from"./PhoneIcon-Ct1N2tQX.js";import{F as re}from"./ArrowTrendingDownIcon-DA5nft8Y.js";import{F as ne}from"./XCircleIcon-Dk49lKz_.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";import"./ConfidenceBandBadge-BR4oR-ha.js";import"./BudgetAtRiskChip-BRCQCK-f.js";import"./WrenchScrewdriverIcon-DJAaIhoQ.js";import"./UserCircleIcon-C5qf10f0.js";import"./ArrowTopRightOnSquareIcon-Cr7jBqzy.js";import"./BugAntIcon-BjOrFbnG.js";import"./ExclamationCircleIcon-C8aTdMTs.js";function Ae(){const{tenantId:v}=U(),x=parseInt(v||"1",10),{toast:S}=B(),[i,k]=h.useState(null),[d,$]=h.useState("summary"),T={start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]},{data:o}=ee(Number(v)||0),{data:l}=z(x),{data:c}=J(x),{data:A}=X(x),{data:f}=Z(x,T.start,T.end),r=(l==null?void 0:l.score)??65,g=(c==null?void 0:c.mode)??"cuts_only",u=(c==null?void 0:c.budgetAtRisk)??12e3,a={id:v,name:(o==null?void 0:o.name)??"Fashion Forward",industry:(o==null?void 0:o.industry)??"Retail",plan:"Pro",primaryContact:{name:"Jennifer Smith",email:"jennifer@fashionforward.com",phone:"+1 (555) 123-4567"},lastContact:new Date(Date.now()-2*24*60*60*1e3),renewalDate:new Date(Date.now()+30*24*60*60*1e3)},b=[{id:"spend",label:"Monthly Spend",value:12e4,format:"currency",previousValue:115e3,confidence:r},{id:"revenue",label:"Revenue",value:336e3,format:"currency",previousValue:38e4,confidence:r},{id:"roas",label:"ROAS",value:2.8,format:"multiplier",previousValue:3.3,confidence:r},{id:"cpa",label:"CPA",value:42,format:"currency",previousValue:35,trendIsPositive:!1,confidence:r}],j=[{label:"EMQ Recovery",value:8,unit:"pts",trend:12,isPositive:!0},{label:"ROAS Impact",value:-15,unit:"%",trend:-15,isPositive:!1},{label:"MTTR",value:18,unit:"hrs",trend:-25,isPositive:!0},{label:"Blocked Actions",value:5,unit:"",trend:0,isPositive:!1}],n=[{id:"1",type:"opportunity",title:"Scale Summer Sale campaign by 25%",reason:"EMQ below threshold - data quality uncertain",estimatedImpact:"+$18,000 revenue",blockedAt:new Date(Date.now()-18*60*60*1e3)},{id:"2",type:"opportunity",title:"Activate new lookalike audience",reason:"Autopilot in cuts_only mode",estimatedImpact:"+45% reach",blockedAt:new Date(Date.now()-12*60*60*1e3)},{id:"3",type:"opportunity",title:"Launch TikTok retargeting campaign",reason:"Platform signal degraded",estimatedImpact:"+$8,500 revenue",blockedAt:new Date(Date.now()-6*60*60*1e3)}],y=A??[{id:"1",title:"Fix TikTok conversion tracking",description:"TikTok reporting 22% lower conversions than GA4. Primary driver of EMQ drop.",priority:"critical",owner:"Data Team",estimatedImpact:12,estimatedTime:"2 hours",platform:"TikTok",status:"in_progress",actionUrl:null},{id:"2",title:"Resolve Meta pixel data loss",description:"8% event loss detected on purchase events.",priority:"high",owner:null,estimatedImpact:6,estimatedTime:"1 hour",platform:"Meta",status:"pending",actionUrl:null},{id:"3",title:"Validate Snapchat API connection",description:"Intermittent 504 errors causing freshness issues.",priority:"medium",owner:"Engineering",estimatedImpact:4,estimatedTime:"30 min",platform:"Snapchat",status:"pending",actionUrl:null}],C=(f==null?void 0:f.map(t=>({id:t.id,type:t.type,title:t.title,description:t.description??void 0,timestamp:new Date(t.timestamp),platform:t.platform??void 0,severity:t.severity,recoveryHours:t.recoveryHours??void 0,emqImpact:t.emqImpact??void 0})))??[{id:"1",type:"incident_opened",title:"TikTok conversion tracking degraded",description:"22% variance from GA4 detected",timestamp:new Date(Date.now()-18*60*60*1e3),platform:"TikTok",severity:"high",emqImpact:12},{id:"2",type:"mode_change",title:"Autopilot mode â†’ cuts_only",description:"Automatic protection triggered",timestamp:new Date(Date.now()-16*60*60*1e3),severity:"medium"},{id:"3",type:"incident_opened",title:"Meta pixel data loss detected",description:"8% purchase events missing",timestamp:new Date(Date.now()-12*60*60*1e3),platform:"Meta",severity:"medium",emqImpact:6},{id:"4",type:"action_blocked",title:"3 scaling actions blocked",description:"Protected $12,000 budget at risk",timestamp:new Date(Date.now()-8*60*60*1e3),severity:"low"}],P=[{id:"summary",label:"Client Summary"},{id:"timeline",label:"What Changed"},{id:"blocked",label:"What We Blocked"},{id:"playbook",label:"Fix Playbook"}],D=h.useCallback(()=>{const t=[];t.push("CLIENT NARRATIVE REPORT"),t.push(`Generated: ${new Date().toLocaleDateString()}`),t.push(""),t.push(`Client: ${a.name}`),t.push(`Industry: ${a.industry}`),t.push(`Plan: ${a.plan}`),t.push(`Primary Contact: ${a.primaryContact.name} (${a.primaryContact.email})`),t.push(""),t.push("--- TRUST STATUS ---"),t.push(`EMQ Score: ${r}/100`),t.push(`Autopilot Mode: ${g}`),t.push(`Budget at Risk: $${u.toLocaleString()}`),t.push(""),t.push("--- KEY PERFORMANCE INDICATORS ---"),b.forEach(s=>{const R=typeof s.value=="number"?s.value:parseFloat(s.value)||0,N=s.previousValue??0,M=N?((R-N)/N*100).toFixed(1):"N/A",L=s.format==="currency"?"$":"",O=s.format==="multiplier"?"x":"";t.push(`${s.label}: ${L}${R.toLocaleString()}${O} (${M}% vs prior)`)}),t.push(""),t.push("--- RECOVERY METRICS ---"),j.forEach(s=>{t.push(`${s.label}: ${s.value>=0?"+":""}${s.value}${s.unit}`)}),t.push(""),t.push("--- BLOCKED ACTIONS ---"),n.forEach(s=>{t.push(`[${s.type.toUpperCase()}] ${s.title}`),t.push(`  Reason: ${s.reason}`),t.push(`  Estimated Impact: ${s.estimatedImpact}`)}),t.push(""),t.push("--- FIX PLAYBOOK ---"),y.forEach(s=>{t.push(`[${s.priority.toUpperCase()}] ${s.title} - ${s.status}`),t.push(`  ${s.description}`),t.push(`  Owner: ${s.owner||"Unassigned"} | Est. Impact: +${s.estimatedImpact} EMQ pts | Time: ${s.estimatedTime}`)});const w=new Blob([t.join(`
`)],{type:"text/plain;charset=utf-8"}),I=URL.createObjectURL(w),m=document.createElement("a");m.href=I,m.download=`narrative-${a.name.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(I)},[a,r,g,u,b,j,n,y]),F=h.useCallback(()=>{const t=encodeURIComponent(`Stratum AI - ${a.name} Account Review`),w=encodeURIComponent(`Hi ${a.primaryContact.name},

I'd like to schedule a call to review your account performance.

Key topics:
- EMQ Score: ${r}/100
- ${n.length} blocked actions to discuss
- Recovery playbook status

Please let me know your availability.

Best regards`);window.open(`mailto:${a.primaryContact.email}?subject=${t}&body=${w}`,"_blank")},[a,r,n.length]);return e.jsxs("div",{"data-tour":"tenant-narrative",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(q,{to:"/dashboard/am/portfolio",className:"p-2 rounded-lg bg-surface-secondary border border-white/10 text-text-muted hover:text-white transition-colors",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:a.name}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-stratum-500/10 text-stratum-400",children:a.plan})]}),e.jsx("p",{className:"text-text-muted",children:a.industry})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-surface-secondary border border-white/10 text-text-secondary hover:text-white transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),"Schedule Call"]}),e.jsxs("button",{"data-tour":"export-pdf",onClick:D,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-stratum text-white font-medium hover:shadow-glow transition-all",children:[e.jsx(se,{className:"w-4 h-4"}),"Export PDF"]})]})]}),e.jsxs("div",{className:"flex items-center gap-6 p-4 rounded-xl bg-surface-secondary border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-stratum-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-stratum-400 font-semibold",children:a.primaryContact.name.split(" ").map(t=>t[0]).join("")})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:a.primaryContact.name}),e.jsx("div",{className:"text-sm text-text-muted",children:"Primary Contact"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:a.primaryContact.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{children:a.primaryContact.phone})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Last Contact:"}),e.jsxs("span",{className:"text-white ml-2",children:[Math.floor((Date.now()-a.lastContact.getTime())/(24*60*60*1e3))," days ago"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Renewal:"}),e.jsxs("span",{className:"text-warning ml-2",children:[Math.floor((a.renewalDate.getTime()-Date.now())/(24*60*60*1e3))," days"]})]})]})]}),e.jsx(W,{emqScore:r,autopilotMode:g,budgetAtRisk:u,svi:35,onViewDetails:()=>$("timeline")}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:j.map(t=>e.jsxs("div",{className:"p-4 rounded-xl bg-surface-secondary border border-white/10",children:[e.jsx("div",{className:"text-text-muted text-sm mb-1",children:t.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:p("text-2xl font-bold",t.isPositive?"text-success":"text-danger"),children:[t.value>=0&&t.value>0?"+":"",t.value,t.unit]}),t.trend!==0&&e.jsxs("span",{className:p("flex items-center text-xs",t.isPositive?"text-success":"text-danger"),children:[t.isPositive?e.jsx(_,{className:"w-3 h-3"}):e.jsx(re,{className:"w-3 h-3"}),Math.abs(t.trend),"%"]})]})]},t.label))}),e.jsx(H,{kpis:b,emqScore:r}),e.jsx("div",{className:"flex items-center gap-2 border-b border-white/10 pb-4",children:P.map(t=>e.jsxs("button",{onClick:()=>$(t.id),className:p("px-4 py-2 rounded-lg transition-colors",d===t.id?"bg-stratum-500/10 text-stratum-400":"text-text-muted hover:text-white hover:bg-white/5"),children:[t.label,t.id==="blocked"&&n.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-warning/20 text-warning text-xs",children:n.length})]},t.id))}),d==="summary"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Y,{score:r,previousScore:(l==null?void 0:l.previousScore)??78,showDrivers:!0})}),e.jsx("div",{children:e.jsx(E,{events:C,maxEvents:6})})]}),d==="timeline"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold text-white",children:"What Changed (Last 30 Days)"})}),e.jsx(E,{events:C,maxEvents:20})]}),d==="blocked"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"What We Blocked"}),e.jsx("p",{className:"text-sm text-text-muted",children:"Actions blocked to protect performance during signal degradation"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-success/10 border border-success/20",children:[e.jsx(Q,{className:"w-5 h-5 text-success"}),e.jsxs("span",{className:"text-success font-medium",children:["$",u.toLocaleString()]}),e.jsx("span",{className:"text-success/80",children:"protected"})]})]}),e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsx("div",{className:"p-4 rounded-xl bg-surface-secondary border border-white/10",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-warning/10",children:e.jsx(ne,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:t.title}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:t.reason}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"text-success",children:[t.estimatedImpact," missed"]}),e.jsxs("span",{className:"flex items-center gap-1 text-text-muted",children:[e.jsx(K,{className:"w-3 h-3"}),"Blocked"," ",Math.floor((Date.now()-t.blockedAt.getTime())/(60*60*1e3)),"h ago"]})]})]})]}),e.jsx("span",{className:p("px-2 py-1 rounded text-xs",t.type==="opportunity"&&"bg-success/10 text-success",t.type==="risk"&&"bg-warning/10 text-warning",t.type==="fix"&&"bg-stratum-500/10 text-stratum-400"),children:t.type})]})},t.id))}),e.jsx("div",{className:"p-4 rounded-xl bg-surface-tertiary border border-white/5 text-center",children:e.jsx("p",{className:"text-text-muted",children:"These actions will automatically resume once EMQ recovers above 75 and autopilot returns to normal mode."})})]}),d==="playbook"&&e.jsxs("div",{"data-tour":"fix-playbook",className:"space-y-4",children:[e.jsx(G,{items:y,onItemClick:t=>k(t),onAssign:t=>{S({title:"Assignment requested",description:`"${t.title}" has been flagged for assignment. The ${t.owner||"team"} will be notified.`})},maxItems:10}),i&&e.jsxs("div",{className:"p-5 rounded-xl bg-surface-secondary border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:i.title}),e.jsx("button",{onClick:()=>k(null),className:"text-text-muted hover:text-white transition-colors text-sm",children:"Close"})]}),e.jsx("p",{className:"text-text-secondary mb-4",children:i.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Priority"}),e.jsx("p",{className:p("font-medium capitalize",i.priority==="critical"&&"text-danger",i.priority==="high"&&"text-warning",i.priority==="medium"&&"text-stratum-400"),children:i.priority})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Owner"}),e.jsx("p",{className:"text-white font-medium",children:i.owner||"Unassigned"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Est. Impact"}),e.jsxs("p",{className:"text-success font-medium",children:["+",i.estimatedImpact," EMQ pts"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Est. Time"}),e.jsx("p",{className:"text-white font-medium",children:i.estimatedTime})]})]}),i.platform&&e.jsxs("div",{className:"mt-3 text-sm",children:[e.jsx("span",{className:"text-text-muted",children:"Platform: "}),e.jsx("span",{className:"text-white",children:i.platform})]})]})]})]})}export{Ae as default};
//# sourceMappingURL=TenantNarrative-CrfA4OUY.js.map
