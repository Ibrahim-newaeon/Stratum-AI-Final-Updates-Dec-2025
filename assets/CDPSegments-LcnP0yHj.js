import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as u}from"./vendor-react-Dz7uKsMg.js";import{ah as R,h as D,a7 as L,F as P,c as _,ag as A}from"./index-BQex3859.js";import{c as E,h as $,i as M,j as T,k as z,l as B}from"./cdp-B6W0ktOz.js";import{F}from"./PlusIcon-ByQcgXHI.js";import{F as U}from"./MagnifyingGlassIcon-3MUvqIvj.js";import{F as H}from"./PlayIcon-kdWwcgbH.js";import{F as I}from"./PencilIcon-BPYwcoex.js";import{F as q}from"./TrashIcon-DR9paOX4.js";import{F as O}from"./CheckIcon-DQQhceDd.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";function Y({status:a}){const r={draft:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",computing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",active:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",stale:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",archived:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"};return e.jsx("span",{className:_("px-2 py-1 rounded-full text-xs font-medium capitalize",r[a]),children:a})}function K({condition:a,onChange:r,onRemove:p,isLast:o}){const d=[{value:"lifecycle_stage",label:"Lifecycle Stage"},{value:"total_events",label:"Total Events"},{value:"total_revenue",label:"Total Revenue"},{value:"total_purchases",label:"Total Purchases"},{value:"first_seen_at",label:"First Seen"},{value:"last_seen_at",label:"Last Seen"},{value:"has_email",label:"Has Email"},{value:"has_phone",label:"Has Phone"}],m={lifecycle_stage:[{value:"eq",label:"equals"},{value:"neq",label:"not equals"},{value:"in",label:"is one of"}],total_events:[{value:"gt",label:"greater than"},{value:"gte",label:"greater or equal"},{value:"lt",label:"less than"},{value:"lte",label:"less or equal"},{value:"eq",label:"equals"}],total_revenue:[{value:"gt",label:"greater than"},{value:"gte",label:"greater or equal"},{value:"lt",label:"less than"},{value:"lte",label:"less or equal"}],total_purchases:[{value:"gt",label:"greater than"},{value:"gte",label:"greater or equal"},{value:"eq",label:"equals"}],first_seen_at:[{value:"after",label:"after"},{value:"before",label:"before"},{value:"within_days",label:"within last N days"}],last_seen_at:[{value:"after",label:"after"},{value:"before",label:"before"},{value:"within_days",label:"within last N days"}],has_email:[{value:"eq",label:"is"}],has_phone:[{value:"eq",label:"is"}]},g=m[a.field]||m.total_events;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[e.jsx("select",{value:a.field,onChange:s=>r({...a,field:s.target.value,value:""}),className:"px-3 py-2 border rounded-lg bg-background text-sm",children:d.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{value:a.operator,onChange:s=>r({...a,operator:s.target.value}),className:"px-3 py-2 border rounded-lg bg-background text-sm",children:g.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),a.field==="lifecycle_stage"?e.jsxs("select",{value:String(a.value),onChange:s=>r({...a,value:s.target.value}),className:"flex-1 px-3 py-2 border rounded-lg bg-background text-sm",children:[e.jsx("option",{value:"",children:"Select stage..."}),e.jsx("option",{value:"anonymous",children:"Anonymous"}),e.jsx("option",{value:"known",children:"Known"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"churned",children:"Churned"})]}):a.field==="has_email"||a.field==="has_phone"?e.jsxs("select",{value:String(a.value),onChange:s=>r({...a,value:s.target.value==="true"}),className:"flex-1 px-3 py-2 border rounded-lg bg-background text-sm",children:[e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]}):e.jsx("input",{type:a.field.includes("_at")&&!a.operator.includes("days")?"date":"number",value:String(a.value||""),onChange:s=>r({...a,value:s.target.value}),placeholder:"Enter value...",className:"flex-1 px-3 py-2 border rounded-lg bg-background text-sm"}),e.jsx("button",{onClick:p,disabled:o,className:"p-2 hover:bg-muted rounded-lg transition-colors disabled:opacity-50",children:e.jsx(q,{className:"h-4 w-4"})})]})}function V({segment:a,onClose:r,onSave:p}){var n;const[o,d]=u.useState((a==null?void 0:a.name)||""),[m,g]=u.useState((a==null?void 0:a.description)||""),[s,x]=u.useState("and"),[i,h]=u.useState(((n=a==null?void 0:a.rules)==null?void 0:n.conditions)||[{field:"lifecycle_stage",operator:"eq",value:""}]),[j,N]=u.useState((a==null?void 0:a.auto_refresh)??!0),[b,y]=u.useState((a==null?void 0:a.refresh_interval_hours)||24),c=B(),w=async()=>{try{await c.mutateAsync({rules:{logic:s,conditions:i},limit:10})}catch(l){console.error("Preview failed:",l)}},C=()=>{o.trim()&&p({name:o.trim(),description:m.trim()||void 0,rules:{logic:s,conditions:i},auto_refresh:j,refresh_interval_hours:b})},k=()=>{h([...i,{field:"total_events",operator:"gt",value:0}])},S=(l,f)=>{const v=[...i];v[l]=f,h(v)},t=l=>{i.length>1&&h(i.filter((f,v)=>v!==l))};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:r,children:e.jsxs("div",{className:"bg-card rounded-xl border shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a?"Edit Segment":"Create Segment"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-muted rounded-lg",children:e.jsx(P,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-150px)] space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Segment Name *"}),e.jsx("input",{type:"text",value:o,onChange:l=>d(l.target.value),placeholder:"e.g., High-Value Customers",className:"w-full px-3 py-2 border rounded-lg bg-background"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{value:m,onChange:l=>g(l.target.value),placeholder:"Describe what this segment includes...",rows:2,className:"w-full px-3 py-2 border rounded-lg bg-background resize-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Match profiles where:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x("and"),className:_("px-4 py-2 rounded-lg text-sm font-medium transition-colors",s==="and"?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"),children:"ALL conditions match (AND)"}),e.jsx("button",{onClick:()=>x("or"),className:_("px-4 py-2 rounded-lg text-sm font-medium transition-colors",s==="or"?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"),children:"ANY condition matches (OR)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Conditions"}),i.map((l,f)=>e.jsx(K,{condition:l,onChange:v=>S(f,v),onRemove:()=>t(f),isLast:i.length===1},f)),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 border border-dashed rounded-lg text-sm text-muted-foreground hover:text-foreground hover:border-primary transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),"Add Condition"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:l=>N(l.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm font-medium",children:"Auto-refresh segment"})]}),j&&e.jsxs("div",{className:"ml-6",children:[e.jsx("label",{className:"block text-sm text-muted-foreground mb-1",children:"Refresh every"}),e.jsxs("select",{value:b,onChange:l=>y(Number(l.target.value)),className:"px-3 py-2 border rounded-lg bg-background text-sm",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:6,children:"6 hours"}),e.jsx("option",{value:12,children:"12 hours"}),e.jsx("option",{value:24,children:"24 hours"}),e.jsx("option",{value:168,children:"Weekly"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("button",{onClick:w,disabled:c.isPending,className:"flex items-center gap-2 px-4 py-2 border rounded-lg text-sm hover:bg-muted transition-colors disabled:opacity-50",children:[e.jsx(A,{className:"h-4 w-4"}),c.isPending?"Loading...":"Preview Segment"]}),c.data&&e.jsxs("div",{className:"mt-3 p-3 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Estimated: ",c.data.estimated_count.toLocaleString()," profiles"]}),c.data.sample_profiles.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Sample:"," ",c.data.sample_profiles.map(l=>l.id.slice(0,8)).join(", "),"..."]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium hover:bg-muted rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:C,disabled:!o.trim(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors disabled:opacity-50",children:[e.jsx(O,{className:"h-4 w-4 inline-block mr-1"}),a?"Update":"Create"," Segment"]})]})]})})}function W({segment:a,onEdit:r,onCompute:p,onDelete:o}){return e.jsxs("div",{className:"bg-card rounded-xl border p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(R,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.slug})]})]}),e.jsx(Y,{status:a.status})]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:a.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Profiles"}),e.jsx("p",{className:"font-semibold",children:a.profile_count.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Computed"}),e.jsx("p",{className:"text-sm",children:a.last_computed_at?new Date(a.last_computed_at).toLocaleDateString():"Never"})]})]}),a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:a.tags.map(d=>e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded text-xs",children:d},d))}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsx("div",{className:"flex items-center gap-1",children:a.auto_refresh&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(L,{className:"h-3 w-3"}),"Every ",a.refresh_interval_hours,"h"]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:p,className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"Recompute",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"Edit",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors text-red-500",title:"Delete",children:e.jsx(q,{className:"h-4 w-4"})})]})]})]})}function ie(){const[a,r]=u.useState(""),[p,o]=u.useState(!1),[d,m]=u.useState(),[g,s]=u.useState(null),{data:x,isLoading:i,refetch:h}=E(),j=$(),N=M(),b=T(),y=z(),c=(x==null?void 0:x.segments.filter(t=>{var n;return t.name.toLowerCase().includes(a.toLowerCase())||((n=t.description)==null?void 0:n.toLowerCase().includes(a.toLowerCase()))}))||[],w=async t=>{try{await j.mutateAsync(t),o(!1),h()}catch(n){console.error("Create failed:",n)}},C=async t=>{if(d)try{await N.mutateAsync({segmentId:d.id,update:t}),m(void 0),h()}catch(n){console.error("Update failed:",n)}},k=async t=>{try{await b.mutateAsync(t),s(null),h()}catch(n){console.error("Delete failed:",n)}},S=async t=>{try{await y.mutateAsync(t),h()}catch(n){console.error("Compute failed:",n)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Segments"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[(x==null?void 0:x.total)||0," segments"]})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),"Create Segment"]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",value:a,onChange:t=>r(t.target.value),placeholder:"Search segments...",className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-primary focus:outline-none"})]}),i?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"bg-card rounded-xl border p-4 animate-pulse",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-lg mb-3"}),e.jsx("div",{className:"h-5 w-32 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded"})]},t))}):c.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-xl border",children:[e.jsx(R,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"No segments found"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:a?"Try a different search term":"Create your first segment to get started"}),!a&&e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90",children:"Create Segment"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(t=>e.jsx(W,{segment:t,onEdit:()=>m(t),onCompute:()=>S(t.id),onDelete:()=>s(t.id)},t.id))}),(p||d)&&e.jsx(V,{segment:d,onClose:()=>{o(!1),m(void 0)},onSave:d?C:w}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-card rounded-xl border p-6 max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Delete Segment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>s(null),className:"px-4 py-2 text-sm font-medium hover:bg-muted rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>k(g),disabled:b.isPending,className:"px-4 py-2 bg-red-500 text-white rounded-lg text-sm font-medium hover:bg-red-600 disabled:opacity-50",children:b.isPending?"Deleting...":"Delete"})]})]})})]})}export{ie as default};
//# sourceMappingURL=CDPSegments-LcnP0yHj.js.map
