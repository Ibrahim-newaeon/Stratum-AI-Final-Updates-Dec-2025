{"version":3,"file":"campaignBuilder-B-MzQ-hf.js","sources":["../../src/api/campaignBuilder.ts"],"sourcesContent":["/**\r\n * Stratum AI - Campaign Builder API Hooks\r\n *\r\n * React Query hooks for the Campaign Builder feature:\r\n * - Platform connectors\r\n * - Ad accounts\r\n * - Campaign drafts\r\n * - Publish logs\r\n */\r\n\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiClient } from './client';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport type Platform = 'meta' | 'google' | 'tiktok' | 'snapchat';\r\nexport type ConnectionStatus = 'connected' | 'expired' | 'error' | 'disconnected';\r\nexport type DraftStatus =\r\n  | 'draft'\r\n  | 'submitted'\r\n  | 'approved'\r\n  | 'rejected'\r\n  | 'publishing'\r\n  | 'published'\r\n  | 'failed';\r\nexport type PublishResult = 'success' | 'failure';\r\n\r\nexport interface ConnectorStatus {\r\n  platform: string;\r\n  status: ConnectionStatus;\r\n  connected_at?: string;\r\n  last_refreshed_at?: string;\r\n  scopes: string[];\r\n  last_error?: string;\r\n}\r\n\r\nexport interface AdAccount {\r\n  id: string;\r\n  platform: string;\r\n  platform_account_id: string;\r\n  name: string;\r\n  business_name?: string;\r\n  currency: string;\r\n  timezone: string;\r\n  is_enabled: boolean;\r\n  daily_budget_cap?: number;\r\n  last_synced_at?: string;\r\n}\r\n\r\nexport interface CampaignDraft {\r\n  id: string;\r\n  tenant_id: number;\r\n  platform: string;\r\n  ad_account_id?: string;\r\n  name: string;\r\n  description?: string;\r\n  status: DraftStatus;\r\n  draft_json: Record<string, any>;\r\n  created_at: string;\r\n  updated_at: string;\r\n  submitted_at?: string;\r\n  approved_at?: string;\r\n  rejected_at?: string;\r\n  rejection_reason?: string;\r\n  platform_campaign_id?: string;\r\n  published_at?: string;\r\n}\r\n\r\nexport interface PublishLog {\r\n  id: string;\r\n  draft_id?: string;\r\n  platform: string;\r\n  platform_account_id: string;\r\n  event_time: string;\r\n  result_status: PublishResult;\r\n  platform_campaign_id?: string;\r\n  error_code?: string;\r\n  error_message?: string;\r\n  retry_count: number;\r\n}\r\n\r\nexport interface CreateDraftPayload {\r\n  platform: string;\r\n  ad_account_id: string;\r\n  name: string;\r\n  description?: string;\r\n  draft_json: Record<string, any>;\r\n}\r\n\r\nexport interface UpdateDraftPayload {\r\n  name?: string;\r\n  description?: string;\r\n  draft_json?: Record<string, any>;\r\n}\r\n\r\n// =============================================================================\r\n// Connector Hooks\r\n// =============================================================================\r\n\r\nexport function useConnectorStatus(tenantId: number, platform: Platform) {\r\n  return useQuery({\r\n    queryKey: ['connector-status', tenantId, platform],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: ConnectorStatus }>(\r\n        `/tenant/${tenantId}/connect/${platform}/status`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    enabled: !!tenantId && !!platform,\r\n  });\r\n}\r\n\r\nexport function useStartConnection(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (platform: Platform) => {\r\n      const response = await apiClient.post<{ data: { oauth_url: string } }>(\r\n        `/tenant/${tenantId}/connect/${platform}/start`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: (_, platform) => {\r\n      queryClient.invalidateQueries({ queryKey: ['connector-status', tenantId, platform] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useRefreshToken(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (platform: Platform) => {\r\n      const response = await apiClient.post(`/tenant/${tenantId}/connect/${platform}/refresh`);\r\n      return response.data;\r\n    },\r\n    onSuccess: (_, platform) => {\r\n      queryClient.invalidateQueries({ queryKey: ['connector-status', tenantId, platform] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDisconnectPlatform(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (platform: Platform) => {\r\n      const response = await apiClient.delete(`/tenant/${tenantId}/connect/${platform}`);\r\n      return response.data;\r\n    },\r\n    onSuccess: (_, platform) => {\r\n      queryClient.invalidateQueries({ queryKey: ['connector-status', tenantId, platform] });\r\n      queryClient.invalidateQueries({ queryKey: ['ad-accounts', tenantId, platform] });\r\n    },\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Ad Account Hooks\r\n// =============================================================================\r\n\r\nexport function useAdAccounts(tenantId: number, platform: Platform, enabledOnly = false) {\r\n  return useQuery({\r\n    queryKey: ['ad-accounts', tenantId, platform, enabledOnly],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: AdAccount[] }>(\r\n        `/tenant/${tenantId}/ad-accounts/${platform}`,\r\n        { params: { enabled_only: enabledOnly } }\r\n      );\r\n      return response.data.data;\r\n    },\r\n    enabled: !!tenantId && !!platform,\r\n  });\r\n}\r\n\r\nexport function useSyncAdAccounts(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (platform: Platform) => {\r\n      const response = await apiClient.post(`/tenant/${tenantId}/ad-accounts/${platform}/sync`);\r\n      return response.data;\r\n    },\r\n    onSuccess: (_, platform) => {\r\n      // Delay refetch to allow sync to complete\r\n      setTimeout(() => {\r\n        queryClient.invalidateQueries({ queryKey: ['ad-accounts', tenantId, platform] });\r\n      }, 2000);\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateAdAccount(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({\r\n      platform,\r\n      accountId,\r\n      data,\r\n    }: {\r\n      platform: Platform;\r\n      accountId: string;\r\n      data: { is_enabled?: boolean; daily_budget_cap?: number };\r\n    }) => {\r\n      const response = await apiClient.put<{ data: AdAccount }>(\r\n        `/tenant/${tenantId}/ad-accounts/${platform}/${accountId}`,\r\n        data\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: (_, { platform }) => {\r\n      queryClient.invalidateQueries({ queryKey: ['ad-accounts', tenantId, platform] });\r\n    },\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Campaign Draft Hooks\r\n// =============================================================================\r\n\r\nexport function useCampaignDrafts(\r\n  tenantId: number,\r\n  filters?: {\r\n    platform?: Platform;\r\n    status?: DraftStatus;\r\n    ad_account_id?: string;\r\n  }\r\n) {\r\n  return useQuery({\r\n    queryKey: ['campaign-drafts', tenantId, filters],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: CampaignDraft[] }>(\r\n        `/tenant/${tenantId}/campaign-drafts`,\r\n        { params: filters }\r\n      );\r\n      return response.data.data;\r\n    },\r\n    enabled: !!tenantId,\r\n  });\r\n}\r\n\r\nexport function useCampaignDraft(tenantId: number, draftId: string) {\r\n  return useQuery({\r\n    queryKey: ['campaign-draft', tenantId, draftId],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts/${draftId}`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    enabled: !!tenantId && !!draftId,\r\n  });\r\n}\r\n\r\nexport function useCreateCampaignDraft(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (data: CreateDraftPayload) => {\r\n      const response = await apiClient.post<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts`,\r\n        data\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateCampaignDraft(tenantId: number, draftId: string) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (data: UpdateDraftPayload) => {\r\n      const response = await apiClient.put<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts/${draftId}`,\r\n        data\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-draft', tenantId, draftId] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useSubmitDraft(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (draftId: string) => {\r\n      const response = await apiClient.post<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts/${draftId}/submit`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: (_, draftId) => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-draft', tenantId, draftId] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useApproveDraft(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (draftId: string) => {\r\n      const response = await apiClient.post<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts/${draftId}/approve`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: (_, draftId) => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-draft', tenantId, draftId] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useRejectDraft(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ draftId, reason }: { draftId: string; reason: string }) => {\r\n      const response = await apiClient.post<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts/${draftId}/reject`,\r\n        null,\r\n        { params: { reason } }\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: (_, { draftId }) => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-draft', tenantId, draftId] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function usePublishDraft(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (draftId: string) => {\r\n      const response = await apiClient.post<{ data: CampaignDraft }>(\r\n        `/tenant/${tenantId}/campaign-drafts/${draftId}/publish`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    onSuccess: (_, draftId) => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-draft', tenantId, draftId] });\r\n      queryClient.invalidateQueries({ queryKey: ['publish-logs', tenantId] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDeleteCampaignDraft(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (draftId: string) => {\r\n      const response = await apiClient.delete(`/tenant/${tenantId}/campaign-drafts/${draftId}`);\r\n      return response.data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n    },\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Publish Log Hooks\r\n// =============================================================================\r\n\r\nexport function usePublishLogs(\r\n  tenantId: number,\r\n  filters?: {\r\n    draft_id?: string;\r\n    platform?: Platform;\r\n    result_status?: PublishResult;\r\n  }\r\n) {\r\n  return useQuery({\r\n    queryKey: ['publish-logs', tenantId, filters],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: PublishLog[] }>(\r\n        `/tenant/${tenantId}/campaign-publish-logs`,\r\n        { params: filters }\r\n      );\r\n      return response.data.data;\r\n    },\r\n    enabled: !!tenantId,\r\n  });\r\n}\r\n\r\nexport function useRetryPublish(tenantId: number) {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (logId: string) => {\r\n      const response = await apiClient.post(\r\n        `/tenant/${tenantId}/campaign-publish-logs/${logId}/retry`\r\n      );\r\n      return response.data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['publish-logs', tenantId] });\r\n      queryClient.invalidateQueries({ queryKey: ['campaign-drafts', tenantId] });\r\n    },\r\n  });\r\n}\r\n"],"names":["useConnectorStatus","tenantId","platform","useQuery","apiClient","useStartConnection","queryClient","useQueryClient","useMutation","_","useRefreshToken","useDisconnectPlatform","useAdAccounts","enabledOnly","useSyncAdAccounts","useUpdateAdAccount","accountId","data","useCampaignDraft","draftId","useCreateCampaignDraft","useSubmitDraft","usePublishDraft","useDeleteCampaignDraft","useRetryPublish","logId"],"mappings":"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"}