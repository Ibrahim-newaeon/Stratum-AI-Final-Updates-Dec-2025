import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as p}from"./vendor-react-Dz7uKsMg.js";import{Z as v,G as M,T as B,v as F,S as w,c as u,H as $,s as z,V as H,X as Y,E as q,P as O,B as Z,$ as V,y as Q}from"./index-BQex3859.js";import{P as k}from"./plus-B9u7Tds1.js";import{D as W}from"./dollar-sign-Dosx4kzY.js";import{P as C}from"./pause-CGHTPI-4.js";import{T as J}from"./tag-DoKlR16h.js";import{M as L}from"./message-circle-DBK1o5j4.js";import{I as X}from"./info-Bj1e8ZpJ.js";import{L as K}from"./loader-circle-CJwg01sb.js";import{S as ee}from"./save-DrC-JAQ0.js";import{S as U}from"./square-pen-6DBNh-jk.js";import{C as te}from"./copy-CekHEH52.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";const I=[{value:"roas",label:"ROAS",category:"Performance",valueType:"number"},{value:"cpa",label:"CPA",category:"Performance",valueType:"currency"},{value:"cpc",label:"CPC",category:"Performance",valueType:"currency"},{value:"cpm",label:"CPM",category:"Performance",valueType:"currency"},{value:"ctr",label:"CTR",category:"Performance",valueType:"percentage"},{value:"conversion_rate",label:"Conversion Rate",category:"Performance",valueType:"percentage"},{value:"spend",label:"Spend",category:"Budget",valueType:"currency"},{value:"spend_pct",label:"Budget Spent %",category:"Budget",valueType:"percentage"},{value:"daily_budget",label:"Daily Budget",category:"Budget",valueType:"currency"},{value:"impressions",label:"Impressions",category:"Volume",valueType:"number"},{value:"clicks",label:"Clicks",category:"Volume",valueType:"number"},{value:"conversions",label:"Conversions",category:"Volume",valueType:"number"},{value:"frequency",label:"Frequency",category:"Delivery",valueType:"number"},{value:"reach",label:"Reach",category:"Delivery",valueType:"number"},{value:"fatigue_score",label:"Creative Fatigue Score",category:"Health",valueType:"percentage"},{value:"signal_health",label:"Signal Health Score",category:"Health",valueType:"number"},{value:"days_running",label:"Days Running",category:"Time",valueType:"number"},{value:"hours_since_change",label:"Hours Since Last Change",category:"Time",valueType:"number"}],se=[{value:"gt",label:">",description:"Greater than"},{value:"gte",label:">=",description:"Greater than or equal"},{value:"lt",label:"<",description:"Less than"},{value:"lte",label:"<=",description:"Less than or equal"},{value:"eq",label:"=",description:"Equal to"},{value:"neq",label:"!=",description:"Not equal to"},{value:"between",label:"Between",description:"Between two values"},{value:"change_gt",label:"Changed by >",description:"Changed by more than"},{value:"change_lt",label:"Changed by <",description:"Changed by less than"}],ae=[{value:"adjust_budget",label:"Adjust Budget",icon:W,category:"Budget"},{value:"scale_budget",label:"Scale Budget %",icon:q,category:"Budget"},{value:"set_budget",label:"Set Budget To",icon:B,category:"Budget"},{value:"adjust_bid",label:"Adjust Bid",icon:q,category:"Bidding"},{value:"pause_campaign",label:"Pause Campaign",icon:C,category:"Status"},{value:"pause_adset",label:"Pause Ad Set",icon:C,category:"Status"},{value:"pause_ad",label:"Pause Ad",icon:C,category:"Status"},{value:"enable_campaign",label:"Enable Campaign",icon:O,category:"Status"},{value:"apply_label",label:"Apply Label",icon:J,category:"Organization"},{value:"send_alert",label:"Send Alert",icon:Z,category:"Notification"},{value:"notify_slack",label:"Notify Slack",icon:L,category:"Notification"},{value:"notify_whatsapp",label:"Notify WhatsApp",icon:L,category:"Notification"}],le=[{value:"meta",label:"Meta (Facebook/Instagram)"},{value:"google",label:"Google Ads"},{value:"tiktok",label:"TikTok"},{value:"snapchat",label:"Snapchat"}],re=[{value:"prospecting",label:"Prospecting"},{value:"retargeting",label:"Retargeting"},{value:"brand",label:"Brand Awareness"},{value:"conversion",label:"Conversion"},{value:"engagement",label:"Engagement"}];function ne({rule:h,onSave:G,onCancel:y,isLoading:T}){var i;const[r,o]=p.useState(h||{name:"",description:"",status:"draft",conditionGroups:[{id:crypto.randomUUID(),logic:"AND",conditions:[{id:crypto.randomUUID(),field:"roas",operator:"lt",value:"2.0",valueType:"number"}]}],conditionLogic:"AND",actions:[{id:crypto.randomUUID(),type:"pause_campaign",config:{},priority:1}],targeting:{platforms:[],campaignTypes:[],specificCampaigns:[]},schedule:{enabled:!1,frequency:"hourly",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},trustGate:{enabled:!0,minSignalHealth:70,requireApproval:!1,dryRunFirst:!0},cooldownHours:24,maxExecutionsPerDay:10}),[m,j]=p.useState("conditions"),[x,b]=p.useState(new Set([(i=r.conditionGroups[0])==null?void 0:i.id])),D=()=>{o(t=>({...t,conditionGroups:[...t.conditionGroups,{id:crypto.randomUUID(),logic:"AND",conditions:[{id:crypto.randomUUID(),field:"roas",operator:"lt",value:"",valueType:"number"}]}]}))},S=t=>{r.conditionGroups.length<=1||o(a=>({...a,conditionGroups:a.conditionGroups.filter(s=>s.id!==t)}))},A=t=>{o(a=>({...a,conditionGroups:a.conditionGroups.map(s=>s.id===t?{...s,conditions:[...s.conditions,{id:crypto.randomUUID(),field:"roas",operator:"lt",value:"",valueType:"number"}]}:s)}))},P=(t,a)=>{o(s=>({...s,conditionGroups:s.conditionGroups.map(d=>d.id===t?{...d,conditions:d.conditions.filter(n=>n.id!==a)}:d)}))},f=(t,a,s)=>{o(d=>({...d,conditionGroups:d.conditionGroups.map(n=>n.id===t?{...n,conditions:n.conditions.map(c=>c.id===a?{...c,...s}:c)}:n)}))},R=()=>{o(t=>({...t,actions:[...t.actions,{id:crypto.randomUUID(),type:"send_alert",config:{},priority:t.actions.length+1}]}))},_=t=>{r.actions.length<=1||o(a=>({...a,actions:a.actions.filter(s=>s.id!==t)}))},g=(t,a)=>{o(s=>({...s,actions:s.actions.map(d=>d.id===t?{...d,...a}:d)}))},E=async()=>{await G(r)},l=t=>{b(a=>{const s=new Set(a);return s.has(t)?s.delete(t):s.add(t),s})};return e.jsxs("div",{className:"bg-card rounded-xl border",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(v,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:h?"Edit Custom Rule":"Create Custom Autopilot Rule"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enterprise feature for advanced automation"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-gradient-to-r from-purple-500/20 to-primary/20 text-primary text-xs font-medium",children:"Enterprise"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Rule Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>o(a=>({...a,name:t.target.value})),placeholder:"e.g., Scale High Performers",className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>o(a=>({...a,description:t.target.value})),placeholder:"Describe what this rule does and when it should trigger...",rows:2,className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20"})]})]})]}),e.jsx("div",{className:"flex border-b",children:[{id:"conditions",label:"Conditions",icon:M},{id:"actions",label:"Actions",icon:v},{id:"targeting",label:"Targeting",icon:B},{id:"schedule",label:"Schedule",icon:F},{id:"safety",label:"Safety & Trust",icon:w}].map(t=>e.jsxs("button",{onClick:()=>j(t.id),className:u("flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors",m===t.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]},t.id))}),e.jsxs("div",{className:"p-6",children:[m==="conditions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Trigger Conditions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define when this rule should trigger"})]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-3 py-1.5 text-sm rounded-lg border hover:bg-muted transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Add Group"]})]}),r.conditionGroups.map((t,a)=>e.jsxs("div",{className:"rounded-lg border",children:[a>0&&e.jsx("div",{className:"flex items-center justify-center -mt-3 mb-2",children:e.jsxs("select",{value:r.conditionLogic,onChange:s=>o(d=>({...d,conditionLogic:s.target.value})),className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary font-medium border-0",children:[e.jsx("option",{value:"AND",children:"AND"}),e.jsx("option",{value:"OR",children:"OR"})]})}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 cursor-pointer",onClick:()=>l(t.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x.has(t.id)?e.jsx($,{className:"w-4 h-4"}):e.jsx(z,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["Condition Group ",a+1]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",t.conditions.length," condition",t.conditions.length!==1?"s":"",")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:t.logic,onChange:s=>{s.stopPropagation(),o(d=>({...d,conditionGroups:d.conditionGroups.map(n=>n.id===t.id?{...n,logic:s.target.value}:n)}))},onClick:s=>s.stopPropagation(),className:"px-2 py-1 text-xs rounded border bg-background",children:[e.jsx("option",{value:"AND",children:"Match ALL"}),e.jsx("option",{value:"OR",children:"Match ANY"})]}),r.conditionGroups.length>1&&e.jsx("button",{onClick:s=>{s.stopPropagation(),S(t.id)},className:"p-1 rounded hover:bg-destructive/10 text-destructive",children:e.jsx(H,{className:"w-4 h-4"})})]})]}),x.has(t.id)&&e.jsxs("div",{className:"p-4 space-y-3",children:[t.conditions.map((s,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[d>0&&e.jsx("span",{className:"text-xs font-medium text-primary px-2",children:t.logic}),e.jsx("select",{value:s.field,onChange:n=>{const c=I.find(N=>N.value===n.target.value);f(t.id,s.id,{field:n.target.value,valueType:(c==null?void 0:c.valueType)||"number"})},className:"flex-1 px-3 py-2 rounded-lg border bg-background text-sm",children:Object.entries(I.reduce((n,c)=>(n[c.category]=n[c.category]||[],n[c.category].push(c),n),{})).map(([n,c])=>e.jsx("optgroup",{label:n,children:c.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))},n))}),e.jsx("select",{value:s.operator,onChange:n=>f(t.id,s.id,{operator:n.target.value}),className:"w-28 px-3 py-2 rounded-lg border bg-background text-sm",children:se.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[s.valueType==="currency"&&e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"$"}),e.jsx("input",{type:"text",value:s.value,onChange:n=>f(t.id,s.id,{value:n.target.value}),placeholder:"Value",className:u("w-28 px-3 py-2 rounded-lg border bg-background text-sm",s.valueType==="currency"&&"pl-7")}),s.valueType==="percentage"&&e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"%"})]}),t.conditions.length>1&&e.jsx("button",{onClick:()=>P(t.id,s.id),className:"p-1.5 rounded hover:bg-destructive/10 text-muted-foreground hover:text-destructive",children:e.jsx(Y,{className:"w-4 h-4"})})]},s.id)),e.jsxs("button",{onClick:()=>A(t.id),className:"flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(k,{className:"w-4 h-4"}),"Add Condition"]})]})]},t.id))]}),m==="actions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Actions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"What should happen when conditions are met"})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-3 py-1.5 text-sm rounded-lg border hover:bg-muted transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Add Action"]})]}),r.actions.map((t,a)=>e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-medium text-sm",children:a+1}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("select",{value:t.type,onChange:s=>g(t.id,{type:s.target.value,config:{}}),className:"w-full px-3 py-2 rounded-lg border bg-background text-sm",children:Object.entries(ae.reduce((s,d)=>(s[d.category]=s[d.category]||[],s[d.category].push(d),s),{})).map(([s,d])=>e.jsx("optgroup",{label:s,children:d.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))},s))}),(t.type==="adjust_budget"||t.type==="scale_budget")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Adjustment:"}),e.jsxs("select",{value:t.config.direction||"increase",onChange:s=>g(t.id,{config:{...t.config,direction:s.target.value}}),className:"px-2 py-1 rounded border bg-background text-sm",children:[e.jsx("option",{value:"increase",children:"Increase by"}),e.jsx("option",{value:"decrease",children:"Decrease by"})]}),e.jsx("input",{type:"number",value:t.config.amount||"",onChange:s=>g(t.id,{config:{...t.config,amount:s.target.value}}),placeholder:"10",className:"w-20 px-2 py-1 rounded border bg-background text-sm"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"%"})]}),t.type==="set_budget"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Set to:"}),e.jsx("span",{className:"text-muted-foreground",children:"$"}),e.jsx("input",{type:"number",value:t.config.amount||"",onChange:s=>g(t.id,{config:{...t.config,amount:s.target.value}}),placeholder:"100",className:"w-28 px-2 py-1 rounded border bg-background text-sm"})]}),t.type==="apply_label"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Label:"}),e.jsx("input",{type:"text",value:t.config.label||"",onChange:s=>g(t.id,{config:{...t.config,label:s.target.value}}),placeholder:"e.g., high-performer",className:"flex-1 px-2 py-1 rounded border bg-background text-sm"})]}),t.type==="notify_slack"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Channel:"}),e.jsx("input",{type:"text",value:t.config.channel||"",onChange:s=>g(t.id,{config:{...t.config,channel:s.target.value}}),placeholder:"#marketing-alerts",className:"flex-1 px-2 py-1 rounded border bg-background text-sm"})]})]}),r.actions.length>1&&e.jsx("button",{onClick:()=>_(t.id),className:"p-1.5 rounded hover:bg-destructive/10 text-muted-foreground hover:text-destructive",children:e.jsx(H,{className:"w-4 h-4"})})]})},t.id))]}),m==="targeting"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Platforms"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Select which ad platforms this rule applies to"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[le.map(t=>e.jsx("button",{onClick:()=>{o(a=>({...a,targeting:{...a.targeting,platforms:a.targeting.platforms.includes(t.value)?a.targeting.platforms.filter(s=>s!==t.value):[...a.targeting.platforms,t.value]}}))},className:u("px-3 py-2 rounded-lg border text-sm transition-colors",r.targeting.platforms.includes(t.value)?"bg-primary text-primary-foreground border-primary":"hover:bg-muted"),children:t.label},t.value)),r.targeting.platforms.length===0&&e.jsx("span",{className:"text-sm text-muted-foreground italic",children:"All platforms (no filter)"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Campaign Types"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Filter by campaign objective/type"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[re.map(t=>e.jsx("button",{onClick:()=>{o(a=>({...a,targeting:{...a.targeting,campaignTypes:a.targeting.campaignTypes.includes(t.value)?a.targeting.campaignTypes.filter(s=>s!==t.value):[...a.targeting.campaignTypes,t.value]}}))},className:u("px-3 py-2 rounded-lg border text-sm transition-colors",r.targeting.campaignTypes.includes(t.value)?"bg-primary text-primary-foreground border-primary":"hover:bg-muted"),children:t.label},t.value)),r.targeting.campaignTypes.length===0&&e.jsx("span",{className:"text-sm text-muted-foreground italic",children:"All types (no filter)"})]})]})]}),m==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Enable Schedule"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Run this rule on a schedule instead of continuously"})]}),e.jsx("button",{onClick:()=>o(t=>({...t,schedule:{...t.schedule,enabled:!t.schedule.enabled}})),className:u("w-12 h-6 rounded-full transition-colors relative",r.schedule.enabled?"bg-primary":"bg-muted"),children:e.jsx("div",{className:u("absolute w-5 h-5 rounded-full bg-white top-0.5 transition-all",r.schedule.enabled?"left-6":"left-0.5")})})]}),r.schedule.enabled&&e.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Frequency"}),e.jsxs("select",{value:r.schedule.frequency,onChange:t=>o(a=>({...a,schedule:{...a.schedule,frequency:t.target.value}})),className:"w-full px-3 py-2 rounded-lg border bg-background text-sm",children:[e.jsx("option",{value:"hourly",children:"Every Hour"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Timezone"}),e.jsxs("select",{value:r.schedule.timezone,onChange:t=>o(a=>({...a,schedule:{...a.schedule,timezone:t.target.value}})),className:"w-full px-3 py-2 rounded-lg border bg-background text-sm",children:[e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"America/New_York",children:"Eastern Time"}),e.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time"}),e.jsx("option",{value:"Europe/London",children:"London"}),e.jsx("option",{value:"Asia/Dubai",children:"Dubai"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Cooldown Period"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:r.cooldownHours,onChange:t=>o(a=>({...a,cooldownHours:parseInt(t.target.value)||0})),className:"w-20 px-3 py-2 rounded-lg border bg-background text-sm"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"hours"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum time between rule executions"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Max Executions/Day"}),e.jsx("input",{type:"number",value:r.maxExecutionsPerDay,onChange:t=>o(a=>({...a,maxExecutionsPerDay:parseInt(t.target.value)||1})),className:"w-20 px-3 py-2 rounded-lg border bg-background text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Limit executions per 24 hours"})]})]})]}),m==="safety"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-700 dark:text-amber-400",children:"Trust-Gated Execution"}),e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-300 mt-1",children:"Actions are only executed when signal health meets the threshold. This protects against automation during data quality issues."})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Enable Trust Gate"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check signal health before executing actions"})]}),e.jsx("button",{onClick:()=>o(t=>({...t,trustGate:{...t.trustGate,enabled:!t.trustGate.enabled}})),className:u("w-12 h-6 rounded-full transition-colors relative",r.trustGate.enabled?"bg-primary":"bg-muted"),children:e.jsx("div",{className:u("absolute w-5 h-5 rounded-full bg-white top-0.5 transition-all",r.trustGate.enabled?"left-6":"left-0.5")})})]}),r.trustGate.enabled&&e.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Minimum Signal Health Score: ",r.trustGate.minSignalHealth]}),e.jsx("input",{type:"range",min:"0",max:"100",value:r.trustGate.minSignalHealth,onChange:t=>o(a=>({...a,trustGate:{...a.trustGate,minSignalHealth:parseInt(t.target.value)}})),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:"0 (No check)"}),e.jsx("span",{className:"text-amber-500",children:"40 (Hold)"}),e.jsx("span",{className:"text-green-500",children:"70 (Pass)"}),e.jsx("span",{children:"100"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",children:"Require Manual Approval"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Queue actions for review before execution"})]}),e.jsx("button",{onClick:()=>o(t=>({...t,trustGate:{...t.trustGate,requireApproval:!t.trustGate.requireApproval}})),className:u("w-10 h-5 rounded-full transition-colors relative",r.trustGate.requireApproval?"bg-primary":"bg-muted"),children:e.jsx("div",{className:u("absolute w-4 h-4 rounded-full bg-white top-0.5 transition-all",r.trustGate.requireApproval?"left-5":"left-0.5")})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",children:"Dry Run First"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Simulate action before first real execution"})]}),e.jsx("button",{onClick:()=>o(t=>({...t,trustGate:{...t.trustGate,dryRunFirst:!t.trustGate.dryRunFirst}})),className:u("w-10 h-5 rounded-full transition-colors relative",r.trustGate.dryRunFirst?"bg-primary":"bg-muted"),children:e.jsx("div",{className:u("absolute w-4 h-4 rounded-full bg-white top-0.5 transition-all",r.trustGate.dryRunFirst?"left-5":"left-0.5")})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Rules are evaluated continuously unless scheduled"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 rounded-lg border hover:bg-muted transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>o(t=>({...t,status:"draft"})),className:"px-4 py-2 rounded-lg border hover:bg-muted transition-colors",children:"Save as Draft"}),e.jsxs("button",{onClick:E,disabled:T||!r.name,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors disabled:opacity-50",children:[T?e.jsx(K,{className:"w-4 h-4 animate-spin"}):e.jsx(ee,{className:"w-4 h-4"}),h?"Update Rule":"Create Rule"]})]})]})]})}const ie=[{id:"1",name:"Scale High ROAS Campaigns",description:"Automatically increase budget by 20% when ROAS exceeds 4x for 3 consecutive days",status:"active",conditionGroups:[{id:"1",logic:"AND",conditions:[{id:"1",field:"roas",operator:"gt",value:"4.0",valueType:"number"},{id:"2",field:"days_running",operator:"gte",value:"3",valueType:"number"}]}],conditionLogic:"AND",actions:[{id:"1",type:"scale_budget",config:{direction:"increase",amount:"20"},priority:1}],targeting:{platforms:["meta","google"],campaignTypes:[],specificCampaigns:[]},schedule:{enabled:!1,frequency:"hourly",timezone:"UTC"},trustGate:{enabled:!0,minSignalHealth:70,requireApproval:!1,dryRunFirst:!0},cooldownHours:48,maxExecutionsPerDay:5,triggerCount:23,lastTriggered:"2024-12-10T14:30:00Z",createdAt:"2024-11-01"},{id:"2",name:"Pause Underperformers",description:"Pause campaigns with CPA > $50 and less than 10 conversions after 7 days",status:"active",conditionGroups:[{id:"1",logic:"AND",conditions:[{id:"1",field:"cpa",operator:"gt",value:"50",valueType:"currency"},{id:"2",field:"conversions",operator:"lt",value:"10",valueType:"number"},{id:"3",field:"days_running",operator:"gte",value:"7",valueType:"number"}]}],conditionLogic:"AND",actions:[{id:"1",type:"pause_campaign",config:{},priority:1}],targeting:{platforms:[],campaignTypes:["prospecting"],specificCampaigns:[]},schedule:{enabled:!1,frequency:"hourly",timezone:"UTC"},trustGate:{enabled:!0,minSignalHealth:70,requireApproval:!0,dryRunFirst:!1},cooldownHours:24,maxExecutionsPerDay:10,triggerCount:8,lastTriggered:"2024-12-08T09:15:00Z",createdAt:"2024-10-15"},{id:"3",name:"Creative Fatigue Alert",description:"Send Slack notification when creative fatigue score exceeds 70%",status:"paused",conditionGroups:[{id:"1",logic:"AND",conditions:[{id:"1",field:"fatigue_score",operator:"gt",value:"70",valueType:"percentage"}]}],conditionLogic:"AND",actions:[{id:"1",type:"notify_slack",config:{channel:"#creative-alerts"},priority:1}],targeting:{platforms:["meta"],campaignTypes:[],specificCampaigns:[]},schedule:{enabled:!0,frequency:"daily",timezone:"America/New_York"},trustGate:{enabled:!1,minSignalHealth:0,requireApproval:!1,dryRunFirst:!1},cooldownHours:24,maxExecutionsPerDay:3,triggerCount:15,lastTriggered:"2024-12-05T10:00:00Z",createdAt:"2024-09-20"}];function Te(){const[h,G]=p.useState(""),[y,T]=p.useState("all"),[r,o]=p.useState(!1),[m,j]=p.useState(null),[x,b]=p.useState(ie),[D,S]=p.useState(!1),A=x.filter(l=>!(h&&!l.name.toLowerCase().includes(h.toLowerCase())||y!=="all"&&l.status!==y)),P=async l=>{S(!0),await new Promise(i=>setTimeout(i,1e3)),b(m?i=>i.map(t=>t.id===m.id?{...l,id:m.id}:t):i=>[...i,{...l,id:crypto.randomUUID(),triggerCount:0,lastTriggered:null}]),S(!1),o(!1),j(null)},f=l=>{b(i=>i.map(t=>t.id===l?{...t,status:t.status==="active"?"paused":"active"}:t))},R=l=>{confirm("Are you sure you want to delete this rule?")&&b(i=>i.filter(t=>t.id!==l))},_=l=>{b(i=>[...i,{...l,id:crypto.randomUUID(),name:`${l.name} (Copy)`,status:"draft",triggerCount:0,lastTriggered:null,createdAt:new Date().toISOString().split("T")[0]}])},g=l=>{const i={active:{color:"bg-green-500/10 text-green-500",icon:Q,label:"Active"},paused:{color:"bg-amber-500/10 text-amber-500",icon:C,label:"Paused"},draft:{color:"bg-gray-500/10 text-gray-500",icon:U,label:"Draft"}},{color:t,icon:a,label:s}=i[l]||i.draft;return e.jsxs("span",{className:u("px-2 py-1 rounded-full text-xs font-medium inline-flex items-center gap-1",t),children:[e.jsx(a,{className:"w-3 h-3"}),s]})},E=l=>{if(!l)return"Never";const i=new Date(l),a=Math.floor((new Date().getTime()-i.getTime())/(1e3*60*60));return a<1?"Just now":a<24?`${a}h ago`:a<48?"Yesterday":i.toLocaleDateString()};return r||m?e.jsx("div",{className:"p-6",children:e.jsx(ne,{rule:m||void 0,onSave:P,onCancel:()=>{o(!1),j(null)},isLoading:D})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(v,{className:"w-7 h-7 text-primary"}),"Custom Autopilot Rules"]}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-gradient-to-r from-purple-500/20 to-primary/20 text-primary text-xs font-medium",children:"Enterprise"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Create advanced automation rules with multi-condition logic and trust-gated execution"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Rule"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Rules"}),e.jsx("p",{className:"text-2xl font-bold",children:x.length})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:x.filter(l=>l.status==="active").length})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Paused"}),e.jsx("p",{className:"text-2xl font-bold text-amber-500",children:x.filter(l=>l.status==="paused").length})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Executions (7d)"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:x.reduce((l,i)=>l+i.triggerCount,0)})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Trust-Gated"}),e.jsx("p",{className:"text-2xl font-bold",children:x.filter(l=>l.trustGate.enabled).length})]})]}),e.jsx("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Trust-Gated Automation"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Custom rules respect Stratum's Trust Gate. Actions are only executed when signal health meets your configured threshold, protecting against automation during data quality issues."})]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search rules...",value:h,onChange:l=>G(l.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("select",{value:y,onChange:l=>T(l.target.value),className:"px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"draft",children:"Draft"})]})]}),e.jsx("div",{className:"space-y-4",children:A.map(l=>e.jsxs("div",{className:"rounded-xl border bg-card p-5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(v,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:l.name}),g(l.status),l.trustGate.enabled&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-500 text-xs font-medium inline-flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),"Trust-Gated"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.status==="active"?e.jsx("button",{onClick:()=>f(l.id),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Pause",children:e.jsx(C,{className:"w-4 h-4"})}):e.jsx("button",{onClick:()=>f(l.id),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Activate",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(l),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(l),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Duplicate",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(l.id),className:"p-2 rounded-lg hover:bg-destructive/10 hover:text-destructive transition-colors",title:"Delete",children:e.jsx(H,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-primary",children:"IF"}),l.conditionGroups.map((i,t)=>e.jsxs("span",{className:"flex items-center gap-2",children:[t>0&&e.jsx("span",{className:"text-primary font-medium",children:l.conditionLogic}),e.jsx("span",{className:"text-muted-foreground",children:"("}),i.conditions.map((a,s)=>e.jsxs("span",{className:"flex items-center gap-1",children:[s>0&&e.jsx("span",{className:"text-xs text-primary",children:i.logic}),e.jsx("code",{className:"px-1.5 py-0.5 rounded bg-background text-xs",children:a.field}),e.jsx("span",{className:"font-mono text-xs",children:a.operator==="gt"?">":a.operator==="lt"?"<":a.operator}),e.jsx("code",{className:"px-1.5 py-0.5 rounded bg-background text-xs",children:a.valueType==="currency"?`$${a.value}`:a.valueType==="percentage"?`${a.value}%`:a.value})]},a.id)),e.jsx("span",{className:"text-muted-foreground",children:")"})]},i.id)),e.jsx("span",{className:"font-medium text-primary",children:"THEN"}),l.actions.map(i=>e.jsxs("code",{className:"px-1.5 py-0.5 rounded bg-primary/10 text-primary text-xs",children:[i.type.replace("_"," "),i.config.amount&&` ${i.config.direction==="decrease"?"-":"+"}${i.config.amount}%`]},i.id))]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[l.targeting.platforms.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Platforms:"}),e.jsx("span",{className:"font-medium",children:l.targeting.platforms.join(", ")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Cooldown:"}),e.jsxs("span",{className:"font-medium",children:[l.cooldownHours,"h"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Triggered:"}),e.jsxs("span",{className:"font-medium",children:[l.triggerCount," times"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last:"}),e.jsx("span",{className:"font-medium",children:E(l.lastTriggered)})]}),l.trustGate.enabled&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Min Health:"}),e.jsx("span",{className:"font-medium",children:l.trustGate.minSignalHealth})]})]})]},l.id))}),A.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No rules found"}),e.jsx("button",{onClick:()=>o(!0),className:"mt-4 text-primary hover:underline",children:"Create your first custom rule"})]})]})}export{Te as default};
//# sourceMappingURL=CustomAutopilotRules-De4f8KUK.js.map
