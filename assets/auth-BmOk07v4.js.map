{"version":3,"file":"auth-BmOk07v4.js","sources":["../../src/api/auth.ts"],"sourcesContent":["/**\r\n * Stratum AI - Auth API\r\n *\r\n * Authentication endpoints for signup, login, email verification,\r\n * password reset, and token management.\r\n */\r\n\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiClient, ApiResponse, setAccessToken } from './client';\r\n\r\n// Types\r\nexport interface User {\r\n  id: number;\r\n  email: string;\r\n  name: string;\r\n  role: 'superadmin' | 'admin' | 'user';\r\n  tenant_id: number | null;\r\n  is_active: boolean;\r\n  is_verified: boolean;\r\n  preferences?: Record<string, unknown>;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface AuthTokens {\r\n  access_token: string;\r\n  refresh_token: string;\r\n  token_type: string;\r\n  expires_in: number;\r\n}\r\n\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n  remember_me?: boolean;\r\n}\r\n\r\nexport interface LoginResponse {\r\n  user: User;\r\n  tokens: AuthTokens;\r\n}\r\n\r\nexport interface SignupRequest {\r\n  name: string;\r\n  email: string;\r\n  password: string;\r\n  phone?: string;\r\n  company?: string;\r\n  verification_token?: string;\r\n}\r\n\r\nexport interface SignupResponse {\r\n  user: User;\r\n  message: string;\r\n}\r\n\r\nexport interface VerifyEmailRequest {\r\n  token: string;\r\n}\r\n\r\nexport interface VerifyEmailResponse {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\nexport interface ForgotPasswordRequest {\r\n  email: string;\r\n}\r\n\r\nexport interface ForgotPasswordResponse {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\nexport interface ResetPasswordRequest {\r\n  token: string;\r\n  password: string;\r\n}\r\n\r\nexport interface ResetPasswordResponse {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\nexport interface ResendVerificationRequest {\r\n  email: string;\r\n}\r\n\r\nexport interface ResendVerificationResponse {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\n// WhatsApp OTP Types\r\nexport interface SendWhatsAppOTPRequest {\r\n  phone_number: string;\r\n}\r\n\r\nexport interface SendWhatsAppOTPResponse {\r\n  message: string;\r\n  expires_in: number;\r\n}\r\n\r\nexport interface VerifyWhatsAppOTPRequest {\r\n  phone_number: string;\r\n  otp_code: string;\r\n}\r\n\r\nexport interface VerifyWhatsAppOTPResponse {\r\n  verified: boolean;\r\n  verification_token: string | null;\r\n}\r\n\r\n// API Functions\r\nexport const authApi = {\r\n  /**\r\n   * Register a new user\r\n   */\r\n  signup: async (data: SignupRequest): Promise<SignupResponse> => {\r\n    const response = await apiClient.post<ApiResponse<SignupResponse>>('/auth/register', data);\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Login with email and password\r\n   */\r\n  login: async (data: LoginRequest): Promise<LoginResponse> => {\r\n    const response = await apiClient.post<ApiResponse<LoginResponse>>('/auth/login', data);\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Verify email with token\r\n   */\r\n  verifyEmail: async (data: VerifyEmailRequest): Promise<VerifyEmailResponse> => {\r\n    const response = await apiClient.post<ApiResponse<VerifyEmailResponse>>(\r\n      '/auth/verify-email',\r\n      data\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Request password reset\r\n   */\r\n  forgotPassword: async (data: ForgotPasswordRequest): Promise<ForgotPasswordResponse> => {\r\n    const response = await apiClient.post<ApiResponse<ForgotPasswordResponse>>(\r\n      '/auth/forgot-password',\r\n      data\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Reset password with token\r\n   */\r\n  resetPassword: async (data: ResetPasswordRequest): Promise<ResetPasswordResponse> => {\r\n    const response = await apiClient.post<ApiResponse<ResetPasswordResponse>>(\r\n      '/auth/reset-password',\r\n      data\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Resend verification email\r\n   */\r\n  resendVerification: async (\r\n    data: ResendVerificationRequest\r\n  ): Promise<ResendVerificationResponse> => {\r\n    const response = await apiClient.post<ApiResponse<ResendVerificationResponse>>(\r\n      '/auth/resend-verification',\r\n      data\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Send WhatsApp OTP for phone verification\r\n   */\r\n  sendWhatsAppOTP: async (data: SendWhatsAppOTPRequest): Promise<SendWhatsAppOTPResponse> => {\r\n    const response = await apiClient.post<ApiResponse<SendWhatsAppOTPResponse>>(\r\n      '/auth/whatsapp/send-otp',\r\n      data\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Verify WhatsApp OTP code\r\n   */\r\n  verifyWhatsAppOTP: async (data: VerifyWhatsAppOTPRequest): Promise<VerifyWhatsAppOTPResponse> => {\r\n    const response = await apiClient.post<ApiResponse<VerifyWhatsAppOTPResponse>>(\r\n      '/auth/whatsapp/verify-otp',\r\n      data\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Logout - invalidate tokens\r\n   */\r\n  logout: async (): Promise<void> => {\r\n    await apiClient.post('/auth/logout');\r\n  },\r\n\r\n  /**\r\n   * Get current user profile\r\n   */\r\n  getCurrentUser: async (): Promise<User> => {\r\n    const response = await apiClient.get<ApiResponse<User>>('/auth/me');\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Update current user preferences\r\n   */\r\n  updatePreferences: async (preferences: Record<string, unknown>): Promise<User> => {\r\n    const response = await apiClient.patch<ApiResponse<User>>('/users/me', { preferences });\r\n    return response.data.data;\r\n  },\r\n\r\n  /**\r\n   * Refresh access token\r\n   */\r\n  refreshToken: async (refreshToken: string): Promise<AuthTokens> => {\r\n    const response = await apiClient.post<ApiResponse<AuthTokens>>('/auth/refresh', {\r\n      refresh_token: refreshToken,\r\n    });\r\n    return response.data.data;\r\n  },\r\n};\r\n\r\n// React Query Hooks\r\n\r\n/**\r\n * Hook for user signup\r\n */\r\nexport function useSignup() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: authApi.signup,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['auth'] });\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for user login\r\n */\r\nexport function useLogin() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: authApi.login,\r\n    onSuccess: (data) => {\r\n      setAccessToken(data.tokens.access_token);\r\n      localStorage.setItem('refresh_token', data.tokens.refresh_token);\r\n      queryClient.setQueryData(['auth', 'user'], data.user);\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for email verification\r\n */\r\nexport function useVerifyEmail() {\r\n  return useMutation({\r\n    mutationFn: authApi.verifyEmail,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for forgot password\r\n */\r\nexport function useForgotPassword() {\r\n  return useMutation({\r\n    mutationFn: authApi.forgotPassword,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for password reset\r\n */\r\nexport function useResetPassword() {\r\n  return useMutation({\r\n    mutationFn: authApi.resetPassword,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for resending verification email\r\n */\r\nexport function useResendVerification() {\r\n  return useMutation({\r\n    mutationFn: authApi.resendVerification,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for logout\r\n */\r\nexport function useLogout() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: authApi.logout,\r\n    onSuccess: () => {\r\n      setAccessToken(null);\r\n      localStorage.removeItem('refresh_token');\r\n      queryClient.clear();\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for getting current user\r\n */\r\nexport function useCurrentUser(enabled = true) {\r\n  return useQuery({\r\n    queryKey: ['auth', 'user'],\r\n    queryFn: authApi.getCurrentUser,\r\n    enabled,\r\n    staleTime: 5 * 60 * 1000, // 5 minutes\r\n    retry: false,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for updating user notification preferences\r\n */\r\nexport function useUpdatePreferences() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: authApi.updatePreferences,\r\n    onSuccess: (updatedUser) => {\r\n      queryClient.setQueryData(['auth', 'user'], updatedUser);\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for sending WhatsApp OTP\r\n */\r\nexport function useSendWhatsAppOTP() {\r\n  return useMutation({\r\n    mutationFn: authApi.sendWhatsAppOTP,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for verifying WhatsApp OTP\r\n */\r\nexport function useVerifyWhatsAppOTP() {\r\n  return useMutation({\r\n    mutationFn: authApi.verifyWhatsAppOTP,\r\n  });\r\n}\r\n"],"names":["authApi","data","apiClient","preferences","useSignup","queryClient","useQueryClient","useMutation","useVerifyEmail","useForgotPassword","useResetPassword","useResendVerification","useCurrentUser","enabled","useQuery","useUpdatePreferences","updatedUser"],"mappings":"gGAkHO,MAAMA,EAAU,CAIrB,OAAQ,MAAOC,IACI,MAAMC,EAAU,KAAkC,iBAAkBD,CAAI,GACzE,KAAK,KAcvB,YAAa,MAAOA,IACD,MAAMC,EAAU,KAC/B,qBACAD,CAAA,GAEc,KAAK,KAMvB,eAAgB,MAAOA,IACJ,MAAMC,EAAU,KAC/B,wBACAD,CAAA,GAEc,KAAK,KAMvB,cAAe,MAAOA,IACH,MAAMC,EAAU,KAC/B,uBACAD,CAAA,GAEc,KAAK,KAMvB,mBAAoB,MAClBA,IAEiB,MAAMC,EAAU,KAC/B,4BACAD,CAAA,GAEc,KAAK,KAmCvB,eAAgB,UACG,MAAMC,EAAU,IAAuB,UAAU,GAClD,KAAK,KAMvB,kBAAmB,MAAOC,IACP,MAAMD,EAAU,MAAyB,YAAa,CAAE,YAAAC,EAAa,GACtE,KAAK,IAYzB,EAOO,SAASC,GAAY,CAC1B,MAAMC,EAAcC,EAAA,EAEpB,OAAOC,EAAY,CACjB,WAAYP,EAAQ,OACpB,UAAW,IAAM,CACfK,EAAY,kBAAkB,CAAE,SAAU,CAAC,MAAM,EAAG,CACtD,CAAA,CACD,CACH,CAqBO,SAASG,GAAiB,CAC/B,OAAOD,EAAY,CACjB,WAAYP,EAAQ,WAAA,CACrB,CACH,CAKO,SAASS,GAAoB,CAClC,OAAOF,EAAY,CACjB,WAAYP,EAAQ,cAAA,CACrB,CACH,CAKO,SAASU,GAAmB,CACjC,OAAOH,EAAY,CACjB,WAAYP,EAAQ,aAAA,CACrB,CACH,CAKO,SAASW,GAAwB,CACtC,OAAOJ,EAAY,CACjB,WAAYP,EAAQ,kBAAA,CACrB,CACH,CAqBO,SAASY,EAAeC,EAAU,GAAM,CAC7C,OAAOC,EAAS,CACd,SAAU,CAAC,OAAQ,MAAM,EACzB,QAASd,EAAQ,eACjB,QAAAa,EACA,UAAW,EAAI,GAAK,IACpB,MAAO,EAAA,CACR,CACH,CAKO,SAASE,GAAuB,CACrC,MAAMV,EAAcC,EAAA,EAEpB,OAAOC,EAAY,CACjB,WAAYP,EAAQ,kBACpB,UAAYgB,GAAgB,CAC1BX,EAAY,aAAa,CAAC,OAAQ,MAAM,EAAGW,CAAW,CACxD,CAAA,CACD,CACH"}