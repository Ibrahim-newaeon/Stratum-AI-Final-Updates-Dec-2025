import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as u,L as $}from"./vendor-react-Dz7uKsMg.js";import{c as j,ai as D,a8 as I,e as E,ab as M,ac as z,F as _}from"./index-BQex3859.js";import{e as O,f as A,g as T}from"./cdp-B6W0ktOz.js";import{F as H}from"./ArrowDownTrayIcon-BpDtmKr2.js";import{F as V}from"./MagnifyingGlassIcon-3MUvqIvj.js";import{F as p}from"./UserCircleIcon-C5qf10f0.js";import{F as q}from"./CalendarIcon-LISB5gLp.js";import{F as B}from"./DevicePhoneMobileIcon-Dd0vk1HG.js";import{F as G}from"./PhoneIcon-Ct1N2tQX.js";import{F as J}from"./EnvelopeIcon-CWLK6IWu.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";function k({stage:r}){const d={anonymous:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",known:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",customer:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",churned:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"};return e.jsx("span",{className:j("px-2 py-1 rounded-full text-xs font-medium capitalize",d[r]),children:r})}function S({type:r}){const s={email:J,phone:G,device_id:B,anonymous_id:p,external_id:p}[r]||p;return e.jsx(s,{className:"h-4 w-4 text-muted-foreground"})}function K({profileId:r,onClose:d}){var a,o;const{data:s,isLoading:c}=T(r);return c?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsx("div",{className:"bg-card rounded-xl p-8",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})})}):s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:d,children:e.jsxs("div",{className:"bg-card rounded-xl border shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-stratum flex items-center justify-center",children:e.jsx(p,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Profile Details"}),e.jsxs("p",{className:"text-sm text-muted-foreground font-mono",children:[s.id.slice(0,8),"..."]})]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-muted rounded-lg transition-colors",children:e.jsx(_,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)] space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Lifecycle"}),e.jsx("div",{className:"mt-1",children:e.jsx(k,{stage:s.lifecycle_stage})})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Events"}),e.jsx("p",{className:"font-semibold",children:s.total_events.toLocaleString()})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"}),e.jsxs("p",{className:"font-semibold",children:["$",s.total_revenue.toLocaleString()]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Purchases"}),e.jsx("p",{className:"font-semibold",children:s.total_purchases})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Identifiers (",((a=s.identifiers)==null?void 0:a.length)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[(o=s.identifiers)==null?void 0:o.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{type:l.identifier_type}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium capitalize",children:l.identifier_type.replace("_"," ")}),e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:[l.identifier_hash.slice(0,16),"..."]})]})]}),e.jsxs("div",{className:"text-right",children:[l.is_primary&&e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary text-xs rounded",children:"Primary"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Score: ",(l.confidence_score*100).toFixed(0),"%"]})]})]},l.id)),(!s.identifiers||s.identifiers.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No identifiers found"})]})]}),s.profile_data&&Object.keys(s.profile_data).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Profile Data"}),e.jsx("pre",{className:"bg-muted/50 rounded-lg p-3 text-xs overflow-x-auto",children:JSON.stringify(s.profile_data,null,2)})]}),s.computed_traits&&Object.keys(s.computed_traits).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Computed Traits"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(s.computed_traits).map(([l,m])=>e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:l}),e.jsx("p",{className:"text-sm font-medium",children:String(m)})]},l))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"First Seen"}),e.jsx("p",{className:"text-sm",children:new Date(s.first_seen_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Seen"}),e.jsx("p",{className:"text-sm",children:new Date(s.last_seen_at).toLocaleString()})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t",children:[e.jsx($,{to:`/dashboard/cdp/identity?profile=${s.id}`,className:"px-4 py-2 text-sm font-medium hover:bg-muted rounded-lg transition-colors",children:"View Identity Graph"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors",children:"Close"})]})]})}):null}function Q({filters:r,onFilterChange:d,onClose:s}){const c=["anonymous","known","customer","churned"];return e.jsxs("div",{className:"bg-card rounded-xl border p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Filters"}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-muted rounded",children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Lifecycle Stage"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:c.map(a=>{var o;return e.jsx("button",{onClick:()=>{const l=r.lifecycle_stages||[],m=l.includes(a)?l.filter(n=>n!==a):[...l,a];d({...r,lifecycle_stages:m.length>0?m:void 0})},className:j("px-3 py-1 rounded-full text-sm capitalize transition-colors",(o=r.lifecycle_stages)!=null&&o.includes(a)?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"),children:a},a)})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.has_email||!1,onChange:a=>d({...r,has_email:a.target.checked||void 0}),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:"Has Email"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.has_phone||!1,onChange:a=>d({...r,has_phone:a.target.checked||void 0}),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:"Has Phone"})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_customer||!1,onChange:a=>d({...r,is_customer:a.target.checked||void 0}),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:"Customers Only"})]}),e.jsx("button",{onClick:()=>d({}),className:"w-full py-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Clear All Filters"})]})}function oe(){var b,y;const[r,d]=u.useState(""),[s,c]=u.useState(1),[a,o]=u.useState(!1),[l,m]=u.useState(null),[n,F]=u.useState({}),h=20,{data:i,isLoading:P}=O({query:r||void 0,limit:h,offset:(s-1)*h,lifecycle_stages:n.lifecycle_stages,has_email:n.has_email,has_phone:n.has_phone,is_customer:n.is_customer,sort_by:"last_seen_at",sort_order:"desc"}),N=A(),f=Math.ceil(((i==null?void 0:i.total)||0)/h),C=async()=>{try{await N.mutateAsync({format:"csv",limit:1e3})}catch(t){console.error("Export failed:",t)}},g=u.useMemo(()=>{var x;let t=0;return(x=n.lifecycle_stages)!=null&&x.length&&t++,n.has_email&&t++,n.has_phone&&t++,n.is_customer&&t++,t},[n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Profiles"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[((b=i==null?void 0:i.total)==null?void 0:b.toLocaleString())||0," total profiles"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:C,disabled:N.isPending,className:"flex items-center gap-2 px-4 py-2 border rounded-lg hover:bg-muted transition-colors disabled:opacity-50",children:[e.jsx(H,{className:"h-4 w-4"}),"Export"]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",value:r,onChange:t=>{d(t.target.value),c(1)},placeholder:"Search by email, phone, or ID...",className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-primary focus:outline-none"})]}),e.jsxs("button",{onClick:()=>o(!a),className:j("flex items-center gap-2 px-4 py-2 border rounded-lg transition-colors",a||g>0?"bg-primary/10 border-primary":"hover:bg-muted"),children:[e.jsx(D,{className:"h-4 w-4"}),"Filters",g>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-primary text-primary-foreground text-xs rounded-full",children:g})]})]}),a&&e.jsx(Q,{filters:n,onFilterChange:t=>{F(t),c(1)},onClose:()=>o(!1)}),e.jsxs("div",{className:"bg-card rounded-xl border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Profile"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Lifecycle"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Identifiers"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Events"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Revenue"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Last Seen"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{children:P?Array.from({length:5}).map((t,x)=>e.jsx("tr",{className:"border-b",children:e.jsx("td",{colSpan:7,className:"px-4 py-4",children:e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"})})},x)):(i==null?void 0:i.profiles.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-12 text-center text-muted-foreground",children:"No profiles found"})}):i==null?void 0:i.profiles.map(t=>{var x,v,w;return e.jsxs("tr",{className:"border-b hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-stratum flex items-center justify-center",children:e.jsx(p,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium font-mono text-sm",children:[t.id.slice(0,8),"..."]}),t.external_id&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.external_id})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(k,{stage:t.lifecycle_stage})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[(x=t.identifiers)==null?void 0:x.slice(0,3).map((L,R)=>e.jsx(S,{type:L.identifier_type},R)),(((v=t.identifiers)==null?void 0:v.length)||0)>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",(((w=t.identifiers)==null?void 0:w.length)||0)-3]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.total_events.toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),t.total_revenue.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(q,{className:"h-4 w-4"}),new Date(t.last_seen_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>m(t.id),className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"View Details",children:e.jsx(E,{className:"h-4 w-4"})})})]},t.id)})})]})}),f>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",(s-1)*h+1," - ",Math.min(s*h,(i==null?void 0:i.total)||0)," of"," ",(y=i==null?void 0:i.total)==null?void 0:y.toLocaleString()," profiles"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(Math.max(1,s-1)),disabled:s===1,className:"p-2 hover:bg-muted rounded-lg transition-colors disabled:opacity-50",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Page ",s," of ",f]}),e.jsx("button",{onClick:()=>c(Math.min(f,s+1)),disabled:s===f,className:"p-2 hover:bg-muted rounded-lg transition-colors disabled:opacity-50",children:e.jsx(z,{className:"h-4 w-4"})})]})]})]}),l&&e.jsx(K,{profileId:l,onClose:()=>m(null)})]})}export{oe as default};
//# sourceMappingURL=CDPProfiles-BTEtJ1qc.js.map
