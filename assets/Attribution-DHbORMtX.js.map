{"version":3,"file":"Attribution-DHbORMtX.js","sources":["../../src/api/attribution.ts","../../src/views/tenant/Attribution.tsx"],"sourcesContent":["/**\r\n * Stratum AI - Attribution API\r\n *\r\n * Handles multi-touch attribution and data-driven attribution models.\r\n */\r\n\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiClient, ApiResponse } from './client';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport type AttributionModel =\r\n  | 'first_touch'\r\n  | 'last_touch'\r\n  | 'linear'\r\n  | 'position_based'\r\n  | 'time_decay'\r\n  | 'w_shaped'\r\n  | 'markov'\r\n  | 'shapley';\r\nexport type DataDrivenModelType = 'markov_chain' | 'shapley_value';\r\nexport type ModelStatus = 'training' | 'active' | 'archived' | 'failed';\r\n\r\n// Multi-Touch Attribution Types\r\nexport interface AttributionResult {\r\n  dealId: string;\r\n  dealName: string;\r\n  totalRevenue: number;\r\n  model: AttributionModel;\r\n  touchpoints: AttributedTouchpoint[];\r\n  conversionDate: string;\r\n}\r\n\r\nexport interface AttributedTouchpoint {\r\n  touchpointId: string;\r\n  channel: string;\r\n  source: string;\r\n  medium?: string;\r\n  campaign?: string;\r\n  platform?: string;\r\n  timestamp: string;\r\n  position: number;\r\n  weight: number;\r\n  attributedRevenue: number;\r\n}\r\n\r\nexport interface AttributionSummary {\r\n  channel: string;\r\n  platform?: string;\r\n  campaign?: string;\r\n  touchpoints: number;\r\n  conversions: number;\r\n  attributedRevenue: number;\r\n  avgWeight: number;\r\n  firstTouchCount: number;\r\n  lastTouchCount: number;\r\n  assistedConversions: number;\r\n}\r\n\r\nexport interface DailyAttributedRevenue {\r\n  date: string;\r\n  model: AttributionModel;\r\n  channel: string;\r\n  platform?: string;\r\n  attributedRevenue: number;\r\n  conversions: number;\r\n  touchpoints: number;\r\n}\r\n\r\nexport interface ConversionPath {\r\n  path: string;\r\n  conversions: number;\r\n  revenue: number;\r\n  avgTouchpoints: number;\r\n  avgDaysToConvert: number;\r\n  conversionRate: number;\r\n}\r\n\r\nexport interface ChannelInteraction {\r\n  fromChannel: string;\r\n  toChannel: string;\r\n  transitions: number;\r\n  conversionRate: number;\r\n}\r\n\r\nexport interface JourneyVisualization {\r\n  contact: {\r\n    id: string;\r\n    email?: string;\r\n    name?: string;\r\n  };\r\n  touchpoints: {\r\n    id: string;\r\n    channel: string;\r\n    source: string;\r\n    timestamp: string;\r\n    isConverting: boolean;\r\n  }[];\r\n  deals: {\r\n    id: string;\r\n    name: string;\r\n    amount: number;\r\n    stage: string;\r\n    closeDate?: string;\r\n  }[];\r\n  timeline: {\r\n    date: string;\r\n    events: Array<{\r\n      type: 'touchpoint' | 'deal_created' | 'deal_won';\r\n      data: any;\r\n    }>;\r\n  }[];\r\n}\r\n\r\nexport interface AttributionComparison {\r\n  models: AttributionModel[];\r\n  channels: Array<{\r\n    channel: string;\r\n    byModel: Record<\r\n      AttributionModel,\r\n      {\r\n        revenue: number;\r\n        conversions: number;\r\n        share: number;\r\n      }\r\n    >;\r\n  }>;\r\n  totalRevenue: number;\r\n  insight: string;\r\n}\r\n\r\n// Data-Driven Attribution Types\r\nexport interface TrainedAttributionModel {\r\n  id: string;\r\n  tenantId: number;\r\n  modelName: string;\r\n  modelType: DataDrivenModelType;\r\n  channelType: string;\r\n  status: ModelStatus;\r\n  isActive: boolean;\r\n  trainingStart: string;\r\n  trainingEnd: string;\r\n  journeyCount: number;\r\n  convertingJourneys: number;\r\n  uniqueChannels: number;\r\n  attributionWeights: Record<string, number>;\r\n  removalEffects?: Record<string, number>;\r\n  shapleyValues?: Record<string, number>;\r\n  baselineConversionRate?: number;\r\n  validationAccuracy?: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface ModelTrainingRun {\r\n  id: string;\r\n  tenantId: number;\r\n  modelId?: string;\r\n  modelType: DataDrivenModelType;\r\n  channelType: string;\r\n  status: ModelStatus;\r\n  trainingStart: string;\r\n  trainingEnd: string;\r\n  startedAt: string;\r\n  completedAt?: string;\r\n  durationSeconds?: number;\r\n  journeyCount?: number;\r\n  convertingJourneys?: number;\r\n  uniqueChannels?: number;\r\n  errorMessage?: string;\r\n}\r\n\r\nexport interface MarkovModelResult {\r\n  modelId: string;\r\n  transitionMatrix: Record<string, Record<string, number>>;\r\n  removalEffects: Record<string, number>;\r\n  attributionWeights: Record<string, number>;\r\n  baselineConversionRate: number;\r\n  channelImportance: Array<{\r\n    channel: string;\r\n    removalEffect: number;\r\n    attributionWeight: number;\r\n  }>;\r\n}\r\n\r\nexport interface ShapleyModelResult {\r\n  modelId: string;\r\n  shapleyValues: Record<string, number>;\r\n  attributionWeights: Record<string, number>;\r\n  channelContributions: Array<{\r\n    channel: string;\r\n    shapleyValue: number;\r\n    normalizedWeight: number;\r\n  }>;\r\n}\r\n\r\nexport interface ModelComparison {\r\n  ruleBasedModels: Record<AttributionModel, Record<string, number>>;\r\n  dataDrivenModels: Record<DataDrivenModelType, Record<string, number>>;\r\n  recommendation: {\r\n    bestModel: string;\r\n    reason: string;\r\n    confidenceScore: number;\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// API Functions\r\n// =============================================================================\r\n\r\nexport const attributionApi = {\r\n  // Multi-Touch Attribution\r\n  attributeDeal: async (dealId: string, model: AttributionModel) => {\r\n    const response = await apiClient.get<ApiResponse<AttributionResult>>(\r\n      `/attribution/deals/${dealId}`,\r\n      {\r\n        params: { model },\r\n      }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  batchAttributeDeals: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    model: AttributionModel;\r\n  }) => {\r\n    const response = await apiClient.post<\r\n      ApiResponse<{ processed: number; results: AttributionResult[] }>\r\n    >('/attribution/batch', params);\r\n    return response.data.data;\r\n  },\r\n\r\n  getAttributionSummary: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    model: AttributionModel;\r\n    groupBy?: 'channel' | 'platform' | 'campaign';\r\n  }) => {\r\n    const response = await apiClient.get<ApiResponse<AttributionSummary[]>>(\r\n      '/attribution/summary',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getDailyAttributedRevenue: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    model: AttributionModel;\r\n    channel?: string;\r\n  }) => {\r\n    const response = await apiClient.get<ApiResponse<DailyAttributedRevenue[]>>(\r\n      '/attribution/daily',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  compareModels: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    models: AttributionModel[];\r\n  }) => {\r\n    const response = await apiClient.get<ApiResponse<AttributionComparison>>(\r\n      '/attribution/compare',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  // Journey Analysis\r\n  getContactJourney: async (contactId: string) => {\r\n    const response = await apiClient.get<ApiResponse<JourneyVisualization>>(\r\n      `/attribution/journeys/${contactId}`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getTopConversionPaths: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    limit?: number;\r\n    minConversions?: number;\r\n  }) => {\r\n    const response = await apiClient.get<ApiResponse<ConversionPath[]>>(\r\n      '/attribution/journeys/top-paths',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getChannelTransitions: async (params: { startDate: string; endDate: string }) => {\r\n    const response = await apiClient.get<\r\n      ApiResponse<{\r\n        transitions: ChannelInteraction[];\r\n        sankeyData: { nodes: any[]; links: any[] };\r\n      }>\r\n    >('/attribution/journeys/transitions', { params });\r\n    return response.data.data;\r\n  },\r\n\r\n  getAssistedConversions: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    groupBy?: 'channel' | 'platform';\r\n  }) => {\r\n    const response = await apiClient.get<\r\n      ApiResponse<\r\n        Array<{\r\n          channel: string;\r\n          directConversions: number;\r\n          assistedConversions: number;\r\n          assistRatio: number;\r\n        }>\r\n      >\r\n    >('/attribution/journeys/assisted', { params });\r\n    return response.data.data;\r\n  },\r\n\r\n  getTimeLagReport: async (params: { startDate: string; endDate: string }) => {\r\n    const response = await apiClient.get<\r\n      ApiResponse<{\r\n        avgDaysToConvert: number;\r\n        medianDaysToConvert: number;\r\n        distribution: Array<{ days: string; conversions: number; revenue: number }>;\r\n      }>\r\n    >('/attribution/journeys/time-lag', { params });\r\n    return response.data.data;\r\n  },\r\n\r\n  // Data-Driven Attribution\r\n  trainMarkovModel: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    channelType?: string;\r\n    includeNonConverting?: boolean;\r\n    minJourneys?: number;\r\n  }) => {\r\n    const response = await apiClient.post<ApiResponse<TrainedAttributionModel>>(\r\n      '/attribution/data-driven/markov/train',\r\n      params\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  trainShapleyModel: async (params: {\r\n    startDate: string;\r\n    endDate: string;\r\n    channelType?: string;\r\n    maxChannels?: number;\r\n    sampleSize?: number;\r\n  }) => {\r\n    const response = await apiClient.post<ApiResponse<TrainedAttributionModel>>(\r\n      '/attribution/data-driven/shapley/train',\r\n      params\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getTrainedModels: async (params?: {\r\n    modelType?: DataDrivenModelType;\r\n    status?: ModelStatus;\r\n    isActive?: boolean;\r\n  }) => {\r\n    const response = await apiClient.get<ApiResponse<TrainedAttributionModel[]>>(\r\n      '/attribution/data-driven/models',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getTrainedModel: async (modelId: string) => {\r\n    const response = await apiClient.get<ApiResponse<TrainedAttributionModel>>(\r\n      `/attribution/data-driven/models/${modelId}`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  activateModel: async (modelId: string) => {\r\n    const response = await apiClient.post<ApiResponse<TrainedAttributionModel>>(\r\n      `/attribution/data-driven/models/${modelId}/activate`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  archiveModel: async (modelId: string) => {\r\n    const response = await apiClient.post<ApiResponse<TrainedAttributionModel>>(\r\n      `/attribution/data-driven/models/${modelId}/archive`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getTrainingRuns: async (params?: { modelType?: DataDrivenModelType; status?: ModelStatus }) => {\r\n    const response = await apiClient.get<ApiResponse<ModelTrainingRun[]>>(\r\n      '/attribution/data-driven/training-runs',\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getMarkovResults: async (modelId: string) => {\r\n    const response = await apiClient.get<ApiResponse<MarkovModelResult>>(\r\n      `/attribution/data-driven/markov/${modelId}/results`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getShapleyResults: async (modelId: string) => {\r\n    const response = await apiClient.get<ApiResponse<ShapleyModelResult>>(\r\n      `/attribution/data-driven/shapley/${modelId}/results`\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  getModelRecommendation: async (params: { startDate: string; endDate: string }) => {\r\n    const response = await apiClient.get<\r\n      ApiResponse<{\r\n        recommendedModel: string;\r\n        confidence: number;\r\n        reason: string;\r\n        comparison: ModelComparison;\r\n      }>\r\n    >('/attribution/data-driven/recommend', { params });\r\n    return response.data.data;\r\n  },\r\n\r\n  attributeWithDataDriven: async (dealId: string, modelId: string) => {\r\n    const response = await apiClient.get<ApiResponse<AttributionResult>>(\r\n      `/attribution/data-driven/attribute/${dealId}`,\r\n      {\r\n        params: { model_id: modelId },\r\n      }\r\n    );\r\n    return response.data.data;\r\n  },\r\n\r\n  compareWithRuleBased: async (modelId: string, params: { startDate: string; endDate: string }) => {\r\n    const response = await apiClient.get<ApiResponse<ModelComparison>>(\r\n      `/attribution/data-driven/models/${modelId}/compare`,\r\n      { params }\r\n    );\r\n    return response.data.data;\r\n  },\r\n};\r\n\r\n// =============================================================================\r\n// React Query Hooks\r\n// =============================================================================\r\n\r\n// Multi-Touch Attribution\r\nexport function useAttributeDeal(dealId: string, model: AttributionModel) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'deals', dealId, model],\r\n    queryFn: () => attributionApi.attributeDeal(dealId, model),\r\n    enabled: !!dealId,\r\n  });\r\n}\r\n\r\nexport function useBatchAttributeDeals() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: attributionApi.batchAttributeDeals,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['attribution'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useAttributionSummary(params: {\r\n  startDate: string;\r\n  endDate: string;\r\n  model: AttributionModel;\r\n  groupBy?: 'channel' | 'platform' | 'campaign';\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'summary', params],\r\n    queryFn: () => attributionApi.getAttributionSummary(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\nexport function useDailyAttributedRevenue(params: {\r\n  startDate: string;\r\n  endDate: string;\r\n  model: AttributionModel;\r\n  channel?: string;\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'daily', params],\r\n    queryFn: () => attributionApi.getDailyAttributedRevenue(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\nexport function useCompareModels(params: {\r\n  startDate: string;\r\n  endDate: string;\r\n  models: AttributionModel[];\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'compare', params],\r\n    queryFn: () => attributionApi.compareModels(params),\r\n    enabled: !!params.startDate && !!params.endDate && params.models.length > 0,\r\n  });\r\n}\r\n\r\n// Journey Analysis\r\nexport function useContactJourney(contactId: string) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'journeys', contactId],\r\n    queryFn: () => attributionApi.getContactJourney(contactId),\r\n    enabled: !!contactId,\r\n  });\r\n}\r\n\r\nexport function useTopConversionPaths(params: {\r\n  startDate: string;\r\n  endDate: string;\r\n  limit?: number;\r\n  minConversions?: number;\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'journeys', 'top-paths', params],\r\n    queryFn: () => attributionApi.getTopConversionPaths(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\nexport function useChannelTransitions(params: { startDate: string; endDate: string }) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'journeys', 'transitions', params],\r\n    queryFn: () => attributionApi.getChannelTransitions(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\nexport function useAssistedConversions(params: {\r\n  startDate: string;\r\n  endDate: string;\r\n  groupBy?: 'channel' | 'platform';\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'journeys', 'assisted', params],\r\n    queryFn: () => attributionApi.getAssistedConversions(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\nexport function useTimeLagReport(params: { startDate: string; endDate: string }) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'journeys', 'time-lag', params],\r\n    queryFn: () => attributionApi.getTimeLagReport(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\n// Data-Driven Attribution\r\nexport function useTrainMarkovModel() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: attributionApi.trainMarkovModel,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['attribution', 'data-driven'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useTrainShapleyModel() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: attributionApi.trainShapleyModel,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['attribution', 'data-driven'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useTrainedModels(params?: {\r\n  modelType?: DataDrivenModelType;\r\n  status?: ModelStatus;\r\n  isActive?: boolean;\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'models', params],\r\n    queryFn: () => attributionApi.getTrainedModels(params),\r\n  });\r\n}\r\n\r\nexport function useTrainedModel(modelId: string) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'models', modelId],\r\n    queryFn: () => attributionApi.getTrainedModel(modelId),\r\n    enabled: !!modelId,\r\n  });\r\n}\r\n\r\nexport function useActivateModel() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: attributionApi.activateModel,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['attribution', 'data-driven', 'models'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useArchiveModel() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: attributionApi.archiveModel,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['attribution', 'data-driven', 'models'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useTrainingRuns(params?: {\r\n  modelType?: DataDrivenModelType;\r\n  status?: ModelStatus;\r\n}) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'training-runs', params],\r\n    queryFn: () => attributionApi.getTrainingRuns(params),\r\n  });\r\n}\r\n\r\nexport function useMarkovResults(modelId: string) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'markov', modelId, 'results'],\r\n    queryFn: () => attributionApi.getMarkovResults(modelId),\r\n    enabled: !!modelId,\r\n  });\r\n}\r\n\r\nexport function useShapleyResults(modelId: string) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'shapley', modelId, 'results'],\r\n    queryFn: () => attributionApi.getShapleyResults(modelId),\r\n    enabled: !!modelId,\r\n  });\r\n}\r\n\r\nexport function useModelRecommendation(params: { startDate: string; endDate: string }) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'recommend', params],\r\n    queryFn: () => attributionApi.getModelRecommendation(params),\r\n    enabled: !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n\r\nexport function useAttributeWithDataDriven(dealId: string, modelId: string) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'attribute', dealId, modelId],\r\n    queryFn: () => attributionApi.attributeWithDataDriven(dealId, modelId),\r\n    enabled: !!dealId && !!modelId,\r\n  });\r\n}\r\n\r\nexport function useCompareWithRuleBased(\r\n  modelId: string,\r\n  params: { startDate: string; endDate: string }\r\n) {\r\n  return useQuery({\r\n    queryKey: ['attribution', 'data-driven', 'models', modelId, 'compare', params],\r\n    queryFn: () => attributionApi.compareWithRuleBased(modelId, params),\r\n    enabled: !!modelId && !!params.startDate && !!params.endDate,\r\n  });\r\n}\r\n","/**\r\n * Stratum AI - Attribution Page\r\n *\r\n * Multi-touch attribution analysis with data-driven models (Markov, Shapley).\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport {\r\n  useAttributionSummary,\r\n  useCompareModels,\r\n  useTopConversionPaths,\r\n  useTrainedModels,\r\n  useTrainMarkovModel,\r\n  useTrainShapleyModel,\r\n} from '@/api/hooks';\r\nimport {\r\n  ArrowPathIcon,\r\n  ArrowsRightLeftIcon,\r\n  BeakerIcon,\r\n  ChartPieIcon,\r\n  LightBulbIcon,\r\n  SparklesIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport { cn } from '@/lib/utils';\r\nimport type {\r\n  AttributionSummary as ApiAttributionSummary,\r\n  ConversionPath as ApiConversionPath,\r\n  TrainedAttributionModel as ApiTrainedModel,\r\n  AttributionModel,\r\n} from '@/api/attribution';\r\n\r\ntype TabType = 'overview' | 'models' | 'paths' | 'compare';\r\n\r\n// Extended local types for UI display\r\ninterface DisplaySummary {\r\n  totalConversions: number;\r\n  totalRevenue: number;\r\n  channelBreakdown: ApiAttributionSummary[];\r\n}\r\n\r\ninterface DisplayPath extends Omit<ApiConversionPath, 'path'> {\r\n  path: string[]; // Convert string path to array for display\r\n  totalRevenue: number;\r\n  avgTimeToConversion: number;\r\n}\r\n\r\ninterface DisplayTrainedModel extends Partial<ApiTrainedModel> {\r\n  name?: string;\r\n  trainedAt?: string;\r\n  accuracy?: number;\r\n}\r\n\r\nconst modelLabels: Record<AttributionModel, string> = {\r\n  first_touch: 'First Touch',\r\n  last_touch: 'Last Touch',\r\n  linear: 'Linear',\r\n  time_decay: 'Time Decay',\r\n  position_based: 'Position Based',\r\n  w_shaped: 'W-Shaped',\r\n  markov: 'Markov Chain',\r\n  shapley: 'Shapley Value',\r\n};\r\n\r\nexport default function Attribution() {\r\n  useParams<{ tenantId: string }>();\r\n  const [activeTab, setActiveTab] = useState<TabType>('overview');\r\n  const [selectedModel, setSelectedModel] = useState<AttributionModel>('linear');\r\n  const [dateRange] = useState({\r\n    startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n    endDate: new Date().toISOString().split('T')[0],\r\n  });\r\n\r\n  const { data: summaryData } = useAttributionSummary({\r\n    ...dateRange,\r\n    model: selectedModel,\r\n  });\r\n  const { data: topPathsData } = useTopConversionPaths({ ...dateRange, limit: 10 });\r\n  const { data: comparisonData } = useCompareModels({\r\n    ...dateRange,\r\n    models: ['first_touch', 'last_touch', 'linear', 'markov', 'shapley'] as AttributionModel[],\r\n  });\r\n  const { data: trainedModelsData } = useTrainedModels();\r\n  const trainMarkov = useTrainMarkovModel();\r\n  const trainShapley = useTrainShapleyModel();\r\n\r\n  // Transform API data to display format\r\n  const summary: DisplaySummary | null = summaryData\r\n    ? {\r\n        totalConversions: summaryData.reduce((sum, s) => sum + s.conversions, 0),\r\n        totalRevenue: summaryData.reduce((sum, s) => sum + s.attributedRevenue, 0),\r\n        channelBreakdown: summaryData,\r\n      }\r\n    : null;\r\n\r\n  const topPaths: DisplayPath[] = (topPathsData ?? []).map((p) => ({\r\n    ...p,\r\n    path: p.path.split(' > '), // Split path string into array\r\n    totalRevenue: p.revenue,\r\n    avgTimeToConversion: p.avgDaysToConvert,\r\n  }));\r\n\r\n  // Use the proper AttributionComparison type from API\r\n  const comparison = comparisonData;\r\n\r\n  const trainedModels: DisplayTrainedModel[] = (trainedModelsData ?? []).map(\r\n    (m) =>\r\n      ({\r\n        ...m,\r\n        name: m.modelName,\r\n        trainedAt: m.createdAt,\r\n        accuracy: m.validationAccuracy,\r\n      }) as DisplayTrainedModel\r\n  );\r\n\r\n  const tabs = [\r\n    { id: 'overview' as TabType, label: 'Overview' },\r\n    { id: 'models' as TabType, label: 'AI Models' },\r\n    { id: 'paths' as TabType, label: 'Conversion Paths' },\r\n    { id: 'compare' as TabType, label: 'Model Comparison' },\r\n  ];\r\n\r\n  const models: AttributionModel[] = [\r\n    'first_touch',\r\n    'last_touch',\r\n    'linear',\r\n    'time_decay',\r\n    'position_based',\r\n    'markov',\r\n    'shapley',\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold\">Multi-Touch Attribution</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Understand the true impact of each channel on conversions\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <select\r\n            value={selectedModel}\r\n            onChange={(e) => setSelectedModel(e.target.value as AttributionModel)}\r\n            className=\"px-3 py-2 rounded-lg border bg-background\"\r\n          >\r\n            {models.map((model) => (\r\n              <option key={model} value={model}>\r\n                {modelLabels[model]}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"border-b\">\r\n        <nav className=\"flex gap-4\">\r\n          {tabs.map((tab) => (\r\n            <button\r\n              key={tab.id}\r\n              onClick={() => setActiveTab(tab.id)}\r\n              className={cn(\r\n                'px-4 py-2 border-b-2 font-medium text-sm transition-colors',\r\n                activeTab === tab.id\r\n                  ? 'border-primary text-primary'\r\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\r\n              )}\r\n            >\r\n              {tab.label}\r\n            </button>\r\n          ))}\r\n        </nav>\r\n      </div>\r\n\r\n      {/* Overview Tab */}\r\n      {activeTab === 'overview' && (\r\n        <div className=\"space-y-6\">\r\n          {/* Summary Stats */}\r\n          {summary && (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n              <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n                <p className=\"text-sm text-muted-foreground\">Total Conversions</p>\r\n                <p className=\"text-2xl font-bold\">{summary.totalConversions.toLocaleString()}</p>\r\n              </div>\r\n              <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n                <p className=\"text-sm text-muted-foreground\">Total Revenue</p>\r\n                <p className=\"text-2xl font-bold\">${summary.totalRevenue.toLocaleString()}</p>\r\n              </div>\r\n              <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n                <p className=\"text-sm text-muted-foreground\">Unique Channels</p>\r\n                <p className=\"text-2xl font-bold\">{summary.channelBreakdown.length}</p>\r\n              </div>\r\n              <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n                <p className=\"text-sm text-muted-foreground\">Model</p>\r\n                <p className=\"text-xl font-bold\">{modelLabels[selectedModel]}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Channel Attribution */}\r\n          {summary && (\r\n            <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n              <h2 className=\"text-lg font-semibold mb-4\">Channel Attribution</h2>\r\n              <div className=\"space-y-4\">\r\n                {summary.channelBreakdown.map((channel) => (\r\n                  <div key={channel.channel}>\r\n                    <div className=\"flex justify-between text-sm mb-1\">\r\n                      <span className=\"font-medium\">{channel.channel}</span>\r\n                      <div className=\"flex gap-4\">\r\n                        <span className=\"text-muted-foreground\">\r\n                          {channel.conversions.toLocaleString()} conversions\r\n                        </span>\r\n                        <span className=\"font-medium\">\r\n                          ${channel.attributedRevenue.toLocaleString()}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"w-full bg-muted rounded-full h-2\">\r\n                      <div\r\n                        className=\"h-2 rounded-full bg-primary\"\r\n                        style={{ width: `${channel.avgWeight * 100}%` }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Model Info */}\r\n          <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <LightBulbIcon className=\"h-5 w-5 text-amber-500 mt-0.5\" />\r\n              <div>\r\n                <h3 className=\"font-medium\">About {modelLabels[selectedModel]}</h3>\r\n                <p className=\"text-sm text-muted-foreground mt-1\">\r\n                  {selectedModel === 'first_touch' &&\r\n                    'Gives 100% credit to the first touchpoint in the customer journey.'}\r\n                  {selectedModel === 'last_touch' &&\r\n                    'Gives 100% credit to the last touchpoint before conversion.'}\r\n                  {selectedModel === 'linear' &&\r\n                    'Distributes credit equally across all touchpoints in the journey.'}\r\n                  {selectedModel === 'time_decay' &&\r\n                    'Gives more credit to touchpoints closer to the conversion time.'}\r\n                  {selectedModel === 'position_based' &&\r\n                    'Gives 40% to first, 40% to last, and 20% distributed among middle touchpoints.'}\r\n                  {selectedModel === 'markov' &&\r\n                    \"Uses transition probabilities to determine each channel's contribution to conversions.\"}\r\n                  {selectedModel === 'shapley' &&\r\n                    \"Uses game theory to fairly distribute credit based on each channel's marginal contribution.\"}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* AI Models Tab */}\r\n      {activeTab === 'models' && (\r\n        <div className=\"space-y-6\">\r\n          {/* Train New Models */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n              <div className=\"flex items-center gap-3 mb-4\">\r\n                <div className=\"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/20\">\r\n                  <BeakerIcon className=\"h-5 w-5 text-purple-600\" />\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-medium\">Markov Chain Model</h3>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    Probabilistic model based on channel transitions\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => trainMarkov.mutate(dateRange)}\r\n                disabled={trainMarkov.isPending}\r\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50\"\r\n              >\r\n                {trainMarkov.isPending ? (\r\n                  <ArrowPathIcon className=\"h-4 w-4 animate-spin\" />\r\n                ) : (\r\n                  <SparklesIcon className=\"h-4 w-4\" />\r\n                )}\r\n                Train Markov Model\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"rounded-xl border bg-card p-6 shadow-card\">\r\n              <div className=\"flex items-center gap-3 mb-4\">\r\n                <div className=\"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/20\">\r\n                  <ChartPieIcon className=\"h-5 w-5 text-blue-600\" />\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-medium\">Shapley Value Model</h3>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    Game theory-based fair attribution\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => trainShapley.mutate(dateRange)}\r\n                disabled={trainShapley.isPending}\r\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50\"\r\n              >\r\n                {trainShapley.isPending ? (\r\n                  <ArrowPathIcon className=\"h-4 w-4 animate-spin\" />\r\n                ) : (\r\n                  <SparklesIcon className=\"h-4 w-4\" />\r\n                )}\r\n                Train Shapley Model\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Trained Models */}\r\n          <div className=\"rounded-xl border bg-card shadow-card overflow-hidden\">\r\n            <div className=\"p-4 border-b\">\r\n              <h3 className=\"font-medium\">Trained Models</h3>\r\n            </div>\r\n            <table className=\"w-full\">\r\n              <thead className=\"bg-muted/50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-sm font-medium\">Model</th>\r\n                  <th className=\"px-4 py-3 text-left text-sm font-medium\">Type</th>\r\n                  <th className=\"px-4 py-3 text-left text-sm font-medium\">Trained</th>\r\n                  <th className=\"px-4 py-3 text-right text-sm font-medium\">Accuracy</th>\r\n                  <th className=\"px-4 py-3 text-center text-sm font-medium\">Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y\">\r\n                {trainedModels?.map((model) => (\r\n                  <tr key={model.id} className=\"hover:bg-muted/30\">\r\n                    <td className=\"px-4 py-3 font-medium\">{model.name}</td>\r\n                    <td className=\"px-4 py-3 text-sm capitalize\">\r\n                      {model.modelType?.replace('_', ' ') ?? '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm\">\r\n                      {model.trainedAt ? new Date(model.trainedAt).toLocaleDateString() : '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-right font-medium\">\r\n                      {model.accuracy ? `${(model.accuracy * 100).toFixed(1)}%` : '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-center\">\r\n                      <span\r\n                        className={cn(\r\n                          'px-2 py-1 rounded-full text-xs',\r\n                          model.status === 'active' &&\r\n                            'bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300',\r\n                          model.status === 'training' &&\r\n                            'bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300',\r\n                          model.status === 'failed' &&\r\n                            'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300'\r\n                        )}\r\n                      >\r\n                        {model.status}\r\n                      </span>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Conversion Paths Tab */}\r\n      {activeTab === 'paths' && (\r\n        <div className=\"rounded-xl border bg-card shadow-card overflow-hidden\">\r\n          <div className=\"p-4 border-b\">\r\n            <h3 className=\"font-medium\">Top Conversion Paths</h3>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Most common channel sequences leading to conversions\r\n            </p>\r\n          </div>\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-muted/50\">\r\n              <tr>\r\n                <th className=\"px-4 py-3 text-left text-sm font-medium\">Path</th>\r\n                <th className=\"px-4 py-3 text-right text-sm font-medium\">Conversions</th>\r\n                <th className=\"px-4 py-3 text-right text-sm font-medium\">Revenue</th>\r\n                <th className=\"px-4 py-3 text-right text-sm font-medium\">Avg. Time</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y\">\r\n              {topPaths?.map((path, idx) => (\r\n                <tr key={idx} className=\"hover:bg-muted/30\">\r\n                  <td className=\"px-4 py-3\">\r\n                    <div className=\"flex items-center gap-2 flex-wrap\">\r\n                      {path.path.map((channel, i) => (\r\n                        <span key={i} className=\"flex items-center gap-1\">\r\n                          <span className=\"px-2 py-1 rounded bg-muted text-xs font-medium\">\r\n                            {channel}\r\n                          </span>\r\n                          {i < path.path.length - 1 && (\r\n                            <ArrowsRightLeftIcon className=\"h-3 w-3 text-muted-foreground\" />\r\n                          )}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-right font-medium\">\r\n                    {path.conversions.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-right font-medium\">\r\n                    ${path.totalRevenue.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-right text-sm text-muted-foreground\">\r\n                    {path.avgTimeToConversion.toFixed(1)} days\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      {/* Model Comparison Tab */}\r\n      {activeTab === 'compare' && comparison && (\r\n        <div className=\"rounded-xl border bg-card shadow-card overflow-hidden\">\r\n          <div className=\"p-4 border-b\">\r\n            <h3 className=\"font-medium\">Attribution Model Comparison</h3>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              See how different models attribute revenue to each channel\r\n            </p>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full\">\r\n              <thead className=\"bg-muted/50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-sm font-medium\">Channel</th>\r\n                  {comparison.models.map((model) => (\r\n                    <th key={model} className=\"px-4 py-3 text-right text-sm font-medium\">\r\n                      {modelLabels[model] || model}\r\n                    </th>\r\n                  ))}\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y\">\r\n                {comparison.channels.map((channel) => (\r\n                  <tr key={channel.channel} className=\"hover:bg-muted/30\">\r\n                    <td className=\"px-4 py-3 font-medium\">{channel.channel}</td>\r\n                    {comparison.models.map((model) => (\r\n                      <td key={model} className=\"px-4 py-3 text-right\">\r\n                        ${channel.byModel[model]?.revenue?.toLocaleString() || '0'}\r\n                      </td>\r\n                    ))}\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["attributionApi","dealId","model","apiClient","params","contactId","modelId","useAttributionSummary","useQuery","useCompareModels","useTopConversionPaths","useTrainMarkovModel","queryClient","useQueryClient","useMutation","useTrainShapleyModel","useTrainedModels","modelLabels","Attribution","useParams","activeTab","setActiveTab","useState","selectedModel","setSelectedModel","dateRange","summaryData","topPathsData","comparisonData","trainedModelsData","trainMarkov","trainShapley","summary","sum","s","topPaths","p","comparison","trainedModels","m","tabs","models","jsxs","jsx","e","tab","cn","channel","LightBulbIcon","BeakerIcon","ArrowPathIcon","SparklesIcon","ChartPieIcon","_a","path","idx","i","ArrowsRightLeftIcon","_b"],"mappings":"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"}