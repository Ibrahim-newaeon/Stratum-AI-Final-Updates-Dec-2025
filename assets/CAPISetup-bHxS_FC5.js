import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as l}from"./vendor-react-Dz7uKsMg.js";import{i as V,Q as z,t as u,P as $,c as f,C as b,X as j,E as q,S as H,Z as Q,G as K,s as F,a0 as Z}from"./index-BQex3859.js";import{L as B}from"./loader-circle-CJwg01sb.js";import{C as R}from"./circle-alert-MlATZigW.js";import{R as X}from"./refresh-cw-DLOeozaH.js";import{C as J}from"./circle-question-mark-DBPHcbWv.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z",key:"1xoxul"}],["path",{d:"M9 8V2",key:"14iosj"}]],ee=V("plug",Y),d=[{id:"meta",name:"Meta (Facebook)",logo:"/platforms/meta.svg",color:"bg-blue-500",description:"Facebook & Instagram Conversion API",credentials:[{field:"pixel_id",label:"Pixel ID",placeholder:"123456789012345",help:"Found in Events Manager > Data Sources > Your Pixel"},{field:"access_token",label:"CAPI Access Token",placeholder:"EAABsbCS...",help:"System User Token for Conversions API. Go to Business Settings > System Users > Generate Token with ads_management and ads_read permissions",sensitive:!0}]},{id:"google",name:"Google Ads",logo:"/platforms/google.svg",color:"bg-red-500",description:"Enhanced Conversions for Web",credentials:[{field:"customer_id",label:"Customer ID",placeholder:"123-456-7890",help:"Google Ads Customer ID"},{field:"conversion_action_id",label:"Conversion Action ID",placeholder:"123456789",help:"From Tools > Conversions"},{field:"api_key",label:"API Key",placeholder:"AIza...",help:"OAuth token or Developer token",sensitive:!0}]},{id:"tiktok",name:"TikTok",logo:"/platforms/tiktok.svg",color:"bg-black",description:"TikTok Events API",credentials:[{field:"pixel_code",label:"Pixel Code",placeholder:"CXXXXXXXXXX",help:"Found in TikTok Ads Manager > Events > Manage > Web Events"},{field:"access_token",label:"Events API Access Token",placeholder:"",help:"Long-lived access token from TikTok Events Manager for server-side event tracking",sensitive:!0}]},{id:"snapchat",name:"Snapchat",logo:"/platforms/snapchat.svg",color:"bg-yellow-400",description:"Snapchat Conversion API",credentials:[{field:"pixel_id",label:"Pixel ID",placeholder:"",help:"Found in Snap Pixel setup in Ads Manager"},{field:"access_token",label:"CAPI Access Token",placeholder:"",help:"Conversions API token from Snapchat Business Manager > Snap Pixel > Conversions API",sensitive:!0}]},{id:"whatsapp",name:"WhatsApp Business",logo:"/platforms/whatsapp.svg",color:"bg-green-500",description:"WhatsApp Business Cloud API",credentials:[{field:"phone_number_id",label:"Phone Number ID",placeholder:"1234567890123456",help:"From Meta Business Suite > WhatsApp Manager > Phone Numbers"},{field:"business_account_id",label:"Business Account ID",placeholder:"1234567890123456",help:"WhatsApp Business Account ID (WABA ID) from Meta Business Suite"},{field:"access_token",label:"WhatsApp Cloud API Token",placeholder:"EAABsbCS...",help:"Permanent System User token with whatsapp_business_messaging permission from Business Settings",sensitive:!0},{field:"webhook_verify_token",label:"Webhook Verify Token",placeholder:"your_verify_token",help:"Custom string you create for webhook verification (must match webhook config)"}]}];function pe(){const{t:se}=z(),[x,v]=l.useState(null),[h,N]=l.useState({}),[y,k]=l.useState(!1),[C,g]=l.useState({}),[w,m]=l.useState(null),[A,p]=l.useState(null),[S,L]=l.useState(null),[W,P]=l.useState(!0),[I,T]=l.useState(!1),[_,D]=l.useState([]);l.useEffect(()=>{E()},[]);const E=async()=>{var s;P(!0);try{const n=(await u.get("/capi/platforms/status")).data;if(n.success){const t={},r=((s=n.data)==null?void 0:s.connected_platforms)||{};Object.keys(r).forEach(i=>{t[i]={connected:!0,...r[i]}}),g(t)}}catch(a){console.error("Failed to fetch statuses:",a)}finally{P(!1)}},O=async()=>{var s,a,n,t;if(x){k(!0),m(null),p(null);try{const i=(await u.post("/capi/platforms/connect",{platform:x,credentials:h})).data;i.success?(p(`Successfully connected to ${(s=d.find(o=>o.id===x))==null?void 0:s.name}!`),g(o=>({...o,[x]:{connected:!0}})),N({}),v(null)):m(((a=i.data)==null?void 0:a.message)||"Connection failed")}catch(r){m(((t=(n=r.response)==null?void 0:n.data)==null?void 0:t.detail)||"Failed to connect. Please check your credentials.")}finally{k(!1)}}},G=async s=>{var a,n,t;try{(await u.delete(`/capi/platforms/${s}/disconnect`)).data.success&&(g(o=>{const M={...o};return delete M[s],M}),p(`Disconnected from ${(a=d.find(o=>o.id===s))==null?void 0:a.name}`))}catch(r){console.error("Failed to disconnect:",r),m(((t=(n=r.response)==null?void 0:n.data)==null?void 0:t.detail)||"Failed to disconnect")}},U=async()=>{var s,a;T(!0),D([]);try{const t=(await u.post("/capi/platforms/test")).data;if(t.success&&t.data){const r=Object.entries(t.data).map(([i,o])=>({platform:i,status:o.status==="connected"?"success":"error",message:o.message||(o.status==="connected"?"Connection OK":"Connection failed")}));D(r)}}catch(n){m(((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.detail)||"Failed to test connections")}finally{T(!1)}},c=Object.keys(C).length;return W?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"w-8 h-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading platform connections..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Conversion API Setup"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Connect ad platforms to stream first-party conversion data (purchases, leads, sign-ups) and boost ROAS by 30-50%"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),e.jsxs("span",{children:["This is for ",e.jsx("strong",{children:"server-side event tracking only"}),". To manage ad accounts & campaigns, use"," ",e.jsx("a",{href:"/dashboard/tenants",className:"text-primary hover:underline",children:"Tenant Settings â†’ Connect Platforms"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c>0&&e.jsxs("button",{onClick:U,disabled:I,className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg transition-colors disabled:opacity-50",children:[I?e.jsx(B,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"}),"Test Connections"]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:[e.jsx(X,{className:"w-4 h-4"}),"Refresh"]})]})]}),_.length>0&&e.jsxs("div",{className:"rounded-xl border bg-card p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Connection Test Results"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:_.map(s=>e.jsxs("div",{className:f("flex items-center gap-3 p-3 rounded-lg border",s.status==="success"?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"),children:[s.status==="success"?e.jsx(b,{className:"w-5 h-5 text-green-500"}):e.jsx(j,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium capitalize",children:s.platform}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.message})]})]},s.platform))})]}),e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-purple-500/10 to-pink-500/10 rounded-xl p-6 border",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"70-90% Match Rates"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Up from 42% with client-side tracking"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Privacy-Compliant"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Auto SHA256 hashing of PII data"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"No Code Required"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Just paste your API tokens"})]})]})]})}),A&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{children:A}),e.jsx("button",{onClick:()=>p(null),className:"ml-auto",children:e.jsx(j,{className:"w-4 h-4"})})]}),w&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-500/10 border border-red-500/20 rounded-lg text-red-600",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:w}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto",children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>{const a=C[s.id],n=x===s.id;return e.jsxs("div",{className:f("relative rounded-xl border p-5 transition-all cursor-pointer",a!=null&&a.connected?"border-green-500/50 bg-green-500/5":n?"border-primary bg-primary/5":"border-border hover:border-primary/50 hover:bg-muted/50"),onClick:()=>!(a!=null&&a.connected)&&v(n?null:s.id),children:[(a==null?void 0:a.connected)&&e.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1 px-2 py-1 bg-green-500/10 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-green-600",children:"Connected"})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:f("w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg",s.color),children:s.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),n&&!(a!=null&&a.connected)&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-3",onClick:t=>t.stopPropagation(),children:[s.credentials.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:t.label}),e.jsx("button",{onClick:()=>L(S===t.field?null:t.field),className:"text-muted-foreground hover:text-foreground",children:e.jsx(J,{className:"w-4 h-4"})})]}),S===t.field&&e.jsx("p",{className:"text-xs text-muted-foreground mb-2 bg-muted/50 p-2 rounded",children:t.help}),e.jsx("input",{type:t.sensitive?"password":"text",placeholder:t.placeholder,value:h[t.field]||"",onChange:r=>N(i=>({...i,[t.field]:r.target.value})),className:"w-full px-3 py-2 border rounded-lg bg-background text-foreground text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary"})]},t.field)),e.jsx("button",{onClick:O,disabled:y||s.credentials.some(t=>!h[t.field]),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:y?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4"}),"Connect Platform"]})})]}),(a==null?void 0:a.connected)&&e.jsxs("div",{className:"mt-4 pt-4 border-t flex items-center justify-between",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Events today:"}),e.jsx("span",{className:"ml-2 font-semibold text-foreground",children:a.eventsToday||0})]}),e.jsx("button",{onClick:()=>G(s.id),className:"text-sm text-red-500 hover:text-red-600 hover:underline",children:"Disconnect"})]})]},s.id)})}),e.jsxs("div",{className:"rounded-xl border bg-card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Setup Progress"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-green-500 transition-all duration-500",style:{width:`${c/d.length*100}%`}})})}),e.jsxs("div",{className:"text-sm font-medium",children:[e.jsx("span",{className:"text-primary",children:c}),e.jsxs("span",{className:"text-muted-foreground",children:[" / ",d.length," platforms"]})]})]}),c===0&&e.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Connect at least one platform to start streaming conversion data"}),c>0&&c<d.length&&e.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Connect more platforms to maximize your cross-channel attribution"}),c===d.length&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-green-600",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"All platforms connected!"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("a",{href:"/data-quality",className:"flex items-center justify-between p-4 rounded-xl border bg-card hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground",children:"Data Quality Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View match quality scores and fix data gaps"})]})]}),e.jsx(F,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("a",{href:"https://developers.facebook.com/docs/marketing-api/conversions-api",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-4 rounded-xl border bg-card hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground",children:"Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Learn more about Conversion APIs"})]})]}),e.jsx(F,{className:"w-5 h-5 text-muted-foreground"})]})]})]})}export{pe as CAPISetup,pe as default};
//# sourceMappingURL=CAPISetup-bHxS_FC5.js.map
