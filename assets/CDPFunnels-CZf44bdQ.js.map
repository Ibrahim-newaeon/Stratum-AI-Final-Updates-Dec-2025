{"version":3,"file":"CDPFunnels-CZf44bdQ.js","sources":["../../src/components/cdp/FunnelBuilder.tsx","../../src/views/cdp/CDPFunnels.tsx"],"sourcesContent":["/**\r\n * CDP Funnel Builder & Analysis Component\r\n * Create and analyze conversion funnels with step-by-step metrics\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport {\r\n  ArrowDown,\r\n  BarChart3,\r\n  Calendar,\r\n  ChevronDown,\r\n  ChevronRight,\r\n  Clock,\r\n  Filter,\r\n  GitBranch,\r\n  Loader2,\r\n  Plus,\r\n  RefreshCw,\r\n  Save,\r\n  Search,\r\n  Target,\r\n  Trash2,\r\n  TrendingDown,\r\n  Users,\r\n  Zap,\r\n} from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n  CDPFunnel,\r\n  FunnelCreate,\r\n  FunnelStep,\r\n  useAnalyzeFunnel,\r\n  useComputeFunnel,\r\n  useCreateFunnel,\r\n  useDeleteFunnel,\r\n  useFunnelDropOffs,\r\n  useFunnels,\r\n  useUpdateFunnel,\r\n} from '@/api/cdp';\r\n\r\n// Step condition operators\r\nconst CONDITION_OPERATORS = [\r\n  { value: 'equals', label: 'equals' },\r\n  { value: 'not_equals', label: 'not equals' },\r\n  { value: 'contains', label: 'contains' },\r\n  { value: 'greater_than', label: 'greater than' },\r\n  { value: 'less_than', label: 'less than' },\r\n];\r\n\r\n// Common event names for suggestions\r\nconst COMMON_EVENTS = [\r\n  'PageView',\r\n  'AddToCart',\r\n  'ViewProduct',\r\n  'StartCheckout',\r\n  'Purchase',\r\n  'SignUp',\r\n  'Login',\r\n  'Search',\r\n  'FormSubmit',\r\n];\r\n\r\ninterface StepBuilderProps {\r\n  step: FunnelStep;\r\n  index: number;\r\n  onChange: (step: FunnelStep) => void;\r\n  onRemove: () => void;\r\n  canRemove: boolean;\r\n}\r\n\r\nfunction StepBuilder({ step, index, onChange, onRemove, canRemove }: StepBuilderProps) {\r\n  const [showConditions, setShowConditions] = useState(false);\r\n\r\n  const addCondition = () => {\r\n    onChange({\r\n      ...step,\r\n      conditions: [...(step.conditions || []), { field: '', operator: 'equals', value: '' }],\r\n    });\r\n  };\r\n\r\n  const updateCondition = (condIndex: number, field: string, value: unknown) => {\r\n    const newConditions = [...(step.conditions || [])];\r\n    newConditions[condIndex] = { ...newConditions[condIndex], [field]: value };\r\n    onChange({ ...step, conditions: newConditions });\r\n  };\r\n\r\n  const removeCondition = (condIndex: number) => {\r\n    onChange({\r\n      ...step,\r\n      conditions: (step.conditions || []).filter((_, i) => i !== condIndex),\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative pl-8\">\r\n      {/* Step connector */}\r\n      {index > 0 && <div className=\"absolute left-3 -top-6 w-0.5 h-6 bg-border\" />}\r\n      <div className=\"absolute left-0 top-4 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\r\n        {index + 1}\r\n      </div>\r\n\r\n      <div className=\"p-4 rounded-lg border bg-card\">\r\n        <div className=\"flex items-center gap-3 mb-3\">\r\n          <div className=\"flex-1\">\r\n            <label className=\"block text-xs font-medium text-muted-foreground mb-1\">\r\n              Step Name\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={step.step_name}\r\n              onChange={(e) => onChange({ ...step, step_name: e.target.value })}\r\n              placeholder=\"e.g., View Product\"\r\n              className=\"w-full px-3 py-1.5 rounded-md border bg-background text-sm\"\r\n            />\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <label className=\"block text-xs font-medium text-muted-foreground mb-1\">\r\n              Event Name\r\n            </label>\r\n            <div className=\"relative\">\r\n              <input\r\n                type=\"text\"\r\n                value={step.event_name}\r\n                onChange={(e) => onChange({ ...step, event_name: e.target.value })}\r\n                placeholder=\"e.g., ViewProduct\"\r\n                list={`events-${index}`}\r\n                className=\"w-full px-3 py-1.5 rounded-md border bg-background text-sm\"\r\n              />\r\n              <datalist id={`events-${index}`}>\r\n                {COMMON_EVENTS.map((event) => (\r\n                  <option key={event} value={event} />\r\n                ))}\r\n              </datalist>\r\n            </div>\r\n          </div>\r\n          {canRemove && (\r\n            <button\r\n              onClick={onRemove}\r\n              className=\"mt-4 p-1.5 rounded-md hover:bg-red-500/10 text-muted-foreground hover:text-red-500 transition-colors\"\r\n            >\r\n              <Trash2 className=\"w-4 h-4\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Conditions toggle */}\r\n        <button\r\n          onClick={() => setShowConditions(!showConditions)}\r\n          className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors\"\r\n        >\r\n          {showConditions ? (\r\n            <ChevronDown className=\"w-4 h-4\" />\r\n          ) : (\r\n            <ChevronRight className=\"w-4 h-4\" />\r\n          )}\r\n          <Filter className=\"w-3.5 h-3.5\" />\r\n          {step.conditions?.length || 0} Conditions\r\n        </button>\r\n\r\n        {/* Conditions */}\r\n        {showConditions && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            {(step.conditions || []).map((condition, condIndex) => (\r\n              <div key={condIndex} className=\"flex items-center gap-2 p-2 bg-muted/30 rounded-md\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={condition.field}\r\n                  onChange={(e) => updateCondition(condIndex, 'field', e.target.value)}\r\n                  placeholder=\"property\"\r\n                  className=\"flex-1 px-2 py-1 rounded border bg-background text-xs\"\r\n                />\r\n                <select\r\n                  value={condition.operator}\r\n                  onChange={(e) => updateCondition(condIndex, 'operator', e.target.value)}\r\n                  className=\"px-2 py-1 rounded border bg-background text-xs\"\r\n                >\r\n                  {CONDITION_OPERATORS.map((op) => (\r\n                    <option key={op.value} value={op.value}>\r\n                      {op.label}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <input\r\n                  type=\"text\"\r\n                  value={condition.value as string}\r\n                  onChange={(e) => updateCondition(condIndex, 'value', e.target.value)}\r\n                  placeholder=\"value\"\r\n                  className=\"flex-1 px-2 py-1 rounded border bg-background text-xs\"\r\n                />\r\n                <button\r\n                  onClick={() => removeCondition(condIndex)}\r\n                  className=\"p-1 rounded hover:bg-red-500/10 text-muted-foreground hover:text-red-500\"\r\n                >\r\n                  <Trash2 className=\"w-3 h-3\" />\r\n                </button>\r\n              </div>\r\n            ))}\r\n            <button\r\n              onClick={addCondition}\r\n              className=\"flex items-center gap-1 text-xs text-primary hover:text-primary/80\"\r\n            >\r\n              <Plus className=\"w-3 h-3\" />\r\n              Add Condition\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface FunnelFormProps {\r\n  funnel?: CDPFunnel;\r\n  onSave: () => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nfunction FunnelForm({ funnel, onSave, onCancel }: FunnelFormProps) {\r\n  const [name, setName] = useState(funnel?.name || '');\r\n  const [description, setDescription] = useState(funnel?.description || '');\r\n  const [steps, setSteps] = useState<FunnelStep[]>(\r\n    funnel?.steps || [\r\n      { step_name: '', event_name: '' },\r\n      { step_name: '', event_name: '' },\r\n    ]\r\n  );\r\n  const [conversionWindowDays, setConversionWindowDays] = useState(\r\n    funnel?.conversion_window_days || 30\r\n  );\r\n  const [stepTimeoutHours, _setStepTimeoutHours] = useState<number | undefined>(\r\n    funnel?.step_timeout_hours\r\n  );\r\n  const [autoRefresh, setAutoRefresh] = useState(funnel?.auto_refresh ?? true);\r\n  const [refreshIntervalHours, setRefreshIntervalHours] = useState(\r\n    funnel?.refresh_interval_hours || 24\r\n  );\r\n\r\n  const createMutation = useCreateFunnel();\r\n  const updateMutation = useUpdateFunnel();\r\n\r\n  const addStep = () => {\r\n    if (steps.length < 20) {\r\n      setSteps([...steps, { step_name: '', event_name: '' }]);\r\n    }\r\n  };\r\n\r\n  const updateStep = (index: number, step: FunnelStep) => {\r\n    const newSteps = [...steps];\r\n    newSteps[index] = step;\r\n    setSteps(newSteps);\r\n  };\r\n\r\n  const removeStep = (index: number) => {\r\n    if (steps.length > 2) {\r\n      setSteps(steps.filter((_, i) => i !== index));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    const data: FunnelCreate = {\r\n      name,\r\n      description,\r\n      steps,\r\n      conversion_window_days: conversionWindowDays,\r\n      step_timeout_hours: stepTimeoutHours,\r\n      auto_refresh: autoRefresh,\r\n      refresh_interval_hours: refreshIntervalHours,\r\n    };\r\n\r\n    try {\r\n      if (funnel) {\r\n        await updateMutation.mutateAsync({ funnelId: funnel.id, update: data });\r\n      } else {\r\n        await createMutation.mutateAsync(data);\r\n      }\r\n      onSave();\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n    }\r\n  };\r\n\r\n  const isLoading = createMutation.isPending || updateMutation.isPending;\r\n  const isValid = name && steps.length >= 2 && steps.every((s) => s.step_name && s.event_name);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Basic info */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1.5\">Funnel Name</label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            placeholder=\"e.g., E-commerce Checkout Funnel\"\r\n            className=\"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/20\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1.5\">Conversion Window</label>\r\n          <select\r\n            value={conversionWindowDays}\r\n            onChange={(e) => setConversionWindowDays(Number(e.target.value))}\r\n            className=\"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/20\"\r\n          >\r\n            <option value={7}>7 days</option>\r\n            <option value={14}>14 days</option>\r\n            <option value={30}>30 days</option>\r\n            <option value={60}>60 days</option>\r\n            <option value={90}>90 days</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium mb-1.5\">Description</label>\r\n        <textarea\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          placeholder=\"Describe this funnel...\"\r\n          rows={2}\r\n          className=\"w-full px-3 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/20 resize-none\"\r\n        />\r\n      </div>\r\n\r\n      {/* Steps builder */}\r\n      <div>\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <label className=\"block text-sm font-medium\">Funnel Steps ({steps.length}/20)</label>\r\n          {steps.length < 20 && (\r\n            <button\r\n              onClick={addStep}\r\n              className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-md bg-primary/10 text-primary hover:bg-primary/20 text-sm font-medium transition-colors\"\r\n            >\r\n              <Plus className=\"w-4 h-4\" />\r\n              Add Step\r\n            </button>\r\n          )}\r\n        </div>\r\n        <div className=\"space-y-6\">\r\n          {steps.map((step, index) => (\r\n            <StepBuilder\r\n              key={index}\r\n              step={step}\r\n              index={index}\r\n              onChange={(s) => updateStep(index, s)}\r\n              onRemove={() => removeStep(index)}\r\n              canRemove={steps.length > 2}\r\n            />\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Auto-refresh settings */}\r\n      <div className=\"flex items-center gap-4 p-4 rounded-lg bg-muted/30 border\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <input\r\n            type=\"checkbox\"\r\n            id=\"autoRefresh\"\r\n            checked={autoRefresh}\r\n            onChange={(e) => setAutoRefresh(e.target.checked)}\r\n            className=\"w-4 h-4 rounded border-gray-300\"\r\n          />\r\n          <label htmlFor=\"autoRefresh\" className=\"text-sm font-medium\">\r\n            Auto-refresh metrics\r\n          </label>\r\n        </div>\r\n        {autoRefresh && (\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-sm text-muted-foreground\">every</span>\r\n            <select\r\n              value={refreshIntervalHours}\r\n              onChange={(e) => setRefreshIntervalHours(Number(e.target.value))}\r\n              className=\"px-2 py-1 rounded border bg-background text-sm\"\r\n            >\r\n              <option value={1}>1 hour</option>\r\n              <option value={6}>6 hours</option>\r\n              <option value={12}>12 hours</option>\r\n              <option value={24}>24 hours</option>\r\n            </select>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Actions */}\r\n      <div className=\"flex items-center justify-end gap-3 pt-4 border-t\">\r\n        <button\r\n          onClick={onCancel}\r\n          className=\"px-4 py-2 rounded-lg border hover:bg-muted transition-colors\"\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          onClick={handleSubmit}\r\n          disabled={!isValid || isLoading}\r\n          className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 transition-colors\"\r\n        >\r\n          {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\r\n          {funnel ? 'Update Funnel' : 'Create Funnel'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface FunnelAnalysisViewProps {\r\n  funnel: CDPFunnel;\r\n  onBack: () => void;\r\n}\r\n\r\nfunction FunnelAnalysisView({ funnel, onBack }: FunnelAnalysisViewProps) {\r\n  const [startDate, setStartDate] = useState('');\r\n  const [endDate, setEndDate] = useState('');\r\n  const [selectedStep, setSelectedStep] = useState<number | null>(null);\r\n\r\n  const analyzeMutation = useAnalyzeFunnel();\r\n  const { data: dropOffs, isLoading: dropOffsLoading } = useFunnelDropOffs(\r\n    funnel.id,\r\n    selectedStep || 0,\r\n    { limit: 10 },\r\n    { enabled: selectedStep !== null && selectedStep > 0 }\r\n  );\r\n\r\n  const handleAnalyze = async () => {\r\n    await analyzeMutation.mutateAsync({\r\n      funnelId: funnel.id,\r\n      params: { start_date: startDate || undefined, end_date: endDate || undefined },\r\n    });\r\n  };\r\n\r\n  const analysis = analyzeMutation.data;\r\n  const metrics = analysis?.step_analysis || funnel.step_metrics || [];\r\n\r\n  // Helper to get conversion rate from either metric type\r\n  const getConversionRate = (step: (typeof metrics)[number]) => {\r\n    if ('conversion_rate' in step) return step.conversion_rate;\r\n    if ('conversion_rate_from_start' in step) return step.conversion_rate_from_start;\r\n    return 0;\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <button onClick={onBack} className=\"p-2 rounded-lg hover:bg-muted transition-colors\">\r\n            <ChevronRight className=\"w-5 h-5 rotate-180\" />\r\n          </button>\r\n          <div>\r\n            <h2 className=\"text-xl font-semibold\">{funnel.name}</h2>\r\n            <p className=\"text-sm text-muted-foreground\">{funnel.description}</p>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <span\r\n            className={cn(\r\n              'px-2 py-0.5 rounded-full text-xs font-medium',\r\n              funnel.status === 'active'\r\n                ? 'bg-green-500/10 text-green-500'\r\n                : 'bg-gray-500/10 text-gray-500'\r\n            )}\r\n          >\r\n            {funnel.status}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Date filter */}\r\n      <div className=\"flex items-center gap-4 p-4 rounded-lg border bg-card\">\r\n        <Calendar className=\"w-4 h-4 text-muted-foreground\" />\r\n        <div className=\"flex items-center gap-2\">\r\n          <input\r\n            type=\"date\"\r\n            value={startDate}\r\n            onChange={(e) => setStartDate(e.target.value)}\r\n            className=\"px-3 py-1.5 rounded-md border bg-background text-sm\"\r\n          />\r\n          <span className=\"text-muted-foreground\">to</span>\r\n          <input\r\n            type=\"date\"\r\n            value={endDate}\r\n            onChange={(e) => setEndDate(e.target.value)}\r\n            className=\"px-3 py-1.5 rounded-md border bg-background text-sm\"\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={handleAnalyze}\r\n          disabled={analyzeMutation.isPending}\r\n          className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-md bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium transition-colors\"\r\n        >\r\n          {analyzeMutation.isPending ? (\r\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n          ) : (\r\n            <BarChart3 className=\"w-4 h-4\" />\r\n          )}\r\n          Analyze\r\n        </button>\r\n      </div>\r\n\r\n      {/* Summary stats */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <div className=\"p-4 rounded-xl border bg-card\">\r\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\r\n            <Users className=\"w-4 h-4\" />\r\n            Total Entered\r\n          </div>\r\n          <div className=\"text-2xl font-bold\">\r\n            {(analysis?.total_entered || funnel.total_entered).toLocaleString()}\r\n          </div>\r\n        </div>\r\n        <div className=\"p-4 rounded-xl border bg-card\">\r\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\r\n            <Target className=\"w-4 h-4\" />\r\n            Total Converted\r\n          </div>\r\n          <div className=\"text-2xl font-bold\">\r\n            {(analysis?.total_converted || funnel.total_converted).toLocaleString()}\r\n          </div>\r\n        </div>\r\n        <div className=\"p-4 rounded-xl border bg-card\">\r\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\r\n            <Zap className=\"w-4 h-4\" />\r\n            Conversion Rate\r\n          </div>\r\n          <div className=\"text-2xl font-bold text-green-500\">\r\n            {(\r\n              (analysis?.overall_conversion_rate || funnel.overall_conversion_rate || 0) * 100\r\n            ).toFixed(1)}\r\n            %\r\n          </div>\r\n        </div>\r\n        <div className=\"p-4 rounded-xl border bg-card\">\r\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\r\n            <Clock className=\"w-4 h-4\" />\r\n            Avg. Time\r\n          </div>\r\n          <div className=\"text-2xl font-bold\">\r\n            {analysis?.avg_conversion_time_seconds\r\n              ? `${Math.round(analysis.avg_conversion_time_seconds / 3600)}h`\r\n              : '-'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Funnel visualization */}\r\n      <div className=\"p-6 rounded-xl border bg-card\">\r\n        <h3 className=\"font-medium mb-6\">Funnel Steps</h3>\r\n        <div className=\"space-y-4\">\r\n          {metrics.map((step, index) => {\r\n            const prevCount =\r\n              index === 0\r\n                ? analysis?.total_entered || funnel.total_entered\r\n                : metrics[index - 1].count;\r\n            const dropOffPct = prevCount > 0 ? ((prevCount - step.count) / prevCount) * 100 : 0;\r\n            const isSelected = selectedStep === step.step;\r\n\r\n            return (\r\n              <div key={index}>\r\n                <div\r\n                  className={cn(\r\n                    'relative p-4 rounded-lg border cursor-pointer transition-all',\r\n                    isSelected ? 'border-primary bg-primary/5' : 'hover:border-primary/50'\r\n                  )}\r\n                  onClick={() => setSelectedStep(isSelected ? null : step.step)}\r\n                >\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold\">\r\n                        {step.step}\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"font-medium\">{step.name}</div>\r\n                        <div className=\"text-xs text-muted-foreground\">{step.event_name}</div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <div className=\"text-lg font-bold\">{step.count.toLocaleString()}</div>\r\n                      <div className=\"text-xs text-muted-foreground\">\r\n                        {((getConversionRate(step) || 0) * 100).toFixed(1)}% from start\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Progress bar */}\r\n                  <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\r\n                    <div\r\n                      className=\"h-full bg-primary transition-all duration-500\"\r\n                      style={{ width: `${(getConversionRate(step) || 0) * 100}%` }}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Drop-off indicator */}\r\n                  {index > 0 && step.drop_off_count > 0 && (\r\n                    <div className=\"absolute -top-3 right-4 flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-500/10 text-red-500 text-xs font-medium\">\r\n                      <TrendingDown className=\"w-3 h-3\" />\r\n                      {dropOffPct.toFixed(1)}% dropped\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Drop-off arrow */}\r\n                {index < metrics.length - 1 && (\r\n                  <div className=\"flex justify-center py-2\">\r\n                    <ArrowDown className=\"w-5 h-5 text-muted-foreground\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Drop-offs panel */}\r\n      {selectedStep !== null && selectedStep > 0 && (\r\n        <div className=\"p-4 rounded-xl border bg-card\">\r\n          <h3 className=\"font-medium flex items-center gap-2 mb-4\">\r\n            <TrendingDown className=\"w-4 h-4 text-red-500\" />\r\n            Profiles that dropped off at Step {selectedStep}\r\n          </h3>\r\n          {dropOffsLoading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\r\n            </div>\r\n          ) : dropOffs?.profiles && dropOffs.profiles.length > 0 ? (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead>\r\n                  <tr className=\"border-b\">\r\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Profile ID\r\n                    </th>\r\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Lifecycle\r\n                    </th>\r\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Events\r\n                    </th>\r\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-muted-foreground\">\r\n                      Last Seen\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {dropOffs.profiles.map((profile) => (\r\n                    <tr key={profile.id} className=\"border-b hover:bg-muted/30\">\r\n                      <td className=\"py-2 px-3\">\r\n                        <code className=\"text-xs bg-muted px-2 py-1 rounded\">\r\n                          {profile.id.slice(0, 12)}...\r\n                        </code>\r\n                      </td>\r\n                      <td className=\"py-2 px-3 capitalize text-sm\">{profile.lifecycle_stage}</td>\r\n                      <td className=\"py-2 px-3 text-sm\">{profile.total_events}</td>\r\n                      <td className=\"py-2 px-3 text-sm text-muted-foreground\">\r\n                        {new Date(profile.last_seen_at).toLocaleDateString()}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-8 text-muted-foreground\">No drop-off data available</div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function FunnelBuilder() {\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [selectedFunnel, setSelectedFunnel] = useState<CDPFunnel | null>(null);\r\n  const [analyzingFunnel, setAnalyzingFunnel] = useState<CDPFunnel | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  const { data: funnelsData, isLoading, refetch } = useFunnels();\r\n  const deleteMutation = useDeleteFunnel();\r\n  const computeMutation = useComputeFunnel();\r\n\r\n  const funnels = funnelsData?.funnels || [];\r\n  const filteredFunnels = funnels.filter(\r\n    (f) =>\r\n      f.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      f.description?.toLowerCase().includes(searchQuery.toLowerCase())\r\n  );\r\n\r\n  const handleEdit = (funnel: CDPFunnel) => {\r\n    setSelectedFunnel(funnel);\r\n    setShowForm(true);\r\n  };\r\n\r\n  const handleDelete = async (funnelId: string) => {\r\n    if (confirm('Are you sure you want to delete this funnel?')) {\r\n      await deleteMutation.mutateAsync(funnelId);\r\n      refetch();\r\n    }\r\n  };\r\n\r\n  const handleCompute = async (funnelId: string) => {\r\n    await computeMutation.mutateAsync(funnelId);\r\n    refetch();\r\n  };\r\n\r\n  const handleFormSave = () => {\r\n    setShowForm(false);\r\n    setSelectedFunnel(null);\r\n    refetch();\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const styles: Record<string, string> = {\r\n      active: 'bg-green-500/10 text-green-500',\r\n      computing: 'bg-blue-500/10 text-blue-500',\r\n      stale: 'bg-amber-500/10 text-amber-500',\r\n      draft: 'bg-gray-500/10 text-gray-500',\r\n    };\r\n    return (\r\n      <span\r\n        className={cn(\r\n          'px-2 py-0.5 rounded-full text-xs font-medium',\r\n          styles[status] || styles.draft\r\n        )}\r\n      >\r\n        {status}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (analyzingFunnel) {\r\n    return <FunnelAnalysisView funnel={analyzingFunnel} onBack={() => setAnalyzingFunnel(null)} />;\r\n  }\r\n\r\n  if (showForm) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <button\r\n            onClick={() => {\r\n              setShowForm(false);\r\n              setSelectedFunnel(null);\r\n            }}\r\n            className=\"p-2 rounded-lg hover:bg-muted transition-colors\"\r\n          >\r\n            <ChevronRight className=\"w-5 h-5 rotate-180\" />\r\n          </button>\r\n          <h2 className=\"text-xl font-semibold\">\r\n            {selectedFunnel ? 'Edit Funnel' : 'Create Funnel'}\r\n          </h2>\r\n        </div>\r\n        <FunnelForm\r\n          funnel={selectedFunnel || undefined}\r\n          onSave={handleFormSave}\r\n          onCancel={() => {\r\n            setShowForm(false);\r\n            setSelectedFunnel(null);\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n        <div>\r\n          <h2 className=\"text-xl font-semibold flex items-center gap-2\">\r\n            <GitBranch className=\"w-6 h-6 text-primary\" />\r\n            Funnel Builder\r\n          </h2>\r\n          <p className=\"text-sm text-muted-foreground mt-1\">\r\n            Create and analyze conversion funnels to understand user journeys\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={() => setShowForm(true)}\r\n          className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors\"\r\n        >\r\n          <Plus className=\"w-4 h-4\" />\r\n          New Funnel\r\n        </button>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"relative\">\r\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n        <input\r\n          type=\"text\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          placeholder=\"Search funnels...\"\r\n          className=\"w-full pl-10 pr-4 py-2 rounded-lg border bg-background focus:ring-2 focus:ring-primary/20\"\r\n        />\r\n      </div>\r\n\r\n      {/* Funnels list */}\r\n      {isLoading ? (\r\n        <div className=\"flex items-center justify-center py-12\">\r\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n        </div>\r\n      ) : filteredFunnels.length === 0 ? (\r\n        <div className=\"text-center py-12 bg-card border rounded-xl\">\r\n          <GitBranch className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\r\n          <h3 className=\"font-semibold mb-2\">No funnels yet</h3>\r\n          <p className=\"text-sm text-muted-foreground mb-4\">\r\n            Create your first funnel to start tracking conversions\r\n          </p>\r\n          <button\r\n            onClick={() => setShowForm(true)}\r\n            className=\"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors\"\r\n          >\r\n            <Plus className=\"w-4 h-4\" />\r\n            Create Funnel\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {filteredFunnels.map((funnel) => (\r\n            <div\r\n              key={funnel.id}\r\n              className=\"p-4 rounded-xl border bg-card hover:shadow-md transition-all\"\r\n            >\r\n              <div className=\"flex items-start justify-between mb-3\">\r\n                <div>\r\n                  <h3 className=\"font-semibold\">{funnel.name}</h3>\r\n                  <p className=\"text-sm text-muted-foreground line-clamp-2\">\r\n                    {funnel.description || `${funnel.steps.length} steps`}\r\n                  </p>\r\n                </div>\r\n                {getStatusBadge(funnel.status)}\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-4 text-sm text-muted-foreground mb-4\">\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Users className=\"w-4 h-4\" />\r\n                  <span>{funnel.total_entered.toLocaleString()}</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Target className=\"w-4 h-4\" />\r\n                  <span>{((funnel.overall_conversion_rate || 0) * 100).toFixed(1)}%</span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Mini funnel visualization */}\r\n              <div className=\"flex items-center gap-1 mb-4\">\r\n                {funnel.steps.map((step, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"flex-1 h-2 bg-primary/20 rounded-full overflow-hidden\"\r\n                    title={step.step_name}\r\n                  >\r\n                    <div\r\n                      className=\"h-full bg-primary\"\r\n                      style={{\r\n                        width: `${\r\n                          funnel.step_metrics?.[index]?.conversion_rate\r\n                            ? funnel.step_metrics[index].conversion_rate * 100\r\n                            : 100\r\n                        }%`,\r\n                      }}\r\n                    />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-2 pt-3 border-t\">\r\n                <button\r\n                  onClick={() => setAnalyzingFunnel(funnel)}\r\n                  className=\"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-md bg-primary/10 text-primary hover:bg-primary/20 text-sm font-medium transition-colors\"\r\n                >\r\n                  <BarChart3 className=\"w-4 h-4\" />\r\n                  Analyze\r\n                </button>\r\n                <button\r\n                  onClick={() => handleEdit(funnel)}\r\n                  className=\"px-3 py-1.5 rounded-md bg-muted hover:bg-muted/80 text-sm font-medium transition-colors\"\r\n                >\r\n                  Edit\r\n                </button>\r\n                <button\r\n                  onClick={() => handleCompute(funnel.id)}\r\n                  disabled={computeMutation.isPending}\r\n                  className=\"px-3 py-1.5 rounded-md hover:bg-muted text-sm font-medium transition-colors\"\r\n                >\r\n                  <RefreshCw\r\n                    className={cn('w-4 h-4', computeMutation.isPending && 'animate-spin')}\r\n                  />\r\n                </button>\r\n                <button\r\n                  onClick={() => handleDelete(funnel.id)}\r\n                  className=\"px-3 py-1.5 rounded-md hover:bg-red-500/10 text-muted-foreground hover:text-red-500 text-sm font-medium transition-colors\"\r\n                >\r\n                  <Trash2 className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default FunnelBuilder;\r\n","/**\r\n * CDP Funnel Builder View\r\n * Page for creating and analyzing conversion funnels\r\n */\r\n\r\nimport { FunnelBuilder } from '@/components/cdp/FunnelBuilder';\r\n\r\nexport default function CDPFunnels() {\r\n  return (\r\n    <div className=\"p-6\">\r\n      <FunnelBuilder />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["CONDITION_OPERATORS","COMMON_EVENTS","StepBuilder","step","index","onChange","onRemove","canRemove","showConditions","setShowConditions","useState","addCondition","updateCondition","condIndex","field","value","newConditions","removeCondition","_","i","jsxs","jsx","e","event","Trash2","ChevronDown","ChevronRight","Filter","_a","condition","op","Plus","FunnelForm","funnel","onSave","onCancel","name","setName","description","setDescription","steps","setSteps","conversionWindowDays","setConversionWindowDays","stepTimeoutHours","_setStepTimeoutHours","autoRefresh","setAutoRefresh","refreshIntervalHours","setRefreshIntervalHours","createMutation","useCreateFunnel","updateMutation","useUpdateFunnel","addStep","updateStep","newSteps","removeStep","handleSubmit","data","error","isLoading","isValid","s","Loader2","Save","FunnelAnalysisView","onBack","startDate","setStartDate","endDate","setEndDate","selectedStep","setSelectedStep","analyzeMutation","useAnalyzeFunnel","dropOffs","dropOffsLoading","useFunnelDropOffs","handleAnalyze","analysis","metrics","getConversionRate","cn","Calendar","BarChart3","Users","Target","Zap","Clock","prevCount","dropOffPct","isSelected","TrendingDown","ArrowDown","profile","FunnelBuilder","showForm","setShowForm","selectedFunnel","setSelectedFunnel","analyzingFunnel","setAnalyzingFunnel","searchQuery","setSearchQuery","funnelsData","refetch","useFunnels","deleteMutation","useDeleteFunnel","computeMutation","useComputeFunnel","filteredFunnels","f","handleEdit","handleDelete","funnelId","handleCompute","handleFormSave","getStatusBadge","status","styles","GitBranch","Search","_b","RefreshCw","CDPFunnels"],"mappings":"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"}