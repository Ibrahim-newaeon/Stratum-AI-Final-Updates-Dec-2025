import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as o}from"./vendor-react-Dz7uKsMg.js";import{t as l,Q as G,j as J,Z as w,$ as X,P as Y,V as ee,s as te,v as se,X as ae,y as ne,c as re,G as oe,B as ie}from"./index-BQex3859.js";import{u as le,a as _,b as k}from"./vendor-query-BPt-n81V.js";import"./featureFlagsStore-DvEl_DiZ.js";import{P as ce}from"./plus-B9u7Tds1.js";import{L as C}from"./loader-circle-CJwg01sb.js";import{P}from"./pause-CGHTPI-4.js";import{S as L}from"./square-pen-6DBNh-jk.js";import{C as de}from"./copy-CekHEH52.js";import{M as ue}from"./message-circle-DBK1o5j4.js";import{D as me}from"./dollar-sign-Dosx4kzY.js";import{T as pe}from"./tag-DoKlR16h.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-motion-CR45sdSp.js";const y={getRules:async(s={})=>(await l.get("/rules",{params:s})).data.data,getRule:async s=>(await l.get(`/rules/${s}`)).data.data,createRule:async s=>(await l.post("/rules",s)).data.data,updateRule:async(s,r)=>(await l.patch(`/rules/${s}`,r)).data.data,deleteRule:async s=>{await l.delete(`/rules/${s}`)},toggleRule:async s=>(await l.post(`/rules/${s}/toggle`)).data.data,executeRule:async s=>(await l.post(`/rules/${s}/execute`)).data.data,getRuleExecutions:async(s,r=10)=>(await l.get(`/rules/${s}/executions`,{params:{limit:r}})).data.data,getTemplates:async()=>(await l.get("/rules/templates")).data.data,validateConditions:async s=>(await l.post("/rules/validate",{conditions:s})).data.data};function ge(s={}){return le({queryKey:["rules",s],queryFn:()=>y.getRules(s),staleTime:30*1e3})}function xe(){const s=_();return k({mutationFn:y.createRule,onSuccess:()=>{s.invalidateQueries({queryKey:["rules"]})}})}function he(){const s=_();return k({mutationFn:({id:r,data:c})=>y.updateRule(r,c),onSuccess:(r,c)=>{s.invalidateQueries({queryKey:["rules"]}),s.invalidateQueries({queryKey:["rules",c.id]})}})}function fe(){const s=_();return k({mutationFn:y.deleteRule,onSuccess:()=>{s.invalidateQueries({queryKey:["rules"]})}})}function be(){const s=_();return k({mutationFn:y.toggleRule,onSuccess:(r,c)=>{s.invalidateQueries({queryKey:["rules"]}),s.invalidateQueries({queryKey:["rules",c]})}})}const ye=[{id:1,name:"WhatsApp Alert for Budget Overspend",description:"Send WhatsApp notification when campaign spends over 80% of budget",status:"active",condition:{field:"spend",operator:"greater_than",value:"800"},action:{type:"notify_whatsapp",config:{contact_ids:[1,2],template_name:"rule_alert"}},appliesTo:["Summer Sale 2024","Brand Awareness Q4"],triggerCount:7,lastTriggered:"2024-12-06T08:00:00Z",cooldownHours:12,createdAt:"2024-12-01"},{id:2,name:"Pause Low ROAS Campaigns",description:"Automatically pause campaigns when ROAS drops below 2.0",status:"active",condition:{field:"roas",operator:"less_than",value:"2.0"},action:{type:"pause_campaign",config:{}},appliesTo:["All Campaigns"],triggerCount:12,lastTriggered:"2024-11-28T14:30:00Z",cooldownHours:24,createdAt:"2024-06-15"},{id:3,name:"Alert on High Spend",description:"Send alert when daily spend exceeds $500",status:"active",condition:{field:"spend",operator:"greater_than",value:"500"},action:{type:"send_alert",config:{email:"marketing@company.com"}},appliesTo:["Summer Sale 2024","Brand Awareness Q4"],triggerCount:45,lastTriggered:"2024-11-29T09:15:00Z",cooldownHours:4,createdAt:"2024-07-20"},{id:4,name:"Label High Performers",description:'Apply "star" label to campaigns with ROAS above 4.0',status:"active",condition:{field:"roas",operator:"greater_than",value:"4.0"},action:{type:"apply_label",config:{label:"star-performer"}},appliesTo:["All Campaigns"],triggerCount:8,lastTriggered:"2024-11-27T16:45:00Z",cooldownHours:12,createdAt:"2024-08-10"},{id:5,name:"Budget Boost for Winners",description:"Increase budget by 20% when CTR exceeds 3%",status:"paused",condition:{field:"ctr",operator:"greater_than",value:"3.0"},action:{type:"adjust_budget",config:{adjustment_percent:20}},appliesTo:["Product Launch - Widget Pro"],triggerCount:3,lastTriggered:"2024-11-25T11:00:00Z",cooldownHours:48,createdAt:"2024-09-05"},{id:6,name:"Slack Alert for Fatigue",description:"Notify Slack when creative fatigue score exceeds 70%",status:"draft",condition:{field:"fatigue_score",operator:"greater_than",value:"70"},action:{type:"notify_slack",config:{channel:"#marketing-alerts"}},appliesTo:[],triggerCount:0,lastTriggered:null,cooldownHours:24,createdAt:"2024-11-28"}],$=[{value:"equals",label:"="},{value:"not_equals",label:"≠"},{value:"greater_than",label:">"},{value:"less_than",label:"<"},{value:"greater_than_or_equal",label:"≥"},{value:"less_than_or_equal",label:"≤"}],je=["roas","ctr","cpc","cpa","spend","impressions","clicks","conversions","fatigue_score"];function $e(){const{t:s}=G(),[r,c]=o.useState(""),[R,Q]=o.useState("all"),[E,f]=o.useState(!1),{toast:i}=J(),[p,F]=o.useState(null),[T,S]=o.useState(null),[n,d]=o.useState({name:"",description:"",conditionField:"roas",conditionOperator:"less_than",conditionValue:"",actionType:"send_alert",cooldownHours:24}),{data:g,isLoading:A}=ge(),b=be(),u=xe(),j=he(),v=fe(),x=o.useCallback(()=>{d({name:"",description:"",conditionField:"roas",conditionOperator:"less_than",conditionValue:"",actionType:"send_alert",cooldownHours:24}),F(null)},[]),H=o.useCallback(()=>{x(),f(!0)},[x]),O=o.useCallback(t=>{F(t),d({name:t.name,description:t.description,conditionField:t.condition.field,conditionOperator:t.condition.operator,conditionValue:t.condition.value,actionType:t.action.type,cooldownHours:t.cooldownHours}),f(!0)},[]),B=o.useCallback(async t=>{try{await u.mutateAsync({name:`${t.name} (Copy)`,description:t.description,conditions:[{field:t.condition.field,operator:t.condition.operator,value:t.condition.value}],actions:[{type:t.action.type,config:t.action.config}],trigger:"metric_threshold",status:"draft"}),i({title:"Rule duplicated",description:`"${t.name}" has been duplicated as a draft.`})}catch{i({title:"Error",description:"Failed to duplicate rule.",variant:"destructive"})}},[u,i]),M=o.useCallback(async()=>{if(!n.name.trim()||!n.conditionValue.trim())return;const t={name:n.name,description:n.description,conditions:[{field:n.conditionField,operator:n.conditionOperator,value:n.conditionValue}],actions:[{type:n.actionType,config:{}}],trigger:"metric_threshold",cooldown_hours:n.cooldownHours};try{p?(await j.mutateAsync({id:p.id.toString(),data:t}),i({title:"Rule updated",description:`"${n.name}" has been updated.`})):(await u.mutateAsync(t),i({title:"Rule created",description:`"${n.name}" has been created.`})),f(!1),x()}catch{i({title:"Error",description:`Failed to ${p?"update":"create"} rule.`,variant:"destructive"})}},[n,p,u,j,i,x]),V=o.useCallback(async t=>{try{await v.mutateAsync(t.id.toString()),i({title:"Rule deleted",description:`"${t.name}" has been deleted.`}),S(null)}catch{i({title:"Error",description:"Failed to delete rule.",variant:"destructive"})}},[v,i]),N=o.useMemo(()=>g!=null&&g.items&&g.items.length>0?g.items.map(t=>{var a,m;return{id:Number(t.id)||0,name:t.name||"",description:t.description||"",status:t.status||t.is_active?"active":"paused",condition:t.condition||((a=t.conditions)==null?void 0:a[0])||{field:"roas",operator:"less_than",value:"2.0"},action:t.action||((m=t.actions)==null?void 0:m[0])||{type:"send_alert",config:{}},appliesTo:t.applies_to||t.campaigns||[],triggerCount:t.trigger_count||t.triggerCount||0,lastTriggered:t.last_triggered||t.lastTriggered||null,cooldownHours:t.cooldown_hours||t.cooldownHours||24,createdAt:t.created_at||t.createdAt||new Date().toISOString()}}):ye,[g]),q=async(t,a)=>{await b.mutateAsync(t.toString())},D=N.filter(t=>!(r&&!t.name.toLowerCase().includes(r.toLowerCase())||R!=="all"&&t.status!==R)),K=t=>{const a={active:{color:"bg-green-500/10 text-green-500",icon:ne,label:"Active"},paused:{color:"bg-amber-500/10 text-amber-500",icon:P,label:"Paused"},draft:{color:"bg-gray-500/10 text-gray-500",icon:L,label:"Draft"}},{color:m,icon:h,label:z}=a[t];return e.jsxs("span",{className:re("px-2 py-1 rounded-full text-xs font-medium inline-flex items-center gap-1",m),children:[e.jsx(h,{className:"w-3 h-3"}),z]})},Z=t=>{switch(t){case"apply_label":return e.jsx(pe,{className:"w-4 h-4 text-blue-500"});case"send_alert":return e.jsx(ie,{className:"w-4 h-4 text-amber-500"});case"pause_campaign":return e.jsx(P,{className:"w-4 h-4 text-red-500"});case"adjust_budget":return e.jsx(me,{className:"w-4 h-4 text-green-500"});case"notify_slack":return e.jsx(oe,{className:"w-4 h-4 text-purple-500"});case"notify_whatsapp":return e.jsx(ue,{className:"w-4 h-4 text-green-600"})}},I=t=>({apply_label:"Apply Label",send_alert:"Send Alert",pause_campaign:"Pause Campaign",adjust_budget:"Adjust Budget",notify_slack:"Notify Slack",notify_whatsapp:"Notify WhatsApp"})[t],W=t=>{var a;return((a=$.find(m=>m.value===t))==null?void 0:a.label)||t},U=t=>{if(!t)return"Never";const a=new Date(t),h=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60));return h<1?"Just now":h<24?`${h}h ago`:h<48?"Yesterday":a.toLocaleDateString()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(w,{className:"w-7 h-7 text-primary"}),s("rules.title")]}),e.jsx("p",{className:"text-muted-foreground",children:s("rules.subtitle")})]}),e.jsxs("button",{onClick:H,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:s("rules.createRule")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"metric-card info p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s("rules.totalRules")}),e.jsx("p",{className:"text-2xl font-bold",children:A?"...":N.length})]}),e.jsxs("div",{className:"metric-card success p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s("rules.activeRules")}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:A?"...":N.filter(t=>t.status==="active").length})]}),e.jsxs("div",{className:"metric-card active p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s("rules.triggersToday")}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:"23"})]}),e.jsxs("div",{className:"metric-card premium p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s("rules.actionsExecuted")}),e.jsx("p",{className:"text-2xl font-bold",children:A?"...":N.reduce((t,a)=>t+a.triggerCount,0)})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:s("rules.searchPlaceholder"),value:r,onChange:t=>c(t.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("select",{value:R,onChange:t=>Q(t.target.value),className:"px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"all",children:s("rules.allStatuses")}),e.jsx("option",{value:"active",children:s("rules.active")}),e.jsx("option",{value:"paused",children:s("rules.paused")}),e.jsx("option",{value:"draft",children:s("rules.draft")})]})]}),e.jsx("div",{className:"space-y-4",children:D.map(t=>e.jsxs("div",{className:"rounded-xl border bg-card p-5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(w,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:t.name}),K(t.status)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="active"?e.jsx("button",{onClick:()=>q(t.id,t.status),disabled:b.isPending,className:"p-2 rounded-lg hover:bg-muted transition-colors disabled:opacity-50",title:"Pause",children:b.isPending?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"})}):e.jsx("button",{onClick:()=>q(t.id,t.status),disabled:b.isPending,className:"p-2 rounded-lg hover:bg-muted transition-colors disabled:opacity-50",title:"Activate",children:b.isPending?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>O(t),className:"p-2 rounded-lg hover:bg-muted transition-colors",title:"Edit",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(t),disabled:u.isPending,className:"p-2 rounded-lg hover:bg-muted transition-colors disabled:opacity-50",title:"Duplicate",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(t),className:"p-2 rounded-lg hover:bg-muted hover:text-red-500 transition-colors",title:"Delete",children:e.jsx(ee,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4 p-3 rounded-lg bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:"IF"}),e.jsx("span",{className:"px-2 py-1 rounded bg-background text-sm font-mono",children:t.condition.field}),e.jsx("span",{className:"text-sm font-bold",children:W(t.condition.operator)}),e.jsx("span",{className:"px-2 py-1 rounded bg-background text-sm font-mono",children:t.condition.value}),e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"THEN"}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-background",children:[Z(t.action.type),e.jsx("span",{className:"text-sm",children:I(t.action.type)})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("rules.appliesTo"),":"]}),e.jsx("span",{className:"font-medium",children:t.appliesTo.length>0?t.appliesTo.join(", "):"Not configured"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:[s("rules.cooldown"),":"]}),e.jsxs("span",{className:"font-medium",children:[t.cooldownHours,"h"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:[s("rules.triggered"),":"]}),e.jsxs("span",{className:"font-medium",children:[t.triggerCount," times"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("rules.lastTriggered"),":"]}),e.jsx("span",{className:"font-medium",children:U(t.lastTriggered)})]})]})]},t.id))}),D.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s("rules.noRules")}),e.jsx("button",{onClick:H,className:"mt-4 text-primary hover:underline",children:s("rules.createFirst")})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background rounded-xl p-6 w-full max-w-2xl mx-4 max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:p?"Edit Rule":s("rules.createRule")}),e.jsx("button",{onClick:()=>{f(!1),x()},className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:s("rules.ruleName")}),e.jsx("input",{type:"text",value:n.name,onChange:t=>d(a=>({...a,name:t.target.value})),className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20",placeholder:"e.g., Pause Low Performers"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:s("rules.description")}),e.jsx("textarea",{value:n.description,onChange:t=>d(a=>({...a,description:t.target.value})),className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20",rows:2,placeholder:"Describe what this rule does..."})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:s("rules.condition")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("select",{value:n.conditionField,onChange:t=>d(a=>({...a,conditionField:t.target.value})),className:"flex-1 px-3 py-2 rounded-lg border bg-background",children:je.map(t=>e.jsx("option",{value:t,children:t.toUpperCase()},t))}),e.jsx("select",{value:n.conditionOperator,onChange:t=>d(a=>({...a,conditionOperator:t.target.value})),className:"w-24 px-3 py-2 rounded-lg border bg-background",children:$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("input",{type:"text",value:n.conditionValue,onChange:t=>d(a=>({...a,conditionValue:t.target.value})),className:"w-32 px-3 py-2 rounded-lg border bg-background",placeholder:"Value"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:s("rules.action")}),e.jsxs("select",{value:n.actionType,onChange:t=>d(a=>({...a,actionType:t.target.value})),className:"w-full px-3 py-2 rounded-lg border bg-background",children:[e.jsx("option",{value:"apply_label",children:"Apply Label"}),e.jsx("option",{value:"send_alert",children:"Send Alert"}),e.jsx("option",{value:"pause_campaign",children:"Pause Campaign"}),e.jsx("option",{value:"adjust_budget",children:"Adjust Budget"}),e.jsx("option",{value:"notify_slack",children:"Notify Slack"}),e.jsx("option",{value:"notify_whatsapp",children:"Notify WhatsApp"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Cooldown (hours)"}),e.jsx("input",{type:"number",value:n.cooldownHours,onChange:t=>d(a=>({...a,cooldownHours:parseInt(t.target.value)||1})),className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/20",min:1,max:168}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum time between rule triggers"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{f(!1),x()},className:"px-4 py-2 rounded-lg border hover:bg-muted transition-colors",children:s("common.cancel")}),e.jsxs("button",{onClick:M,disabled:u.isPending||j.isPending||!n.name.trim()||!n.conditionValue.trim(),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors disabled:opacity-50",children:[(u.isPending||j.isPending)&&e.jsx(C,{className:"w-4 h-4 animate-spin"}),p?"Update Rule":s("rules.createRule")]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background rounded-xl p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Delete Rule"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:['Are you sure you want to delete "',T.name,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>S(null),className:"px-4 py-2 rounded-lg border hover:bg-muted transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>V(T),disabled:v.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors disabled:opacity-50",children:[v.isPending&&e.jsx(C,{className:"w-4 h-4 animate-spin"}),"Delete"]})]})]})})]})}export{$e as Rules,$e as default};
//# sourceMappingURL=Rules-DkX704mF.js.map
