import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as o,k as M}from"./vendor-react-Dz7uKsMg.js";import{a7 as I,c as b,cS as R,cX as E,F as S}from"./index-BQex3859.js";import{o as C,g as L,p as $}from"./cdp-B6W0ktOz.js";import{F as G}from"./MagnifyingGlassIcon-3MUvqIvj.js";import{F as _}from"./UserCircleIcon-C5qf10f0.js";import{F as H}from"./InformationCircleIcon-B_QjEB21.js";import{F as D}from"./DevicePhoneMobileIcon-Dd0vk1HG.js";import{F as A}from"./PhoneIcon-Ct1N2tQX.js";import{F as z}from"./EnvelopeIcon-CWLK6IWu.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";function O({title:t,titleId:n,...s},r){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},s),t?o.createElement("title",{id:n},t):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"}))}const B=o.forwardRef(O),j={email:{icon:z,color:"bg-blue-500",label:"Email"},phone:{icon:A,color:"bg-green-500",label:"Phone"},device_id:{icon:D,color:"bg-purple-500",label:"Device"},anonymous_id:{icon:_,color:"bg-gray-500",label:"Anonymous"},external_id:{icon:E,color:"bg-orange-500",label:"External"}};function W({node:t,x:n,y:s,isSelected:r,onClick:c}){const d=j[t.type]||j.anonymous_id,m=d.icon;return e.jsxs("g",{transform:`translate(${n}, ${s})`,onClick:c,className:"cursor-pointer",children:[r&&e.jsx("circle",{r:32,fill:"none",stroke:"currentColor",strokeWidth:2,className:"text-primary animate-pulse"}),e.jsx("circle",{r:24,className:b(d.color,"transition-transform hover:scale-110")}),e.jsx("foreignObject",{x:-12,y:-12,width:24,height:24,children:e.jsx(m,{className:"h-6 w-6 text-white"})}),t.is_primary&&e.jsxs("g",{transform:"translate(16, -16)",children:[e.jsx("circle",{r:8,className:"fill-yellow-400"}),e.jsx("foreignObject",{x:-6,y:-6,width:12,height:12,children:e.jsx(B,{className:"h-3 w-3 text-yellow-900"})})]}),e.jsx("text",{y:40,textAnchor:"middle",className:"text-xs fill-current text-muted-foreground",children:d.label})]})}function X({edge:t,x1:n,y1:s,x2:r,y2:c}){const d=t.confidence*100;return e.jsxs("g",{children:[e.jsx("line",{x1:n,y1:s,x2:r,y2:c,stroke:"currentColor",strokeWidth:Math.max(1,d/25),className:"text-muted-foreground/50",strokeDasharray:d<50?"4 4":void 0}),e.jsx("text",{x:(n+r)/2,y:(s+c)/2-8,textAnchor:"middle",className:"text-[10px] fill-current text-muted-foreground",children:t.type.replace("_"," ")})]})}function K(t,n,s,r){return o.useMemo(()=>{if(t.length===0)return{nodePositions:new Map};const c=new Map,d=s/2,m=r/2,x=Math.min(s,r)/3;return t.forEach((u,y)=>{const h=2*Math.PI*y/t.length-Math.PI/2,N=d+x*Math.cos(h),v=m+x*Math.sin(h);c.set(u.id,{x:N,y:v})}),{nodePositions:c}},[t,n,s,r])}function T({node:t,onClose:n}){const s=j[t.type]||j.anonymous_id;return e.jsxs("div",{className:"absolute top-4 right-4 w-72 bg-card rounded-xl border shadow-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:b("h-10 w-10 rounded-lg flex items-center justify-center",s.color),children:e.jsx(s.icon,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.is_primary?"Primary":"Secondary"})]})]}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-muted rounded",children:e.jsx(S,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Identifier Hash"}),e.jsx("p",{className:"font-mono text-xs break-all",children:t.hash})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Priority"}),e.jsx("p",{className:"font-medium",children:t.priority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx("p",{className:"font-medium",children:t.is_primary?"Primary Identifier":"Linked Identifier"})]})]})]})}function V({profileId:t}){const{data:n,isLoading:s}=$(t);return s?e.jsx("div",{className:"space-y-2",children:[1,2].map(r=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"},r))}):!(n!=null&&n.merges)||n.merges.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No merge history for this profile"}):e.jsx("div",{className:"space-y-2",children:n.merges.map(r=>e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium capitalize",children:r.merge_reason.replace("_"," ")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Merged ",r.merged_event_count," events, ",r.merged_identifier_count," identifiers"]}),r.is_rolled_back&&e.jsx("span",{className:"mt-1 inline-block px-2 py-0.5 bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 rounded text-xs",children:"Rolled back"})]},r.id))})}function oe(){const[t]=M(),n=t.get("profile")||"",[s,r]=o.useState(n),[c,d]=o.useState(n),[m,x]=o.useState(null),[u,y]=o.useState(!1),h=o.useRef(null),[N,v]=o.useState({width:600,height:400}),{data:a,isLoading:P,refetch:F}=C(s,{enabled:!!s}),{data:f}=L(s,{enabled:!!s});o.useEffect(()=>{const i=()=>{var l;if((l=h.current)!=null&&l.parentElement){const{width:p,height:g}=h.current.parentElement.getBoundingClientRect();v({width:p,height:Math.max(400,g)})}};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const{nodePositions:w}=K((a==null?void 0:a.nodes)||[],(a==null?void 0:a.edges)||[],N.width,N.height),k=()=>{r(c.trim()),x(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Identity Graph"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Visualize identity relationships and profile connections"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",value:c,onChange:i=>d(i.target.value),onKeyDown:i=>i.key==="Enter"&&k(),placeholder:"Enter profile ID...",className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm"})]}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors",children:"Load Graph"}),s&&e.jsx("button",{onClick:()=>F(),className:"p-2 border rounded-lg hover:bg-muted transition-colors",title:"Refresh",children:e.jsx(I,{className:"h-5 w-5"})})]}),f&&e.jsx("div",{className:"bg-card rounded-xl border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-stratum flex items-center justify-center",children:e.jsx(_,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold font-mono",children:[f.id.slice(0,16),"..."]}),e.jsxs("p",{className:"text-sm text-muted-foreground capitalize",children:[f.lifecycle_stage," | ",f.total_events," events | $",f.total_revenue.toLocaleString()," revenue"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>y(!u),className:b("px-3 py-1.5 text-sm border rounded-lg transition-colors",u?"bg-primary/10 border-primary":"hover:bg-muted"),children:"Merge History"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-card rounded-xl border relative",style:{minHeight:500},children:s?P?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})}):a!=null&&a.nodes&&a.nodes.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{ref:h,width:"100%",height:"100%",className:"min-h-[500px]",children:[a.edges.map((i,l)=>{const p=w.get(i.source),g=w.get(i.target);return!p||!g?null:e.jsx(X,{edge:i,x1:p.x,y1:p.y,x2:g.x,y2:g.y},l)}),a.nodes.map(i=>{const l=w.get(i.id);return l?e.jsx(W,{node:i,x:l.x,y:l.y,isSelected:(m==null?void 0:m.id)===i.id,onClick:()=>x(i)},i.id):null})]}),m&&e.jsx(T,{node:m,onClose:()=>x(null)})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-muted-foreground",children:[e.jsx(H,{className:"h-16 w-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No Identity Graph Data"}),e.jsx("p",{className:"text-sm",children:"This profile has no linked identifiers"})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-muted-foreground",children:[e.jsx(R,{className:"h-16 w-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Enter a Profile ID"}),e.jsx("p",{className:"text-sm",children:"to visualize identity connections"})]})}),e.jsxs("div",{className:"space-y-4",children:[a&&e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Graph Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Identifiers"}),e.jsx("p",{className:"text-xl font-bold",children:a.total_identifiers})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connections"}),e.jsx("p",{className:"text-xl font-bold",children:a.total_links})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Legend"}),e.jsx("div",{className:"space-y-2",children:Object.entries(j).map(([i,l])=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:b("h-6 w-6 rounded-full flex items-center justify-center",l.color),children:e.jsx(l.icon,{className:"h-3 w-3 text-white"})}),e.jsx("span",{className:"text-sm",children:l.label})]},i))}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-8 border-2 border-muted-foreground/50"}),e.jsx("span",{className:"text-muted-foreground",children:"High confidence"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-8 border-2 border-muted-foreground/50 border-dashed"}),e.jsx("span",{className:"text-muted-foreground",children:"Low confidence"})]})]})]}),u&&s&&e.jsxs("div",{className:"bg-card rounded-xl border p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Merge History"}),e.jsx(V,{profileId:s})]})]})]})]})}export{oe as default};
//# sourceMappingURL=CDPIdentityGraph-DDEf40Dg.js.map
