import{j as e}from"./vendor-ui-B0DL0VNC.js";import{f as y,r as h}from"./vendor-react-Dz7uKsMg.js";import{b as g,u as o}from"./vendor-query-BPt-n81V.js";import{c as x,d2 as w,a5 as F,a6 as S,b,t as i}from"./index-BQex3859.js";import{F as P}from"./ArrowTrendingDownIcon-DA5nft8Y.js";import{F as A}from"./InformationCircleIcon-B_QjEB21.js";import{F as L}from"./BeakerIcon-DX6qkZ0w.js";import{F as p}from"./LightBulbIcon-Bq6eSglt.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-motion-CR45sdSp.js";const l={getModels:async()=>(await i.get("/ml/models")).data.data,getModelInfo:async a=>(await i.get(`/ml/models/${a}`)).data.data,getFeatureImportance:async a=>(await i.get(`/ml/models/${a}/feature-importance`)).data.data,explainPrediction:async a=>(await i.post("/ml/explain",a)).data.data,getSHAPSummary:async a=>(await i.get(`/ml/models/${a}/shap-summary`)).data.data,getLTVPrediction:async a=>(await i.post("/ml/predictions/ltv",a)).data.data};function M(){return o({queryKey:["ml","models"],queryFn:l.getModels})}function k(a){return o({queryKey:["ml","models",a],queryFn:()=>l.getModelInfo(a),enabled:!!a})}function C(a){return o({queryKey:["ml","models",a,"feature-importance"],queryFn:()=>l.getFeatureImportance(a),enabled:!!a})}function H(a){return o({queryKey:["ml","models",a,"shap-summary"],queryFn:()=>l.getSHAPSummary(a),enabled:!!a})}function U(){return g({mutationFn:l.explainPrediction})}function V(){return g({mutationFn:l.getLTVPrediction})}const E={roas_optimizer:"ROAS Optimizer",conversion_predictor:"Conversion Predictor",ltv_predictor:"LTV Predictor",attribution:"Attribution Model"};function W(){var u;y();const[a,d]=h.useState("roas_optimizer"),[n,j]=h.useState("overview");M();const{data:t}=k(a),{data:c}=C(a),{data:m}=H(a),r=V(),N=[{id:"overview",label:"Overview"},{id:"shap",label:"SHAP Analysis"},{id:"lime",label:"LIME Explanations"},{id:"ltv",label:"LTV Predictions"}],v=c?Math.max(...c.map(s=>Math.abs(s.importance))):1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Model Explainability"}),e.jsx("p",{className:"text-muted-foreground",children:"Understand how ML models make predictions with SHAP and LIME"})]}),e.jsx("select",{value:a,onChange:s=>d(s.target.value),className:"px-4 py-2 rounded-lg border bg-background",children:Object.entries(E).map(([s,f])=>e.jsx("option",{value:s,children:f},s))})]}),e.jsx("div",{className:"border-b",children:e.jsx("nav",{className:"flex gap-4",children:N.map(s=>e.jsx("button",{onClick:()=>j(s.id),className:x("px-4 py-2 border-b-2 font-medium text-sm transition-colors",n===s.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:s.label},s.id))})}),n==="overview"&&e.jsxs("div",{className:"space-y-6",children:[t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Model"})]}),e.jsx("p",{className:"text-xl font-bold",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["v",t.version]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Features"}),e.jsx("p",{className:"text-2xl font-bold",children:t.featureCount})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Training Samples"}),e.jsx("p",{className:"text-2xl font-bold",children:t.sampleCount.toLocaleString()})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.metrics.accuracy!==void 0?"Accuracy":"RMSE"}),e.jsx("p",{className:"text-2xl font-bold",children:t.metrics.accuracy!==void 0?`${(t.metrics.accuracy*100).toFixed(1)}%`:(u=t.metrics.rmse)==null?void 0:u.toFixed(3)})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(F,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Feature Importance"})]}),e.jsx("div",{className:"space-y-4",children:c==null?void 0:c.slice(0,15).map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.feature}),s.direction==="positive"&&e.jsx(S,{className:"h-4 w-4 text-emerald-500"}),s.direction==="negative"&&e.jsx(P,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("span",{className:"text-muted-foreground",children:[(s.importance*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:x("h-2 rounded-full",s.direction==="positive"&&"bg-emerald-500",s.direction==="negative"&&"bg-red-500",s.direction==="neutral"&&"bg-blue-500"),style:{width:`${Math.abs(s.importance)/v*100}%`}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]},s.feature))})]}),e.jsx("div",{className:"rounded-xl border bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800 p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(A,{className:"h-6 w-6 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100",children:"About Model Explainability"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-2",children:[e.jsx("strong",{children:"SHAP (SHapley Additive exPlanations)"})," uses game theory to calculate feature contributions. Each feature's SHAP value represents its contribution to pushing the prediction away from the baseline."]}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-2",children:[e.jsx("strong",{children:"LIME (Local Interpretable Model-agnostic Explanations)"})," creates locally faithful explanations by training interpretable models on perturbations of the input."]})]})]})})]}),n==="shap"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(b,{className:"h-6 w-6 text-purple-600"}),e.jsx("h2",{className:"text-lg font-semibold",children:"SHAP Feature Summary"})]}),m&&e.jsx("div",{className:"space-y-4",children:m.features.slice(0,15).map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-40 text-sm font-medium truncate",children:s.name}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"h-6 bg-gradient-to-r from-blue-500 to-red-500 rounded",style:{width:`${s.meanAbsShap/m.features[0].meanAbsShap*100}%`}})})}),e.jsx("div",{className:"w-20 text-right text-sm text-muted-foreground",children:s.meanAbsShap.toFixed(4)})]},s.name))}),e.jsx("div",{className:"mt-6 p-4 rounded-lg bg-muted/50",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"How to read:"})," Features are ranked by their mean absolute SHAP value across all samples. Higher values indicate features that have more impact on predictions. The color gradient shows the distribution of SHAP values (blue = negative impact, red = positive impact)."]})})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Feature Interactions"}),e.jsx("p",{className:"text-muted-foreground",children:"SHAP interaction values help identify which feature pairs have the strongest combined effects on predictions."}),e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[{pair:"Budget × CTR",strength:.82},{pair:"Audience × Creative",strength:.75},{pair:"Time × Platform",strength:.68},{pair:"Bid × Competition",strength:.61}].map(s=>e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm font-medium",children:s.pair}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[(s.strength*100).toFixed(0),"%"]})]},s.pair))})]})]}),n==="lime"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(L,{className:"h-6 w-6 text-emerald-600"}),e.jsx("h2",{className:"text-lg font-semibold",children:"LIME Local Explanations"})]}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"LIME explains individual predictions by learning a simple, interpretable model around the prediction point. Select a prediction to see its local explanation."}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Sample Prediction Explanation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Predicted Value"}),e.jsx("p",{className:"text-2xl font-bold",children:"3.2x ROAS"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Local Fidelity"}),e.jsx("p",{className:"text-2xl font-bold",children:"94.2%"})]})]}),e.jsx("h5",{className:"text-sm font-medium mb-3",children:"Feature Contributions"}),e.jsx("div",{className:"space-y-3",children:[{name:"High-quality creative",weight:.42,direction:"positive"},{name:"Target audience match",weight:.28,direction:"positive"},{name:"Competitive bid",weight:.15,direction:"positive"},{name:"Weekend timing",weight:-.12,direction:"negative"},{name:"Broad targeting",weight:-.08,direction:"negative"}].map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-40 text-sm",children:s.name}),e.jsx("div",{className:"flex-1 flex items-center gap-1",children:s.direction==="positive"?e.jsx("div",{className:"h-4 bg-emerald-500 rounded",style:{width:`${s.weight*100}%`}}):e.jsx("div",{className:"h-4 bg-red-500 rounded",style:{width:`${Math.abs(s.weight)*100}%`}})}),e.jsxs("div",{className:"w-16 text-right text-sm",children:[s.direction==="positive"?"+":"",(s.weight*100).toFixed(0),"%"]})]},s.name))})]})]})}),n==="ltv"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(b,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Lifetime Value Predictions"})]}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"ML-powered LTV predictions help you understand customer value and optimize acquisition strategies."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Predict LTV by Segment"}),e.jsxs("select",{className:"w-full px-3 py-2 rounded-lg border bg-background",children:[e.jsx("option",{children:"All Customers"}),e.jsx("option",{children:"High-Value Segment"}),e.jsx("option",{children:"New Customers (0-30 days)"}),e.jsx("option",{children:"Returning Customers"}),e.jsx("option",{children:"At-Risk Customers"})]}),e.jsx("button",{onClick:()=>r.mutate({segment:"all"}),disabled:r.isPending,className:"w-full px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:r.isPending?"Calculating...":"Calculate LTV"})]}),r.data&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg bg-primary/10 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Predicted LTV"}),e.jsxs("p",{className:"text-3xl font-bold text-primary",children:["$",r.data.predictedLTV.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.data.timeHorizon," |"," ",(r.data.confidence*100).toFixed(0),"% confidence"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Key Factors"}),r.data.factors.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:s.feature}),e.jsxs("span",{className:x(s.direction==="positive"?"text-emerald-600":"text-red-600"),children:[s.direction==="positive"?"+":"-",(s.importance*100).toFixed(0),"%"]})]},s.feature))]})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"LTV-Based Recommendations"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 dark:bg-emerald-950/20 border border-emerald-200 dark:border-emerald-800",children:[e.jsx(p,{className:"h-5 w-5 text-emerald-600 mb-2"}),e.jsx("h4",{className:"font-medium text-emerald-900 dark:text-emerald-100",children:"High-Value Segment"}),e.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-300 mt-1",children:"Increase bid by 20% for audiences with predicted LTV > $500"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800",children:[e.jsx(p,{className:"h-5 w-5 text-blue-600 mb-2"}),e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Retention Focus"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"At-risk customers have 3x higher LTV when retained vs new acquisition"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-purple-50 dark:bg-purple-950/20 border border-purple-200 dark:border-purple-800",children:[e.jsx(p,{className:"h-5 w-5 text-purple-600 mb-2"}),e.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-100",children:"CAC Optimization"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 mt-1",children:"Target CAC:LTV ratio of 1:3 for sustainable growth"})]})]})]})]})]})}export{W as default,U as useExplainPrediction};
//# sourceMappingURL=ModelExplainability-48DzeBqQ.js.map
