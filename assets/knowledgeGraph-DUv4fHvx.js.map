{"version":3,"file":"knowledgeGraph-DUv4fHvx.js","sources":["../../src/api/knowledgeGraph.ts"],"sourcesContent":["/**\r\n * Stratum AI - Knowledge Graph API Hooks\r\n *\r\n * React Query hooks for Knowledge Graph features:\r\n * - Problem Detection (severity filter, resolve action)\r\n * - Revenue Attribution (period-based, channel breakdown)\r\n */\r\n\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiClient } from './client';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport type ProblemSeverity = 'critical' | 'warning' | 'info';\r\n\r\nexport interface KGProblem {\r\n  id: string;\r\n  severity: ProblemSeverity;\r\n  title: string;\r\n  description: string;\r\n  impact: string;\r\n  impactAmount: number;\r\n  affectedCampaigns: number;\r\n  platform: string;\r\n  detectedAt: string;\r\n  status: 'active' | 'resolved' | 'dismissed';\r\n}\r\n\r\nexport interface KGProblemsData {\r\n  problems: KGProblem[];\r\n  summary: {\r\n    critical: number;\r\n    warnings: number;\r\n    resolved30d: number;\r\n    revenueAtRisk: number;\r\n  };\r\n}\r\n\r\nexport interface KGRevenueData {\r\n  attributedRevenue: number;\r\n  touchpointsTracked: number;\r\n  avgPathLength: number;\r\n  conversionWindow: string;\r\n  modelComparison: {\r\n    channel: string;\r\n    firstTouch: number;\r\n    lastTouch: number;\r\n    linear: number;\r\n    dataDriven: number;\r\n  }[];\r\n}\r\n\r\nexport interface KGChannelBreakdown {\r\n  channel: string;\r\n  revenue: number;\r\n  percentage: number;\r\n  color: string;\r\n}\r\n\r\n// =============================================================================\r\n// Hooks\r\n// =============================================================================\r\n\r\nexport function useKGProblems(filters?: { severity?: ProblemSeverity; status?: string }) {\r\n  return useQuery({\r\n    queryKey: ['kg', 'problems', filters],\r\n    queryFn: async () => {\r\n      const params = new URLSearchParams();\r\n      if (filters?.severity) params.append('severity', filters.severity);\r\n      if (filters?.status) params.append('status', filters.status);\r\n\r\n      const response = await apiClient.get<{ data: KGProblemsData }>(\r\n        `/knowledge-graph/problems?${params}`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    staleTime: 60 * 1000,\r\n    placeholderData: {\r\n      problems: [\r\n        {\r\n          id: '1',\r\n          severity: 'critical' as const,\r\n          title: 'Creative Fatigue Detected',\r\n          description:\r\n            'Ad creative performance has dropped 34% in the last 7 days across 12 campaigns.',\r\n          impact: '-$3,400/week',\r\n          impactAmount: 3400,\r\n          affectedCampaigns: 12,\r\n          platform: 'Meta',\r\n          detectedAt: '2024-12-08',\r\n          status: 'active' as const,\r\n        },\r\n        {\r\n          id: '2',\r\n          severity: 'warning' as const,\r\n          title: 'Budget Pacing Issue',\r\n          description: 'Google Search campaigns are under-spending by 28% against daily targets.',\r\n          impact: '-$1,800/week',\r\n          impactAmount: 1800,\r\n          affectedCampaigns: 5,\r\n          platform: 'Google',\r\n          detectedAt: '2024-12-09',\r\n          status: 'active' as const,\r\n        },\r\n        {\r\n          id: '3',\r\n          severity: 'warning' as const,\r\n          title: 'Audience Overlap',\r\n          description: '3 Meta ad sets share 45% audience overlap, causing self-competition.',\r\n          impact: '-$1,000/week',\r\n          impactAmount: 1000,\r\n          affectedCampaigns: 3,\r\n          platform: 'Meta',\r\n          detectedAt: '2024-12-10',\r\n          status: 'active' as const,\r\n        },\r\n      ],\r\n      summary: {\r\n        critical: 1,\r\n        warnings: 2,\r\n        resolved30d: 8,\r\n        revenueAtRisk: 6200,\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\nexport function useResolveKGProblem() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (problemId: string) => {\r\n      const response = await apiClient.post(`/knowledge-graph/problems/${problemId}/resolve`);\r\n      return response.data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['kg', 'problems'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useKGRevenueAttribution(period: string = '30d') {\r\n  return useQuery({\r\n    queryKey: ['kg', 'revenue', period],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: KGRevenueData }>(\r\n        `/knowledge-graph/revenue?period=${period}`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n    placeholderData: {\r\n      attributedRevenue: 284500,\r\n      touchpointsTracked: 45200,\r\n      avgPathLength: 4.2,\r\n      conversionWindow: '7 days',\r\n      modelComparison: [\r\n        { channel: 'Google Search', firstTouch: 42, lastTouch: 38, linear: 35, dataDriven: 37 },\r\n        { channel: 'Meta Ads', firstTouch: 28, lastTouch: 32, linear: 30, dataDriven: 31 },\r\n        { channel: 'Display', firstTouch: 12, lastTouch: 8, linear: 14, dataDriven: 13 },\r\n        { channel: 'TikTok', firstTouch: 10, lastTouch: 12, linear: 11, dataDriven: 11 },\r\n        { channel: 'Snapchat', firstTouch: 5, lastTouch: 6, linear: 6, dataDriven: 5 },\r\n        { channel: 'Organic', firstTouch: 3, lastTouch: 4, linear: 4, dataDriven: 3 },\r\n      ],\r\n    },\r\n  });\r\n}\r\n\r\nexport function useKGChannelBreakdown(period: string = '30d') {\r\n  return useQuery({\r\n    queryKey: ['kg', 'channels', period],\r\n    queryFn: async () => {\r\n      const response = await apiClient.get<{ data: KGChannelBreakdown[] }>(\r\n        `/knowledge-graph/channels?period=${period}`\r\n      );\r\n      return response.data.data;\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n    placeholderData: [\r\n      { channel: 'Google Search', revenue: 105000, percentage: 37, color: '#4285F4' },\r\n      { channel: 'Meta Ads', revenue: 88000, percentage: 31, color: '#0866FF' },\r\n      { channel: 'Display', revenue: 37000, percentage: 13, color: '#34A853' },\r\n      { channel: 'TikTok', revenue: 31000, percentage: 11, color: '#000000' },\r\n      { channel: 'Snapchat', revenue: 14000, percentage: 5, color: '#FFFC00' },\r\n      { channel: 'Organic', revenue: 9500, percentage: 3, color: '#6B7280' },\r\n    ],\r\n  });\r\n}\r\n"],"names":["useKGProblems","filters","useQuery","params","apiClient","useResolveKGProblem","queryClient","useQueryClient","useMutation","problemId","useKGRevenueAttribution","period","useKGChannelBreakdown"],"mappings":"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"}