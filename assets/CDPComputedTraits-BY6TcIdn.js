import{j as e}from"./vendor-ui-B0DL0VNC.js";import{r as c}from"./vendor-react-Dz7uKsMg.js";import{c_ as y,A as r,v as j,V as D,c as P}from"./index-BQex3859.js";import{H as I,I as A,J as F}from"./cdp-B6W0ktOz.js";import{R as u}from"./refresh-cw-DLOeozaH.js";import{P as E}from"./plus-B9u7Tds1.js";import{C as N}from"./calculator-BW8tZQIw.js";import"./vendor-charts-Cj11RBfc.js";import"./vendor-utils-L2YjCnAZ.js";import"./vendor-query-BPt-n81V.js";import"./vendor-motion-CR45sdSp.js";const m=[{value:"count",label:"Count",icon:y,description:"Count of events"},{value:"sum",label:"Sum",icon:N,description:"Sum of property values"},{value:"average",label:"Average",icon:r,description:"Average of values"},{value:"min",label:"Minimum",icon:r,description:"Minimum value"},{value:"max",label:"Maximum",icon:r,description:"Maximum value"},{value:"first",label:"First",icon:j,description:"First occurrence"},{value:"last",label:"Last",icon:j,description:"Most recent occurrence"},{value:"unique_count",label:"Unique Count",icon:y,description:"Count unique values"},{value:"exists",label:"Exists",icon:r,description:"Boolean if exists"}],L=[{value:"number",label:"Number"},{value:"string",label:"Text"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"}],p={name:"",display_name:"",description:"",trait_type:"count",output_type:"number",event_name:"",property:"",time_window_days:null,default_value:""};function M(){const[x,n]=c.useState(!1),[s,t]=c.useState(p),[g,v]=c.useState(null),{data:i,isLoading:_,refetch:w}=I({active_only:!1}),o=A(),C=F(),b=(i==null?void 0:i.traits)||[],T=async a=>{a.preventDefault();const l={name:s.name.toLowerCase().replace(/\s+/g,"_"),display_name:s.display_name,description:s.description||void 0,trait_type:s.trait_type,output_type:s.output_type,source_config:{event_name:s.event_name||void 0,property:s.property||void 0,time_window_days:s.time_window_days||void 0},default_value:s.default_value||void 0};try{await o.mutateAsync(l),t(p),n(!1)}catch(d){console.error("Failed to create trait:",d)}},k=async a=>{v(a);try{await C.mutateAsync(a)}catch(l){console.error("Failed to delete trait:",l)}finally{v(null)}},S=a=>m.find(l=>l.value===a)||m[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Computed Traits"}),e.jsx("p",{className:"text-muted-foreground",children:"Define derived values calculated from profile events"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(),className:"px-3 py-2 rounded-lg border hover:bg-muted transition-colors",children:e.jsx(u,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>n(!x),className:"px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"New Trait"]})]})]}),x&&e.jsxs("div",{className:"p-6 rounded-xl border bg-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create Computed Trait"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:s.display_name,onChange:a=>t({...s,display_name:a.target.value,name:a.target.value.toLowerCase().replace(/\s+/g,"_")}),placeholder:"e.g., Total Purchases",className:"w-full px-3 py-2 rounded-lg border bg-background",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Internal Name"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>t({...s,name:a.target.value}),placeholder:"e.g., total_purchases",className:"w-full px-3 py-2 rounded-lg border bg-background font-mono text-sm",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("input",{type:"text",value:s.description,onChange:a=>t({...s,description:a.target.value}),placeholder:"Optional description",className:"w-full px-3 py-2 rounded-lg border bg-background"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Trait Type"}),e.jsx("select",{value:s.trait_type,onChange:a=>t({...s,trait_type:a.target.value}),className:"w-full px-3 py-2 rounded-lg border bg-background",children:m.map(a=>e.jsxs("option",{value:a.value,children:[a.label," - ",a.description]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Output Type"}),e.jsx("select",{value:s.output_type,onChange:a=>t({...s,output_type:a.target.value}),className:"w-full px-3 py-2 rounded-lg border bg-background",children:L.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Source Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Event Name"}),e.jsx("input",{type:"text",value:s.event_name,onChange:a=>t({...s,event_name:a.target.value}),placeholder:"e.g., Purchase, PageView",className:"w-full px-3 py-2 rounded-lg border bg-background"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Property (for aggregations)"}),e.jsx("input",{type:"text",value:s.property,onChange:a=>t({...s,property:a.target.value}),placeholder:"e.g., total, price",className:"w-full px-3 py-2 rounded-lg border bg-background"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Time Window (days)"}),e.jsx("input",{type:"number",value:s.time_window_days||"",onChange:a=>t({...s,time_window_days:a.target.value?parseInt(a.target.value):null}),placeholder:"Leave empty for all time",className:"w-full px-3 py-2 rounded-lg border bg-background",min:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Default Value"}),e.jsx("input",{type:"text",value:s.default_value,onChange:a=>t({...s,default_value:a.target.value}),placeholder:"Value when no data",className:"w-full px-3 py-2 rounded-lg border bg-background"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{n(!1),t(p)},className:"px-4 py-2 rounded-lg border hover:bg-muted",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o.isPending,className:"px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:o.isPending?"Creating...":"Create Trait"})]})]})]}),_?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(u,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):b.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No computed traits defined yet."}),e.jsx("p",{className:"text-sm",children:"Create your first trait to start enriching profiles."})]}):e.jsx("div",{className:"grid gap-4",children:b.map(a=>{var h,f;const l=S(a.trait_type),d=l.icon;return e.jsxs("div",{className:"p-4 rounded-xl border bg-card hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(d,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]})]}),e.jsx("button",{onClick:()=>k(a.id),disabled:g===a.id,className:"p-2 rounded-lg hover:bg-destructive/10 hover:text-destructive transition-colors",children:g===a.id?e.jsx(u,{className:"w-4 h-4 animate-spin"}):e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-primary/10 text-primary",children:l.label}),e.jsxs("span",{className:"px-2 py-1 rounded-full text-xs bg-muted",children:["Output: ",a.output_type]}),!!((h=a.source_config)!=null&&h.event_name)&&e.jsxs("span",{className:"px-2 py-1 rounded-full text-xs bg-muted",children:["Event: ",String(a.source_config.event_name)]}),!!((f=a.source_config)!=null&&f.time_window_days)&&e.jsxs("span",{className:"px-2 py-1 rounded-full text-xs bg-muted",children:["Window: ",String(a.source_config.time_window_days),"d"]}),e.jsx("span",{className:P("px-2 py-1 rounded-full text-xs",a.is_active?"bg-green-500/10 text-green-600":"bg-muted text-muted-foreground"),children:a.is_active?"Active":"Inactive"})]}),a.last_computed_at&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Last computed: ",new Date(a.last_computed_at).toLocaleString()]})]},a.id)})})]})}function G(){return e.jsx("div",{className:"p-6",children:e.jsx(M,{})})}export{G as default};
//# sourceMappingURL=CDPComputedTraits-BY6TcIdn.js.map
