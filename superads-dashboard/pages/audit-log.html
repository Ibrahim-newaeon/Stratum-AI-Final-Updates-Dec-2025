<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Log - Stratum AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
</head>
<body>
    <!-- SVG Icon Definitions -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="icon-chart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="20" x2="18" y2="10"></line>
            <line x1="12" y1="20" x2="12" y2="4"></line>
            <line x1="6" y1="20" x2="6" y2="14"></line>
        </symbol>
        <symbol id="icon-trending" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
        </symbol>
        <symbol id="icon-target" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="6"></circle>
            <circle cx="12" cy="12" r="2"></circle>
        </symbol>
        <symbol id="icon-signal" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 20h.01"></path>
            <path d="M7 20v-4"></path>
            <path d="M12 20v-8"></path>
            <path d="M17 20V8"></path>
            <path d="M22 4v16"></path>
        </symbol>
        <symbol id="icon-megaphone" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 11l18-5v12L3 13v-2z"></path>
            <path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path>
        </symbol>
        <symbol id="icon-cpu" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
            <rect x="9" y="9" width="6" height="6"></rect>
            <line x1="9" y1="1" x2="9" y2="4"></line>
            <line x1="15" y1="1" x2="15" y2="4"></line>
            <line x1="9" y1="20" x2="9" y2="23"></line>
            <line x1="15" y1="20" x2="15" y2="23"></line>
            <line x1="20" y1="9" x2="23" y2="9"></line>
            <line x1="20" y1="14" x2="23" y2="14"></line>
            <line x1="1" y1="9" x2="4" y2="9"></line>
            <line x1="1" y1="14" x2="4" y2="14"></line>
        </symbol>
        <symbol id="icon-dollar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </symbol>
        <symbol id="icon-phone" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
            <line x1="12" y1="18" x2="12.01" y2="18"></line>
        </symbol>
        <symbol id="icon-plug" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22v-5"></path>
            <path d="M9 8V2"></path>
            <path d="M15 8V2"></path>
            <path d="M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"></path>
        </symbol>
        <symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </symbol>
        <symbol id="icon-clipboard" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
        </symbol>
        <symbol id="icon-settings" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </symbol>
        <symbol id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </symbol>
        <symbol id="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </symbol>
        <symbol id="icon-download" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </symbol>
        <symbol id="icon-pie-chart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
            <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
        </symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </symbol>
        <symbol id="icon-edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </symbol>
        <symbol id="icon-trash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </symbol>
        <symbol id="icon-key" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
        </symbol>
        <symbol id="icon-refresh" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </symbol>
        <symbol id="icon-mail" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
        </symbol>
    </svg>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="logo"><div class="logo-icon">S</div>STRATUM AI</a>
                <span class="badge superads">SuperAds</span>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Core</div>
                    <a href="../index.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-chart"/></svg></span>Overview</a>
                    <a href="insights.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-trending"/></svg></span>Insights</a>
                    <a href="attribution.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-target"/></svg></span>Attribution</a>
                    <a href="signal-quality.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-signal"/></svg></span>Signal Quality</a>
                    <a href="campaigns.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-megaphone"/></svg></span>Campaigns</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Intelligence</div>
                    <a href="predictions.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-cpu"/></svg></span>ML Predictions</a>
                    <a href="profit.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-dollar"/></svg></span>Profit Center</a>
                    <a href="whatsapp.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-phone"/></svg></span>WhatsApp</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Admin</div>
                    <a href="connectors.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-plug"/></svg></span>Connectors</a>
                    <a href="users.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-users"/></svg></span>Users & RBAC</a>
                    <a href="audit-log.html" class="nav-item active"><span class="nav-icon"><svg><use href="#icon-clipboard"/></svg></span>Audit Log</a>
                    <a href="settings.html" class="nav-item"><span class="nav-icon"><svg><use href="#icon-settings"/></svg></span>Settings</a>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <h1 class="page-title">Audit Log</h1>
                </div>
                <div class="header-right">
                    <select class="form-select" id="actionFilter" style="width: 150px;">
                        <option value="">All Actions</option>
                        <option value="create">Create</option>
                        <option value="update">Update</option>
                        <option value="delete">Delete</option>
                        <option value="login">Login</option>
                        <option value="sync">Sync</option>
                    </select>
                    <select class="form-select" id="userFilter" style="width: 150px;">
                        <option value="">All Users</option>
                        <option value="admin">Super Admin</option>
                        <option value="john">John Doe</option>
                        <option value="jane">Jane Smith</option>
                        <option value="system">System</option>
                    </select>
                    <button class="btn btn-secondary"><svg width="14" height="14" style="vertical-align: middle; margin-right: 4px;"><use href="#icon-download"/></svg> Export CSV</button>
                    <div class="theme-toggle" id="themeToggle"><div class="theme-toggle-slider"><svg width="16" height="16"><use href="#icon-moon"/></svg></div></div>
                </div>
            </header>

            <div class="dashboard">
                <!-- Stats -->
                <div class="metrics-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="metric-card"><div class="metric-value" id="totalEvents">1,247</div><div class="metric-label">Total Events (30d)</div></div>
                    <div class="metric-card"><div class="metric-value" style="color: var(--accent-green);" id="successEvents">1,198</div><div class="metric-label">Successful</div></div>
                    <div class="metric-card"><div class="metric-value" style="color: var(--accent-red);" id="failedEvents">49</div><div class="metric-label">Failed</div></div>
                    <div class="metric-card"><div class="metric-value" id="activeUsers">8</div><div class="metric-label">Active Users</div></div>
                </div>

                <!-- Activity Timeline -->
                <div class="grid-2">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><span class="panel-title-icon"><svg width="18" height="18"><use href="#icon-chart"/></svg></span>Activity by Day</div>
                        </div>
                        <div class="panel-content">
                            <canvas id="activityChart" height="200"></canvas>
                        </div>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><span class="panel-title-icon"><svg width="18" height="18"><use href="#icon-pie-chart"/></svg></span>Actions Breakdown</div>
                        </div>
                        <div class="panel-content" style="display: flex; align-items: center; justify-content: center;">
                            <canvas id="actionsChart" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Audit Log Table -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title"><span class="panel-title-icon"><svg width="18" height="18"><use href="#icon-clipboard"/></svg></span>Recent Activity</div>
                        <input type="text" placeholder="Search logs..." class="form-input" id="searchInput" style="width: 250px;">
                    </div>
                    <div class="panel-content" style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>User</th>
                                    <th>Action</th>
                                    <th>Resource</th>
                                    <th>Details</th>
                                    <th>Status</th>
                                    <th>IP Address</th>
                                </tr>
                            </thead>
                            <tbody id="auditTable"></tbody>
                        </table>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-top: 1px solid var(--border-primary);">
                        <span id="paginationInfo" style="color: var(--text-muted); font-size: 0.85rem;">Showing 1-20 of 1,247</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" id="prevBtn" disabled>Previous</button>
                            <button class="btn btn-secondary" id="nextBtn">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="modalOverlay" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
        <div class="modal" style="background: var(--bg-secondary); border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid var(--border-primary); display: flex; justify-content: space-between; align-items: center;">
                <h2 id="modalTitle" style="font-size: 1.25rem;">Event Details</h2>
                <button id="closeModal" style="background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer;">x</button>
            </div>
            <div class="modal-body" id="modalBody" style="padding: 1.5rem;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../shared/api.js"></script>
    <script src="../shared/utils.js"></script>
    <script>
        let auditLogs = [];
        let activityChart, actionsChart;

        // Action icon SVG paths for inline rendering
        const actionIconSVGs = {
            create: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
            update: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',
            delete: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',
            login: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>',
            sync: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',
            export: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',
            invite: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>'
        };

        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initEventListeners();
            loadData();
        });

        function initTheme() {
            const savedTheme = localStorage.getItem('stratum-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function updateThemeIcon(theme) {
            const slider = document.querySelector('.theme-toggle-slider');
            slider.innerHTML = theme === 'dark'
                ? '<svg width="16" height="16"><use href="#icon-moon"/></svg>'
                : '<svg width="16" height="16"><use href="#icon-sun"/></svg>';
        }

        function initEventListeners() {
            document.getElementById('themeToggle').addEventListener('click', () => {
                const html = document.documentElement;
                const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('stratum-theme', newTheme);
                updateThemeIcon(newTheme);
                initCharts();
            });

            document.getElementById('searchInput').addEventListener('input', debounce(filterLogs, 300));
            document.getElementById('actionFilter').addEventListener('change', filterLogs);
            document.getElementById('userFilter').addEventListener('change', filterLogs);

            document.getElementById('closeModal').addEventListener('click', () => {
                document.getElementById('modalOverlay').style.display = 'none';
            });
        }

        async function loadData() {
            auditLogs = getMockAuditLogs();
            renderAuditLogs(auditLogs);
            initCharts();
        }

        function getMockAuditLogs() {
            const actions = ['create', 'update', 'delete', 'login', 'sync', 'export', 'invite'];
            const users = [
                { name: 'Super Admin', email: 'admin@stratum.ai' },
                { name: 'John Doe', email: 'john@company.com' },
                { name: 'Jane Smith', email: 'jane@company.com' },
                { name: 'System', email: 'system@stratum.ai' }
            ];
            const resources = ['Campaign', 'User', 'Connector', 'Template', 'Alert', 'Report', 'Settings'];
            const statuses = ['success', 'success', 'success', 'success', 'failed'];

            return Array.from({ length: 50 }, (_, i) => {
                const action = actions[Math.floor(Math.random() * actions.length)];
                const user = users[Math.floor(Math.random() * users.length)];
                const resource = resources[Math.floor(Math.random() * resources.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const timestamp = new Date(Date.now() - i * 3600000 * Math.random() * 24);

                return {
                    id: 1000 + i,
                    timestamp: timestamp.toISOString(),
                    user: user.name,
                    email: user.email,
                    action,
                    resource,
                    resourceId: `${resource.toLowerCase()}_${100 + Math.floor(Math.random() * 900)}`,
                    details: getActionDetails(action, resource),
                    status,
                    ip: `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0'
                };
            }).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        function getActionDetails(action, resource) {
            const details = {
                create: `Created new ${resource.toLowerCase()}`,
                update: `Updated ${resource.toLowerCase()} settings`,
                delete: `Deleted ${resource.toLowerCase()}`,
                login: 'User logged in successfully',
                sync: `Synced ${resource.toLowerCase()} data from platform`,
                export: `Exported ${resource.toLowerCase()} report`,
                invite: 'Sent invitation email'
            };
            return details[action] || 'Action performed';
        }

        function renderAuditLogs(logs) {
            const actionColors = {
                create: 'var(--accent-green)',
                update: 'var(--accent-blue)',
                delete: 'var(--accent-red)',
                login: 'var(--accent-purple)',
                sync: 'var(--accent-cyan)',
                export: 'var(--accent-orange)',
                invite: 'var(--accent-yellow)'
            };

            document.getElementById('auditTable').innerHTML = logs.slice(0, 20).map(log => `
                <tr onclick="showLogDetail(${log.id})" style="cursor: pointer;">
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; white-space: nowrap;">
                        ${formatTimestamp(log.timestamp)}
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 28px; height: 28px; border-radius: 8px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.7rem; font-weight: 600;">
                                ${log.user.split(' ').map(n => n[0]).join('')}
                            </div>
                            <div>
                                <div style="font-weight: 500; font-size: 0.85rem;">${log.user}</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted);">${log.email}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; border-radius: 6px; background: ${actionColors[log.action]}20; color: ${actionColors[log.action]}; font-size: 0.8rem; font-weight: 500;">
                            ${actionIconSVGs[log.action] || ''} ${capitalize(log.action)}
                        </span>
                    </td>
                    <td>
                        <div style="font-weight: 500;">${log.resource}</div>
                        <code style="font-size: 0.7rem; color: var(--text-muted);">${log.resourceId}</code>
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; font-size: 0.85rem; color: var(--text-secondary);">
                        ${log.details}
                    </td>
                    <td>
                        <span class="feature-status ${log.status === 'success' ? 'active' : ''}" style="${log.status !== 'success' ? 'background: rgba(239, 68, 68, 0.15); color: var(--accent-red);' : ''}">
                            ${log.status === 'success' ? 'Success' : 'Failed'}
                        </span>
                    </td>
                    <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted);">
                        ${log.ip}
                    </td>
                </tr>
            `).join('');
        }

        function formatTimestamp(iso) {
            const date = new Date(iso);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;

            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function filterLogs() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const action = document.getElementById('actionFilter').value;
            const user = document.getElementById('userFilter').value;

            let filtered = auditLogs;

            if (search) {
                filtered = filtered.filter(log =>
                    log.user.toLowerCase().includes(search) ||
                    log.resource.toLowerCase().includes(search) ||
                    log.details.toLowerCase().includes(search)
                );
            }

            if (action) {
                filtered = filtered.filter(log => log.action === action);
            }

            if (user) {
                const userMap = { admin: 'Super Admin', john: 'John Doe', jane: 'Jane Smith', system: 'System' };
                filtered = filtered.filter(log => log.user === userMap[user]);
            }

            renderAuditLogs(filtered);
        }

        function showLogDetail(id) {
            const log = auditLogs.find(l => l.id === id);
            if (!log) return;

            document.getElementById('modalTitle').textContent = `Event #${log.id}`;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; gap: 1rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Timestamp</div>
                            <div style="font-family: 'JetBrains Mono', monospace;">${new Date(log.timestamp).toLocaleString()}</div>
                        </div>
                        <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Status</div>
                            <span class="feature-status ${log.status === 'success' ? 'active' : ''}" style="${log.status !== 'success' ? 'background: rgba(239, 68, 68, 0.15); color: var(--accent-red);' : ''}">
                                ${log.status === 'success' ? 'Success' : 'Failed'}
                            </span>
                        </div>
                    </div>
                    <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">User</div>
                        <div style="font-weight: 600;">${log.user}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">${log.email}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Action</div>
                            <div style="font-weight: 600;">${capitalize(log.action)}</div>
                        </div>
                        <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Resource</div>
                            <div style="font-weight: 600;">${log.resource}</div>
                            <code style="font-size: 0.75rem;">${log.resourceId}</code>
                        </div>
                    </div>
                    <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Details</div>
                        <div>${log.details}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">IP Address</div>
                            <code>${log.ip}</code>
                        </div>
                        <div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">User Agent</div>
                            <div style="font-size: 0.75rem; word-break: break-all;">${log.userAgent}</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function initCharts() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDark ? 'rgba(255,255,255,0.7)' : 'rgba(0,0,0,0.7)';

            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            if (activityChart) activityChart.destroy();

            const labels = Array.from({ length: 14 }, (_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - (13 - i));
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            activityChart = new Chart(activityCtx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Events',
                        data: [45, 52, 38, 65, 48, 72, 55, 60, 42, 78, 56, 63, 49, 71],
                        backgroundColor: '#8b5cf6',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: textColor } },
                        y: { grid: { color: isDark ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)' }, ticks: { color: textColor } }
                    }
                }
            });

            // Actions Chart
            const actionsCtx = document.getElementById('actionsChart').getContext('2d');
            if (actionsChart) actionsChart.destroy();

            actionsChart = new Chart(actionsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Update', 'Sync', 'Create', 'Login', 'Delete', 'Export'],
                    datasets: [{
                        data: [340, 285, 220, 180, 120, 102],
                        backgroundColor: ['#3b82f6', '#06b6d4', '#10b981', '#8b5cf6', '#ef4444', '#f97316'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: { legend: { position: 'right', labels: { color: textColor, padding: 10 } } }
                }
            });
        }
    </script>
</body>
</html>
